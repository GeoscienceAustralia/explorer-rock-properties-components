var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r){this.$scope=e,this.clusterChartService=t,this.clusterService=r}return e.$inject=["$scope","clusterChartService","clusterService"],e}();t.ClusterChartCtrl=r;var n=function(){function e(e,t){this.$http=e,this.$rootScope=t}return e.prototype.hideChart=function(){this.$rootScope.$broadcast("chart.update",{targetChartId:!1})},e.prototype.buildChart=function(e){document.getElementById("cluster-summary-chart-d3").innerHTML="",this.$rootScope.$broadcast("chart.update",{targetChartId:"clusterSummaryChart"});var t=[];angular.forEach(e.properties,function(e,r){var n=[];angular.forEach(e,function(e,t){n.push({attributeName:t,count:e})}),t.push({propertyName:r,data:n})});var r,n,i,s,o=1250,c=255,a=t.length<7?t.length:4;.35*document.body.clientHeight>c&&document.body.clientWidth>o?(i={top:0,right:10,bottom:0,left:10},r=document.body.clientWidth/a-(2*i.left+i.right),n=.35*document.body.clientHeight,s=20):(i={top:0,right:5,bottom:0,left:5},r=o/a-(2*i.left+i.right),n=c,s=15);var l=document.body.clientWidth-(2*i.left+i.right),p=Math.min(r,n)/2;t.forEach(function(e){function t(t,i,s,l){var h=u.selectAll("g.legendg").data(t).enter().append("g").attr("class","legendg").attr("transform",function(e,t){return"translate("+-(r/2.3)+","+(t*(y+k)-n/4)+")"}),d=h.append("rect").attr("x",45).attr("width",y).attr("height",y).attr("class","legend").style("fill",function(e,t){return a(e.attributeName)}),v=h.append("text").attr("x",65).attr("y",6).attr("dy",".35em").style("text-anchor","start").text(function(e){var t=(p-20)/5;return e.attributeName.length>t?e.attributeName.substring(0,t)+"...":e.attributeName});if(d.append("svg:title").text(function(t){var r=d3.sum(e.data.map(function(e){return e.count}));return t.attributeName+" ("+Math.round(1e3*t.count/r)/10+"%)"}),v.append("svg:title").text(function(t){var r=d3.sum(e.data.map(function(e){return e.count}));return t.attributeName+" ("+Math.round(1e3*t.count/r)/10+"%)"}),l>1){var g=u.append("g").attr("class","pageNo").attr("transform","translate(-10,"+((i+1)*(y+k)-n/4)+")");g.append("text").text(s+"/"+l).attr("dx",".25em");var m=u.append("g").attr("class","prev").attr("transform","translate(-20,"+((i+1.5)*(y+k)-n/4)+")").on("click",o).style("cursor","pointer"),f=u.append("g").attr("class","next").attr("transform","translate(0,"+((i+1.5)*(y+k)-n/4)+")").on("click",c).style("cursor","pointer");f.append("polygon").style("stroke","#000").style("fill","#000").attr("points","0,0, 20,0, 10,10"),m.append("polygon").style("stroke","#000").style("fill","#000").attr("points","0,10, 20,10, 10,0"),s==l?(f.style("opacity","0.3"),f.on("click","").style("cursor","")):1==s&&(m.style("opacity","0.3"),m.on("click","").style("cursor",""))}}function o(){S--,u.selectAll("g.legendg").remove(),u.select(".pageNo").remove(),u.select(".prev").remove(),u.select(".next").remove();for(var r=(S-1)*m,n=r+m,i=[],s=0;s<e.data.length;s++)s>=r&&n>s&&i.push(e.data[s]);t(i,m,S,f)}function c(){S++,u.selectAll("g.legendg").remove(),u.select(".pageNo").remove(),u.select(".prev").remove(),u.select(".next").remove();for(var r=(S-1)*m,n=r+m,i=[],s=0;s<e.data.length;s++)s>=r&&n>s&&i.push(e.data[s]);t(i,m,S,f)}var a=d3.scale.category20(),u=d3.select("#cluster-summary-chart-d3").append("svg").attr("width",r).attr("height",n).style("margin-left",i.left+"px").style("margin-right",i.right+"px").append("g").attr("transform","translate("+r/2+","+(n/2+10)+")"),h=d3.svg.arc().innerRadius(p-s).outerRadius(p),d=d3.layout.pie().value(function(e){return e.count}).sort(null),v=d3.select("#cluster-summary-chart-d3").append("div").attr("class","cluster-summary-tooltip");v.append("div").attr("class","attribute"),v.append("div").attr("class","count"),v.append("div").attr("class","percent");var g=u.selectAll("path").data(d(e.data)).enter().append("path").attr("d",h).attr("fill",function(e,t){return a(e.data.attributeName)}).each(function(e){this._current=e});g.on("mouseover",function(t){var r=d3.sum(e.data.map(function(e){return e.count})),n=Math.round(1e3*t.data.count/r)/10;v.select(".attribute").html(t.data.attributeName),v.select(".count").html("Count: "+t.data.count),v.select(".percent").html("Percent: "+n+"%"),v.style("display","block")}),g.on("mouseout",function(){v.style("display","none")}),g.on("mousemove",function(e){var t=d3.event.pageX>l-180?d3.event.pageX-180:d3.event.pageX,r=d3.event.pageY>document.body.clientHeight-120?d3.event.pageY-100:d3.event.pageY+10;v.style("top",r+"px").style("left",t+"px")}),u.append("g").attr("class","cluster-summary-chart-title").append("text").attr("x",0).attr("y",-(n/2+7)).attr("dy",".71em").style("text-anchor","middle").style("fill","#000").style("font-weight","bold").text(e.propertyName);var m,f,S,C=e.data.length,y=15,k=6,w=(y+k)*C;if(w/p>1){m=Math.floor(p/(y+k)),f=Math.ceil(C/m),S=1;for(var x=(S-1)*m,b=x+m,I=[],P=0;P<e.data.length;P++)P>=x&&b>P&&I.push(e.data[P]);t(I,m,S,f)}else t(e.data,Math.floor(p/(y+k)),1,1)}),document.getElementById("cluster-summary-chart-d3").style.display="none",setTimeout(function(){document.getElementById("cluster-summary-chart-loading").style.display="none",document.getElementById("cluster-summary-chart-d3").style.display="block"},1500)},e.$inject=["$http","$rootScope"],e}();t.ClusterChartService=n,angular.module("explorer.rockproperties.charts",[]).factory("clusterChartService",["$http","$rootScope",function(t,r){return new e.chartService.ClusterChartService(t,r)}]).controller("clusterChartCtrl",r).directive("clusterChartSummary",function(){return{templateUrl:"rockprops/cluster-summary.html",controller:r,controllerAs:"clusterChartVM"}})}(t=e.chartService||(e.chartService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r,n,i,s){this.$scope=e,this.$timeout=t,this.rocksClipShipService=r,this.rocksPanelService=n,this.rocksFiltersService=i,this.rocksQueryBuilderExport=s}return e.prototype.startClipShip=function(){var e=this;this.$timeout(function(){e.rocksClipShipService.step="download",e.rocksQueryBuilderExport.startClipShip(e.rocksFiltersService.exportProperties.filterOptions,e.rocksClipShipService.targetFormat,e.rocksClipShipService.targetExtent)})},e.$inject=["$scope","$timeout","rocksClipShipService","rocksPanelService","rocksFiltersService","rocksQueryBuilderExport"],e}();t.RocksClipShipCtrl=r;var n=function(){function e(e,t,r){var n=this;this.$rootScope=e,this.rocksFiltersService=t,this.rocksConfigService=r,this.step="startDraw",this.isDrawing=!1,this.$inject=["$rootScope","rocksFiltersService","rocksConfigService"],this.$rootScope.$on("rocks.config.ready",function(){n.exportFormats=n.rocksConfigService.config.geoserverWfsExportFormats}),this.$rootScope.$on("rocks.extent.ready",function(e,t){n.step="selectFeatures",n.targetExtent=t})}return e.prototype.startDraw=function(){this.isDrawing=!0,this.$rootScope.$broadcast("draw.extent.start","rocks.extent.ready")},e.prototype.openGeoserver=function(){var e=window.open(this.rocksConfigService.config.geoserverDashboardUrl,"_blank");e&&e.focus()},e.prototype.updateExportFormat=function(e){this.targetFormat=e},e}();t.RocksClipShipService=n,angular.module("explorer.rockproperties.clipship",[]).factory("rocksClipShipService",["$rootScope","rocksFiltersService","rocksConfigService",function(t,r,n){return new e.clipShipService.RocksClipShipService(t,r,n)}]).controller("rocksClipShipCtrl",r).directive("rocksClipShip",function(){return{templateUrl:"rockprops/clip-ship.html",controller:r,controllerAs:"rocksClipShipVM"}}).filter("noClipSelected",[function(e){return function(e){if(e){for(var t=0;t<e.length;t++)if(e[t].isSelected)return!1;return!0}}}])}(t=e.clipShipService||(e.clipShipService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r){this.$scope=e,this.clusterInspectorService=t,this.rocksPanelService=r}return e.$inject=["$scope","clusterInspectorService","rocksPanelService"],e}();t.ClusterInspectorCtrl=r;var n=function(){function e(e,t,r,n,i,s,o){var c=this;this.$http=e,this.$rootScope=t,this.$timeout=r,this.zoomLevelService=n,this.loadingSpinnerService=i,this.rocksConfigService=s,this.clusterChartService=o,this.inspectMode="CHART",this.listReady=!1,this.maxListStep=100,this.$rootScope.$on("rocks.config.ready",function(){c.init()})}return e.prototype.init=function(){var e=this;this.viewer=this.rocksConfigService.viewer,this.serviceUrl=this.rocksConfigService.config.rocksServiceUrl,this.rocksConfigService.config.useClusterPicking&&(this.pickHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.pickHandlerAction=function(t){var r=e.viewer.scene.pick(t.position);Cesium.defined(r)&&Cesium.defined(r.id)&&r.id.hasOwnProperty("properties")&&"rockPropsCluster"==r.id.properties.featureType&&(e.listReady=!1,e.clearHighlighted(),e.targetId=r.id,e.setHighlighted(e.targetId,!0),e.targetPos=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e.viewer.camera.pickEllipsoid(t.position)),"CHART"==e.inspectMode?e.chartClusterQuery():(e.listIndex=0,e.listClusterQuery()))})},e.prototype.chartClusterQuery=function(){var e=this;this.summarySpinner?document.getElementById("cluster-summary-chart-loading").style.display="block":(this.summarySpinner=this.loadingSpinnerService.addSpinner({width:100,height:100,container:"#cluster-summary-chart-loading",id:"chart-spinner"}),this.summarySpinner());var t="?zoom="+this.zoomLevelService.nextIndex+"&x="+Cesium.Math.toDegrees(this.targetPos.longitude)+"&y="+Cesium.Math.toDegrees(this.targetPos.latitude),r=this.serviceUrl+"query"+t;console.log("query"),console.log(r),this.$http({method:"GET",url:this.serviceUrl+"/geojson-cluster.json"}).then(function(t){t.hasOwnProperty("data")&&e.clusterChartService.buildChart(t.data)}),ga("send","event","explorer-rock-properties","click","cluster inspector summary charts")},e.prototype.loadNextListStep=function(){this.listIndex+=this.maxListStep,console.log("loadNextListStep "+this.listIndex),this.listClusterQuery()},e.prototype.listClusterQuery=function(){var e=this;console.log("listClusterQuery"),this.listSpinner?document.getElementById("cluster-result-list-loading").style.display="block":(this.listSpinner=this.loadingSpinnerService.addSpinner({width:100,height:100,container:"#cluster-result-list-loading",id:"cluster-result-list-spinner"}),this.listSpinner());var t="?zoom="+this.zoomLevelService.nextIndex+"&maxCount="+this.maxListStep+"&startIndex="+this.listIndex+"&x="+Cesium.Math.toDegrees(this.targetPos.longitude)+"&y="+Cesium.Math.toDegrees(this.targetPos.latitude),r=this.serviceUrl+"features"+t;console.log("features query"),console.log(r),this.$http({method:"GET",url:this.serviceUrl+"/mock-feature-list.json"}).then(function(t){t.hasOwnProperty("data")&&e.$timeout(function(){document.getElementById("cluster-result-list-loading").style.display="none",e.listReady=!0,0!=e.listIndex?e.listFeatures.features=e.listFeatures.features.concat(t.data.features):e.listFeatures=t.data},1e3)}),ga("send","event","explorer-rock-properties","click","cluster inspector feature list (startIndex: "+this.listIndex+")")},e.prototype.setPickEnabled=function(e){e?this.pickHandler.setInputAction(this.pickHandlerAction,Cesium.ScreenSpaceEventType.LEFT_CLICK):this.pickHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.setClusterPrimitive=function(e){this.clusterPrimitive=e},e.prototype.setHighlighted=function(e,t){var r=this.clusterPrimitive.getGeometryInstanceAttributes(e);r&&t&&(r.prevColor=r.color,r.color=Cesium.ColorGeometryInstanceAttribute.toValue(Cesium.Color.fromCssColorString("#ff00ff").withAlpha(1)))},e.prototype.clearHighlighted=function(){if(this.targetId){var e=this.clusterPrimitive.getGeometryInstanceAttributes(this.targetId);e&&e.hasOwnProperty("prevColor")&&(e.color=e.prevColor)}},e.$inject=["$http","$rootScope","$timeout","zoomLevelService","loadingSpinnerService","rocksConfigService","clusterChartService"],e}();t.ClusterInspectorService=n,angular.module("explorer.rockproperties.clusterinspector",[]).controller("clusterInspectorCtrl",r).directive("rocksClusterInspectorPanel",function(){return{templateUrl:"rockprops/cluster-inspector.html",controller:r,controllerAs:"clusterInspectorVM"}}).factory("clusterInspectorService",["$http","$rootScope","$timeout","zoomLevelService","loadingSpinnerService","rocksConfigService","clusterChartService",function(t,r,n,i,s,o,c){return new e.clusterInspector.ClusterInspectorService(t,r,n,i,s,o,c)}])}(t=e.clusterInspector||(e.clusterInspector={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r,n){this.$scope=e,this.clusterService=t,this.rocksPanelService=r,this.rocksFiltersService=n}return e.$inject=["$scope","clusterService","rocksPanelService","rocksFiltersService"],e}();t.RocksClusterFilterCtrl=r;var n=function(){function e(e,t,r,n,i,s,o){var c=this;this.$http=e,this.$rootScope=t,this.zoomLevelService=r,this.clusterChartService=n,this.loadingSpinnerService=i,this.rocksConfigService=s,this.clusterInspectorService=o,this.clusterRangeMeta={maxExtrudeHeight:5e5},this.reCluster=function(){var e=[],t=new Cesium.LabelCollection;c.getClusters().then(function(r){if(r.data&&r.data.features){var n=r.data.features;c.clusterRangeMeta.maxCount=d3.max(n,function(e){return e.properties.count}),c.clusterRangeMeta.scale=d3.scale.linear().domain([0,c.clusterRangeMeta.maxCount]).range([0,c.clusterRangeMeta.maxExtrudeHeight]);for(var i=0;i<n.length;i++){n[i].properties.featureType="rockPropsCluster";var s=c.computeClusterAttributes(n[i].properties.count);e.push(c.buildClusterInstance(n[i],s)),t.add(c.buildLabel(n[i],s))}c.drawClusters(e,t)}else console.log("got no clusters"),console.log(r)})},this.$rootScope.$on("rocks.config.ready",function(){c.viewer=c.rocksConfigService.viewer,c.serviceUrl=c.rocksConfigService.config.rocksServiceUrl}),this.$rootScope.$on("rocks.clusters.update",function(){c.reCluster()})}return e.prototype.toggleClusters=function(){return this.clustersCollection?(this.clustersCollection.show=!this.clustersCollection.show,this.zoomLevelService.setActive(this.clustersCollection.show),this.clustersCollection.show?this.clusterInspectorService.setPickEnabled(!0):this.clusterInspectorService.setPickEnabled(!1),this.reCluster()):(this.clustersCollection=new Cesium.PrimitiveCollection,this.viewer.scene.primitives.add(this.clustersCollection),this.zoomLevelService.setActive(!0),this.reCluster(),this.clusterInspectorService.setPickEnabled(!0)),this.clustersCollection.show},e.prototype.getClusters=function(){var e="?zoom="+this.zoomLevelService.nextIndex+"&xmin="+this.zoomLevelService.getViewExtent(100).west+"&xmax="+this.zoomLevelService.getViewExtent(100).east+"&ymin="+this.zoomLevelService.getViewExtent(100).south+"&ymax="+this.zoomLevelService.getViewExtent(100).north;return console.log("summary query: "+this.serviceUrl+e),this.$http({method:"GET",url:this.serviceUrl+"mock-summary-"+this.zoomLevelService.nextIndex+".json"})},e.prototype.drawClusters=function(e,t){this.clustersCollection.removeAll(),this.clusterPrimitive=new Cesium.Primitive({geometryInstances:e,appearance:new Cesium.PerInstanceColorAppearance({translucent:!0,closed:!0})}),this.clusterInspectorService.setClusterPrimitive(this.clusterPrimitive),this.clustersCollection.add(this.clusterPrimitive),this.clustersCollection.add(t)},e.prototype.buildClusterInstance=function(e,t){return new Cesium.GeometryInstance({geometry:new Cesium.CircleGeometry({center:Cesium.Cartesian3.fromDegrees(e.geometry.coordinates[0],e.geometry.coordinates[1]),radius:t.radius,vertexFormat:Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,extrudedHeight:t.extrudeHeight}),id:e,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(t.color)}})},e.prototype.buildLabel=function(e,t){return{position:Cesium.Cartesian3.fromDegrees(e.geometry.coordinates[0],e.geometry.coordinates[1],100+t.extrudeHeight),text:e.properties.count.toString(),fillColor:Cesium.Color.BLACK,outlineColor:Cesium.Color.RED,font:40-this.zoomLevelService.nextIndex+"px arial, sans-serif",horizontalOrigin:Cesium.HorizontalOrigin.CENTER,id:e}},e.prototype.computeClusterAttributes=function(e){var t={radius:1e5/(this.zoomLevelService.nextIndex/5),extrudeHeight:this.clusterRangeMeta.scale(e)/(this.zoomLevelService.nextIndex/3)};return 100>e?t.color=Cesium.Color.fromCssColorString("#4781cd").withAlpha(.5):e>=10&&1e3>e?t.color=Cesium.Color.fromCssColorString("#0fc70e").withAlpha(.5):t.color=Cesium.Color.fromCssColorString("#ff0000").withAlpha(.5),t},e.$inject=["$http","$rootScope","zoomLevelService","clusterChartService","loadingSpinnerService","rocksConfigService","clusterInspectorService"],e}();t.ClusterService=n,angular.module("explorer.rockproperties.clusters",[]).controller("rocksClusterFilterCtrl",r).directive("rocksClusterFilters",function(){return{templateUrl:"rockprops/cluster-filters.html",controller:r,controllerAs:"rocksClusterFilterVM"}}).factory("clusterService",["$http","$rootScope","zoomLevelService","clusterChartService","loadingSpinnerService","rocksConfigService","clusterInspectorService",function(t,r,n,i,s,o,c){return new e.clusterService.ClusterService(t,r,n,i,s,o,c)}])}(t=e.clusterService||(e.clusterService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e){this.$rootScope=e}return e.prototype.setConfig=function(e,t){this.config=e,this.viewer=t,this.$rootScope.$broadcast("rocks.config.ready")},e.$inject=["$rootScope"],e}();t.RocksConfigService=r,angular.module("explorer.rockproperties.config",[]).factory("rocksConfigService",["$rootScope",function(t){return new e.config.RocksConfigService(t)}])}(t=e.config||(e.config={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r){var n=this;this.$scope=e,this.rocksPanelService=t,this.wmsInspectorService=r,this.targetPanel="",this.$scope.$on("rocks.accordion.update",function(e,t){n.targetPanel=t})}return e.prototype.setTargetPanel=function(e){this.targetPanel=this.targetPanel!=e?e:""},e.$inject=["$scope","rocksPanelService","wmsInspectorService"],e}();t.RocksPanelCtrl=r;var n=function(){function e(e,t,r,n){this.$rootScope=e,this.clusterService=t,this.wmsPointsService=r,this.rocksConfigService=n,this.clustersEnabled=!1,this.pointsEnabled=!1}return e.prototype.init=function(e,t){this.viewer=e,this.rocksConfigService.setConfig(t,e)},e.prototype.toggleClusters=function(){this.clustersEnabled=this.clusterService.toggleClusters()},e.prototype.togglePoints=function(){this.pointsEnabled=this.wmsPointsService.togglePoints()},e.$inject=["$rootScope","clusterService","wmsPointsService","rocksConfigService"],e}();t.RocksPanelService=n,angular.module("explorer.rockproperties.controlpanel",[]).factory("rocksPanelService",["$rootScope","clusterService","wmsPointsService","rocksConfigService",function(t,r,n,i){return new e.controlPanel.RocksPanelService(t,r,n,i)}]).controller("rocksPanelCtrl",r).directive("rocksControlPanel",function(){return{templateUrl:"rockprops/control-panel.html",controller:r,controllerAs:"controlPanelVM"}})}(t=e.controlPanel||(e.controlPanel={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r){var n=this;this.$http=e,this.$rootScope=t,this.rocksConfigService=r,this.$inject=["$http","$rootScope","rocksConfigService"],this.$rootScope.$on("rocks.config.ready",function(){e.get(n.rocksConfigService.config.filterNamesServiceUrl).then(function(e){n.filters=e.data;for(var t=0;t<n.filters.length;t++)if("PROPERTY"==n.filters[t].filterType){for(var r=angular.copy(n.filters[t].filterOptions),i=0;i<r.length;i++)r[i]={name:r[i],isSelected:!1};var s=angular.copy(n.filters[t]);s.filterOptions=r,n.exportProperties=s}}),function(e){console.log("Failed to get rock props filters"),console.log(e)}})}return e.prototype.setAllExportSelected=function(e){for(var t=0;t<this.exportProperties.filterOptions.length;t++)this.exportProperties.filterOptions[t].isSelected=e},e}();t.RocksFiltersService=r,angular.module("explorer.rockproperties.filters",[]).factory("rocksFiltersService",["$http","$rootScope","rocksConfigService",function(t,r,n){return new e.filters.RocksFiltersService(t,r,n)}])}(t=e.filters||(e.filters={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r){this.$q=e,this.$http=t,this.rocksConfigService=r}return e.prototype.getWfsFeatureTypeNames=function(){var e=this,t=this.$q.defer();return this.$http.get(this.rocksConfigService.config.geoserverWfsUrl+"?request=GetCapabilities&service=wfs&version="+this.rocksConfigService.config.geoserverWfsVersion).success(function(r,n,i,s){var o=e.getFeatureTypeNamesFromWfsCapsJson(e.xmlToJson($.parseXML(r)));t.resolve(o)}).error(function(e){console.log("GetCapabilities request failed"),console.log(e),t.error()}),t.promise},e.prototype.getFeatureTypeNamesFromWfsCapsJson=function(e){for(var t=e["wfs:WFS_Capabilities"].FeatureTypeList.FeatureType,r=[],n=0;n<t.length;n++)r.push(t[n].Name["#text"]);return r},e.prototype.getWmsLayerNames=function(){var e=this,t=this.$q.defer();return this.$http.get(this.rocksConfigService.config.geoserverWmsUrl+"?request=GetCapabilities&service=wms&version="+this.rocksConfigService.config.geoserverWmsVersion).success(function(r,n,i,s){e.wmsLayerNames=e.getLayerNamesFromWmsCapsJson(e.xmlToJson($.parseXML(r))),t.resolve(e.wmsLayerNames)}).error(function(e){console.log("GetCapabilities request failed"),console.log(e),t.error()}),t.promise},e.prototype.getLayerNamesFromWmsCapsJson=function(e){for(var t=e.WMS_Capabilities.Capability.Layer.Layer,r=[],n=0;n<t.length;n++)r.push(t[n].Name["#text"]);return r},e.prototype.xmlToJson=function(e){var t={};if(1==e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);t["@attributes"][n.nodeName]=n.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes.item(i),o=s.nodeName;if("undefined"==typeof t[o])t[o]=this.xmlToJson(s);else{if("undefined"==typeof t[o].push){var c=t[o];t[o]=[],t[o].push(c)}t[o].push(this.xmlToJson(s))}}return t},e.$inject=["$q","$http","rocksConfigService"],e}();t.GwsUtilService=r,angular.module("explorer.rockproperties.gwsutil",[]).factory("gwsUtilService",["$q","$http","rocksConfigService",function(t,r,n){return new e.gwsUtilService.GwsUtilService(t,r,n)}])}(t=e.gwsUtilService||(e.gwsUtilService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r,n,i,s,o){var c=this;this.$q=e,this.$http=t,this.$rootScope=r,this.loadingSpinnerService=n,this.rocksClipShipService=i,this.rocksConfigService=s,this.gwsUtilService=o,this.propertyQuery="",this.$inject=["$q","$http","$rootScope","loadingSpinnerService","rocksClipShipService","rocksConfigService","gwsUtilService"],this.$rootScope.$on("rocks.config.ready",function(){c.baseUrl=c.rocksConfigService.config.geoserverWfsUrl+"?",angular.forEach(c.rocksConfigService.config.geoserverWfsExportParams,function(e,t){c.baseUrl+=t+"="+e+"&"}),c.baseUrl=c.baseUrl.slice(0,-1),c.gwsUtilService.getWfsFeatureTypeNames().then(function(e){c.wfsLayerNames=e})})}return e.prototype.startClipShip=function(e,t,r){var n=this;this.loading=!0,this.loadingSpinner||(this.loadingSpinner=this.loadingSpinnerService.addSpinner({width:80,height:80,container:"#rock-clip-ship-loading",id:"clip-ship-spinner"}),this.loadingSpinner());for(var i=[],s=0;s<e.length;s++)e[s].isSelected&&i.push(e[s].name);if("csv"===t){var o=new JSZip;if(JSZip.support.blob){var c=[];console.log("this.wfsLayerNames"),console.log(this.wfsLayerNames);for(var s=0;s<this.wfsLayerNames.length;s++){var a=this.buildQuery(i,r,t,[this.wfsLayerNames[s]]),l=this.$http.get(a);c.push(l)}this.$q.all(c).then(function(e){for(var t=0;t<e.length;t++){var r=(e[t].data.match(/\n/g)||[]).length;if(r>1){var i=n.wfsLayerNames[t].split(" ").join("-");o.file(i+".csv",e[t].data+"\n")}}var s=o.generate({type:"blob"});saveAs(s,"rocks-export.zip"),n.loading=!1,n.rocksClipShipService.step="startDraw"})}else{for(var s=0;s<this.wfsLayerNames.length;s++)window.open(this.buildQuery(i,r,t,[this.wfsLayerNames[s]]));this.loading=!1}}else this.exportUrl=this.buildQuery(i,r,t,this.wfsLayerNames),this.loading=!1},e.prototype.buildQuery=function(e,t,r,n){function i(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var s,o=this.getTypeNamesQuery(n),c="&CQL_FILTER=BBOX(GEOM,"+t.west+","+t.south+","+t.east+","+t.north+")",a="",l={},p="&outputFormat="+r,u=!i(l),h=l.hasOwnProperty("PROPERTY"),d=h&&1===Object.keys(l).length?!0:!1;return u&&h?(this.propertyQuery="%20AND%20PROPERTY='"+l.PROPERTY+"'",d||(a=this.getFilters(l))):u?(this.propertyQuery=this.getPropertyQuery(e),d||(a=this.getFilters(l))):this.propertyQuery=this.getPropertyQuery(e),s=this.baseUrl+o+p+c+a+this.propertyQuery},e.prototype.getFilters=function(e){var t="%20AND%20";for(var r in e)"PROPERTY"!==r&&(t=t.concat(r+"='"+e[r]+"'%20AND%20"));return t=t.substring(0,t.length-9)},e.prototype.getPropertyQuery=function(e){for(var t="%20AND%20(",r=0;r<e.length;r++)t=t.concat("PROPERTY='"+e[r]+"'%20OR%20");return t=t.substring(0,t.length-8),t=t.concat(")")},e.prototype.getTypeNamesQuery=function(e){for(var t="&typeName=",r=0;r<e.length;r++)t=t.concat(e[r]+",");return t=t.substring(0,t.length-1)},e}();t.QueryBuilder=r,angular.module("explorer.rockproperties.queryexport",[]).factory("rocksQueryBuilderExport",["$q","$http","$rootScope","loadingSpinnerService","rocksClipShipService","rocksConfigService","gwsUtilService",function(t,r,n,i,s,o,c){return new e.queryBuilderExport.QueryBuilder(t,r,n,i,s,o,c)}])}(t=e.queryBuilderExport||(e.queryBuilderExport={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(){}return e.prototype.addSpinner=function(e){return function(){function t(e,r){e.transition().ease("linear").duration(r).attrTween("transform",function(){return d3.interpolateString("rotate(0)","rotate(360)")}),setTimeout(function(){t(e,r)},r)}var r=Math.min(e.width,e.height)/2,n=2*Math.PI,i=d3.svg.arc().innerRadius(.5*r).outerRadius(.9*r).startAngle(0),s=d3.select(e.container).append("svg").attr("id",e.id).attr("width",e.width).attr("height",e.height).append("g").attr("transform","translate("+e.width/2+","+e.height/2+")");s.append("path").datum({endAngle:.33*n}).style("fill","#4D4D4D").attr("d",i).call(t,1500)}},e}();t.LoadingSpinnerService=r,angular.module("explorer.rockproperties.spinner",[]).factory("loadingSpinnerService",[function(){return new e.spinnerService.LoadingSpinnerService}])}(t=e.spinnerService||(e.spinnerService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(){this.view="INTRO"}return e}();t.WmsInspectorState=r,angular.module("explorer.rockproperties.inspectorstate",[]).factory("wmsInspectorState",[function(){return new e.wmsInspectorState.WmsInspectorState}])}(t=e.wmsInspectorState||(e.wmsInspectorState={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r){this.$scope=e,this.wmsInspectorState=t,this.wmsInspectorService=r}return e.$inject=["$scope","wmsInspectorState","wmsInspectorService"],e}();t.WmsInspectorCtrl=r;var n=function(){function e(e,t,r,n,i,s,o,c,a){var l=this;this.$rootScope=e,this.$http=t,this.wmsInspectorState=r,this.assetsService=n,this.configService=i,this.rocksConfigService=s,this.loadingSpinnerService=o,this.gwsUtilService=c,this.rocksClipShipService=a,this.isLoading=!1,this.URL_EXCLUDE="?SERVICE=WMS&",this.SURFACE_GEO="GA_Surface_Geology_of_Australia",this.$inject=["$rootScope","$http","wmsInspectorState","assetsService","configService","rocksConfigService","loadingSpinnerService","gwsUtilService","rocksClipShipService"],this.$rootScope.$on("viewer.click.left",function(e,t){t.degrees={lat:Cesium.Math.toDegrees(t.cartographic.latitude),lon:Cesium.Math.toDegrees(t.cartographic.longitude)},l.rocksClipShipService.isDrawing||l.inspectorEnabled&&t.hasOwnProperty("cartographic")&&(l.$rootScope.$broadcast("rocks.accordion.update","wmsInspector"),l.$rootScope.$broadcast("toolbar.toggle.update",{linked:!1,key:"rocksClusters",isActive:!0}),l.wmsInspectorState.targetGeom=t,l.wmsInspectorState.view="LAYERSELECT",l.wmsInspectorState.cameraHeight=Cesium.Ellipsoid.WGS84.cartesianToCartographic(l.rocksConfigService.viewer.camera.position).height)}),this.$rootScope.$on("rocks.config.ready",function(){n.getReferenceFeatureClasses().then(function(e){console.log(e),l.features=e}),l.rocksFeature={wmsUrl:l.rocksConfigService.config.geoserverWmsUrl,name:"Rock Properties Layer"}})}return e.prototype.togglePointInspector=function(){this.inspectorEnabled!=this.inspectorEnabled},e.prototype.queryRocks=function(){if(!this.rocksFeature.hasOwnProperty("layers")&&this.gwsUtilService.wmsLayerNames){this.rocksFeature.layers=[];for(var e=0;e<this.gwsUtilService.wmsLayerNames.length;e++)this.rocksFeature.layers.push(this.rocksConfigService.config.geoserverWmsLayerPrefix+this.gwsUtilService.wmsLayerNames[e])}this.queryFeature(this.rocksFeature)},e.prototype.queryFeature=function(e){var t=this;ga("send","event","explorer-rock-properties","click","wms inspector query: "+e.name),this.wmsInspectorState.view="FEATUREINFO",this.toggleLoading();var r=e.wmsUrl,n=e.layers;r.indexOf(this.URL_EXCLUDE)>-1&&(r=r.substring(0,r.length-this.URL_EXCLUDE.length)),r.indexOf(this.SURFACE_GEO)>-1&&(n=this.wmsInspectorState.cameraHeight<=34e4?[n[0]]:[n[1]]);var i="?SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION=1.1.1&LAYERS="+n+"&STYLES=&SRS=EPSG%3A4326&FORMAT=image%2Fpng&BBOX="+this.wmsInspectorState.targetGeom.degrees.lon+","+this.wmsInspectorState.targetGeom.degrees.lat+","+(this.wmsInspectorState.targetGeom.degrees.lon+3e-4)+","+(this.wmsInspectorState.targetGeom.degrees.lat+3e-4)+"&QUERY_LAYERS="+n+"&INFO_FORMAT=text%2Fhtml&FEATURE_COUNT=100&WIDTH=2&HEIGHT=2&X=1&Y=1&TRANSPARENT=true&EXCEPTIONS=application%2Fvnd.ogc.se_xml";this.$http.get(r+i).success(function(e){t.featureInfo=e,t.toggleLoading()}).error(function(e,t,r,n){console.log("Couldn't load WMS GetFeatureInfo"),this.featureInfo="<h5>Couldn't load WMS GetFeatureInfo for this layer.</h5><p>You may not be able to access this function for some layers.</p>",this.toggleLoading()})},e.prototype.toggleLoading=function(){this.loadingSpinner?this.isLoading=!this.isLoading:(this.loadingSpinner=this.loadingSpinnerService.addSpinner({width:60,height:60,container:"#rocks-inspector-loading",id:"rocks-inspector-spinner"}),this.loadingSpinner(),this.isLoading=!0)},e}();t.WmsInspectorService=n,angular.module("explorer.rockproperties.inspector",["explorer.assets"]).factory("wmsInspectorService",["$rootScope","$http","wmsInspectorState","assetsService","configService","rocksConfigService","loadingSpinnerService","gwsUtilService","rocksClipShipService",function(t,r,n,i,s,o,c,a,l){return new e.wmsInspectorService.WmsInspectorService(t,r,n,i,s,o,c,a,l)}]).controller("wmsInspectorCtrl",e.wmsInspectorService.WmsInspectorCtrl).directive("wmsInspectorPanel",function(){return{templateUrl:"rockprops/wms-inspector-panel.html",controller:r,controllerAs:"wmsInspectorVM"}})}(t=e.wmsInspectorService||(e.wmsInspectorService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t,r,n){this.$scope=e,this.wmsPointsService=t,this.rocksPanelService=r,this.wmsInspectorState=n}return e.$inject=["$scope","wmsPointsService","rocksPanelService","wmsInspectorState"],
e}();t.RocksWmsPointsCtrl=r;var n=function(){function e(e,t,r,n){var i=this;this.$rootScope=e,this.gwsUtilService=t,this.rocksConfigService=r,this.wmsInspectorState=n,this.inspectorEnabled=!0,this.masterChecked=!0,this.legendParamString="",this.$inject=["$rootScope","gwsUtilService","rocksConfigService","wmsInspectorState"],this.$rootScope.$on("rocks.config.ready",function(){i.init()})}return e.prototype.init=function(){var e=this;this.wmsServiceUrl=this.rocksConfigService.config.geoserverWmsUrl,this.viewer=this.rocksConfigService.viewer,this.restrictedBounds=Cesium.Rectangle.fromDegrees(109,-45,158,-8),this.legendParamString="?",angular.forEach(this.rocksConfigService.config.geoserverWmsLegendParams,function(t,r){e.legendParamString+=r+"="+t+"&"}),this.legendParamString=this.legendParamString.slice(0,-1)+"&LAYER=",this.gwsUtilService.getWmsLayerNames().then(function(t){e.layers=t,e.getLegendData()})},e.prototype.togglePoints=function(){return this.pointsVisible=!this.pointsVisible,this.wmsLayer?this.wmsLayer.show=this.pointsVisible:this.updatePointsLayer(),this.pointsVisible},e.prototype.toggleChecked=function(){this.masterChecked!=this.masterChecked;for(var e in this.legendData)this.legendData[e].isSelected=this.masterChecked},e.prototype.getLegendData=function(){this.legendData={};for(var e=0;e<this.layers.length;e++)this.legendData[this.layers[e]]={legendUrl:this.wmsServiceUrl+this.legendParamString+this.layers[e],isSelected:!0}},e.prototype.updatePointsLayer=function(){var e=[];for(var t in this.legendData)this.legendData.hasOwnProperty(t)&&this.legendData[t].isSelected===!0&&e.push(t);this.wmsLayer&&this.viewer.imageryLayers.remove(this.wmsLayer),ga("send","event","explorer-rock-properties","click","update wms points layer: "+e.toString()),this.wmsLayer=this.viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:this.wmsServiceUrl,layers:e.toString(),rectangle:this.restrictedBounds,parameters:{transparent:"true",format:"image/png"},enablePickFeatures:!1})),this.wmsLayer.alpha=.7},e}();t.WmsPointsService=n,angular.module("explorer.rockproperties.wmspoints",[]).factory("wmsPointsService",["$rootScope","gwsUtilService","rocksConfigService","wmsInspectorState",function(t,r,n,i){return new e.pointsService.WmsPointsService(t,r,n,i)}]).controller("rocksWmsPointsCtrl",r).directive("rocksWmsPointsLegend",function(){return{templateUrl:"rockprops/wms-points-panel.html",controller:r,controllerAs:"rocksWmsPointsVM"}})}(t=e.pointsService||(e.pointsService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var r=function(){function e(e,t){var r=this;this.$rootScope=e,this.rocksConfigService=t,this.zoomLevels=[1e3,2e3,5e3,2e4,5e4,1e5,5e5,1e6,3e6,5e6,75e5,84e5,85e5,9e6,95e5,1e7],this.defaultExtent={west:109,south:-45,east:158,north:-8},this.moveEndHandler=function(){r.nextIndex=r.getIndex(Cesium.Ellipsoid.WGS84.cartesianToCartographic(r.viewer.camera.position).height),r.previousIndex>-1&&r.previousIndex!=r.nextIndex&&r.$rootScope.$broadcast("rocks.clusters.update",r.nextIndex),console.log("HEIGHT"),console.log(Cesium.Ellipsoid.WGS84.cartesianToCartographic(r.viewer.camera.position).height),r.previousIndex=r.nextIndex},this.$rootScope.$on("rocks.config.ready",function(){r.viewer=r.rocksConfigService.viewer})}return e.prototype.getIndex=function(e){for(var t=0;t<this.zoomLevels.length;t++)if(e<this.zoomLevels[t])return this.zoomLevels.length-t;return this.zoomLevels.length-1},e.prototype.setActive=function(e){e?(this.previousIndex=this.getIndex(Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.viewer.camera.position).height),this.nextIndex=this.previousIndex,this.viewer.camera.moveEnd.addEventListener(this.moveEndHandler)):this.viewer.camera.moveEnd.removeEventListener(this.moveEndHandler)},e.prototype.getViewExtent=function(e){var t=Cesium.Ellipsoid.WGS84,r=window.devicePixelRatio||1,n=new Cesium.Cartesian2(-e,-e),i=this.viewer.scene.camera.pickEllipsoid(n,t);n=new Cesium.Cartesian2(this.viewer.scene.canvas.width/r+e,this.viewer.scene.canvas.height/r+e);var s=this.viewer.scene.camera.pickEllipsoid(n,t);return null!=i&&null!=s?(i=t.cartesianToCartographic(i),s=t.cartesianToCartographic(s),i.longitude>s.longitude?this.defaultExtent:{west:Cesium.Math.toDegrees(i.longitude),south:Cesium.Math.toDegrees(s.latitude),east:Cesium.Math.toDegrees(s.longitude),north:Cesium.Math.toDegrees(i.latitude)}):this.defaultExtent},e.$inject=["$rootScope","rocksConfigService"],e}();t.ZoomLevelService=r,angular.module("explorer.rockproperties.zoom",[]).factory("zoomLevelService",["$rootScope","rocksConfigService",function(t,r){return new e.zoom.ZoomLevelService(t,r)}])}(t=e.zoom||(e.zoom={}))}(rpComponents||(rpComponents={})),angular.module("explorer.rockproperties.templates",[]).run(["$templateCache",function(e){e.put("rockprops/clip-ship.html",'\n<div ng-show="rocksClipShipVM.rocksClipShipService.step == \'startDraw\'">\n	<h6 class="dis-inline">\n		1.\n		<button ng-click="rocksClipShipVM.rocksClipShipService.startDraw()" style="padding: 5px 10px;border-radius: 3px;border: none;">\n			Click here\n		</button>\n		to select an area on the map <i class="fa fa-scissors" style="font-size: 16px;"></i></h6>\n</div>\n\n\n<div ng-show="rocksClipShipVM.rocksClipShipService.step == \'selectFeatures\'">\n\n	<h6 class="dis-inline">2. Select features to download:</h6>\n\n	<div>\n\n		<!-- if we have active property filters, use them instead -->\n		<p ng-show="hasAnyFilter">\n			<i class="fa fa-info-circle"></i> Current filters will be applied to the exported data.\n		</p>\n\n		<div ng-hide="hasAnyFilter">\n\n			<div style="padding: 5px; margin-top: 10px; background: #f0f0f0; border-radius: 3px;">\n				<label>\n					<input\n						type="checkbox"\n						ng-model="masterCheck"\n						ng-disabled="hasPropertyFilter"\n						ng-change="rocksClipShipVM.rocksFiltersService.setAllExportSelected(masterCheck)" />\n					{{ masterCheck ? \'Deselect\' : \'Select\' }} All\n				</label>\n			</div>\n\n			<label style="margin-left: 25px;" class="checkbox" ng-repeat="property in rocksClipShipVM.rocksFiltersService.exportProperties.filterOptions">\n				<input\n					type="checkbox"\n					value="property.isSelected"\n					ng-model="property.isSelected"\n					ng-checked="masterCheck"\n					ng-disabled="hasPropertyFilter">\n				{{ property.name }}\n			</label>\n\n		</div>\n\n		<div style="margin: 20px 0px 20px 0px;">\n			<label title="Export Format">Export Format</label>\n			<select ng-change="rocksClipShipVM.rocksClipShipService.updateExportFormat(exportFormats.SelectedOption)"\n					ng-model="exportFormats.SelectedOption"\n					name="format"\n					ng-options="option for option in rocksClipShipVM.rocksClipShipService.exportFormats"\n					ng-class="form-control"\n					class="filter-input"\n					style="float: right; width: 160px;">\n				<option value="" class="">--select--</option>\n			</select>\n		</div>\n\n		<a ng-click="rocksClipShipVM.rocksClipShipService.openGeoserver()" style="font-size: 11px; margin-top: 20px; color: blue; text-decoration: underline;">\n			More Options via GeoServer Dashboard\n		</a>\n\n		<div style="margin-top: 20px;">\n			<button\n				type="button"\n				class="btn btn-default"\n				ng-click="rocksClipShipVM.rocksClipShipService.step = \'startDraw\'; rocksClipShipVM.rocksClipShipService.isDrawing = false"\n				title="Cancel Download"\n				style="width: 40%; float: left;">Cancel</button>\n			<button\n				type="button"\n				class="btn btn-default focusMe"\n				ng-click="rocksClipShipVM.startClipShip()"\n				style="width: 40%; float: right"\n				title="Select one or more reference feature classes before continuing."\n				ng-disabled="(rocksClipShipVM.rocksFiltersService.exportProperties.filterOptions | noClipSelected) || (!rocksClipShipVM.rocksClipShipService.targetFormat)">Next</button>\n		</div>\n\n	</div>\n\n</div>\n\n<div ng-show="rocksClipShipVM.rocksClipShipService.step == \'download\'">\n\n	<h6>3. Data Export:</h6>\n\n	<div ng-hide="rocksClipShipVM.rocksQueryBuilderExport.loading">\n\n		<p ng-show="rocksClipShipVM.rocksClipShipService.targetFormat === \'application/json\'" style="margin-top: 40px;">\n			<i class="fa fa-info-circle"></i> Once json has loaded, save page as a .json file.\n		</p>\n\n		<p class="warning-block" style="margin-top: 20px;">\n			<i class="fa fa-info-circle"></i> Large data sets may take several minutes to export.\n		</p>\n\n		<a\n			class="btn btn-default"\n			target="_blank"\n			href="{{rocksClipShipVM.rocksQueryBuilderExport.exportUrl}}"\n			ng-click="rocksClipShipVM.rocksClipShipService.step = \'startDraw\'; rocksClipShipVM.rocksClipShipService.isDrawing = false"\n			style="width: 100%; margin-top: 30px;"\n			role="button">\n			<i class="fa fa-download"></i> Download {{ rocksClipShipVM.rocksClipShipService.targetFormat }}\n		</a>\n\n		<a\n			class="btn btn-default"\n			href="javascript:;"\n			ng-click="rocksClipShipVM.rocksClipShipService.step = \'selectFeatures\'"\n			style="width: 100%; margin-top: 10px;"\n			role="button">\n			<i class="fa fa-arrow-left"></i> Back\n		</a>\n\n	</div>\n\n</div>\n\n<div id="rock-clip-ship-loading" ng-show="rocksClipShipVM.rocksQueryBuilderExport.loading">\n	<p>Preparing Data..</p>\n</div>'),e.put("rockprops/cluster-filters.html",'\n<!-- TODO plug into rock props filter service -->\n\n<div ng-hide="clusterInspectorVM.rocksPanelService.clustersEnabled">\n	Enable Cluster Features to apply filters.\n</div>\n\n<div ng-show="clusterInspectorVM.rocksPanelService.clustersEnabled">\n\n\n	<div ng-repeat="filter in rocksClusterFilterVM.rocksFiltersService.filters" style="padding-top:7px;position:relative; overflow-x: hidden;overflow-y: auto;">\n\n		<label style="font-size: 11px;" title="{{filter.filterLabel}}">{{filter.filterLabel}}</label>\n		<select\n				ng-change="filterChanged(filter.filterType, filter.SelectedOption)"\n				ng-model="filter.SelectedOption"\n				name="filter.filterType"\n				ng-options="option as option for option in filter.filterOptions"\n				ng-class=\'form-control\'\n				class=\'filter-input\'\n				style="float:left;width:100%;position:relative;">\n			<option value="" selected>--select--</option>\n		</select>\n\n	</div>\n\n	<div style="text-align: center;">\n		<a class="btn btn-default" style="margin: 10px;" ng-click="applyFilters()" href="javascript:;">\n			<i class="fa fa-filter fa-lg"></i>\n			Apply\n		</a>\n\n		<a class="btn btn-default" style="margin: 10px;" ng-click="clearFilters()" href="javascript:;">\n			<i class="fa fa-remove fa-lg"></i>\n			Clear\n		</a>\n\n		<p ng-show="filterResultCount()" style="text-align: left; margin: 10px; font-size: 14px;">\n			<strong>Record Count: </strong>\n			14320\n		</p>\n	</div>\n\n</div>\n'),e.put("rockprops/cluster-inspector.html",'\n<div ng-hide="clusterInspectorVM.rocksPanelService.clustersEnabled">\n	Enable Cluster Features to use the inspector tool.\n</div>\n\n<div ng-show="clusterInspectorVM.rocksPanelService.clustersEnabled">\n\n	<p>Click on a cluster to see:</p>\n\n	<label class="radio-inline">\n		<input\n			type="radio"\n			ng-model="clusterInspectorVM.clusterInspectorService.inspectMode"\n			value="CHART"> Summary charts\n	</label>\n	<label class="radio-inline">\n		<input\n			type="radio"\n			ng-model="clusterInspectorVM.clusterInspectorService.inspectMode"\n			value="LIST"> Results list\n	</label>\n\n	<div id="cluster-result-list-loading" style="padding-top: 10px; text-align: center;"></div>\n\n\n	<div ng-show="clusterInspectorVM.clusterInspectorService.listReady">\n\n		<div class="alert alert-success" style="margin-top: 30px;">\n			Features loaded:\n			{{\n				clusterInspectorVM.clusterInspectorService.listFeatures.totalFeatures +\n				clusterInspectorVM.clusterInspectorService.listIndex\n			}}\n		</div>\n\n		<div ng-repeat="feature in clusterInspectorVM.clusterInspectorService.listFeatures.features" class="rocks-result-list-feature">\n\n			<table class="table table-hover table-striped">\n\n				<h5>ID: {{feature.id}}</h5>\n				<tbody>\n					<tr>\n						<td><strong>GEOM</strong></td>\n						<td>{{feature.geometry.coordinates[0]}}, {{feature.geometry.coordinates[1]}}</td>\n					</tr>\n					<tr ng-repeat="(key, value) in feature.properties">\n						<td><strong>{{key}}</strong></td>\n						<td>{{value}}</td>\n					</tr>\n				</tbody>\n\n			</table>\n		</div>\n\n		<a\n			ng-show="clusterInspectorVM.clusterInspectorService.listFeatures.totalFeatures <= clusterInspectorVM.clusterInspectorService.maxListStep"\n			class="btn btn-default"\n			style="margin-top: 40px; width: 100%;"\n			ng-click="clusterInspectorVM.clusterInspectorService.loadNextListStep()"\n			href="javascript:;">\n			Load more records\n		</a>\n\n	</div>\n\n</div>\n'),e.put("rockprops/cluster-summary.html",'<div id="clusterSummaryChart" ng-show="chartState.targetChartId == \'clusterSummaryChart\'">\n\n	<div class="btn-group" style="position: absolute;right: 10px;top: 10px;">\n		<button type="button" class="btn btn-default" title="Close charts" ng-click="clusterChartVM.clusterChartService.hideChart(); clusterChartVM.clusterService.clearHighlighted();">\n			<i class="fa fa-times-circle" role="presentation" style="font-size:16px; color:black"></i>\n		</button>\n	</div>\n\n	<div id="cluster-summary-chart-d3"></div>\n	<div id="cluster-summary-chart-loading"></div>\n\n</div>'),e.put("rockprops/control-panel.html",'<div>\n\n	<div class="rocks-accordion">\n		<div class="rocks-toggle-button" title="Show/hide cluster features">\n			<input\n				type="checkbox"\n				ng-model="controlPanelVM.rocksPanelService.clustersEnabled"\n				ng-change="controlPanelVM.rocksPanelService.toggleClusters()" />\n		</div>\n		<button class="title" ng-click="controlPanelVM.setTargetPanel(\'clusterFeatures\')">\n			<i class="fa fa-{{ controlPanelVM.targetPanel == \'clusterFeatures\' ? \'minus\' : \'plus\' }}"></i>\n			Cluster Features\n		</button>\n	</div>\n	<div class="rocks-accordion-content" ng-show="controlPanelVM.targetPanel == \'clusterFeatures\'">\n\n		<uib-tabset active="activeJustified" justified="true">\n			<uib-tab index="0" heading="Inspect" style="padding: 0px 0px 20px 0px;">\n				<rocks-cluster-inspector-panel></rocks-cluster-inspector-panel>\n			</uib-tab>\n			<uib-tab index="1" heading="Filter" style="padding: 0px 0px 20px 0px;">\n				<rocks-cluster-filters></rocks-cluster-filters>\n			</uib-tab>\n		</uib-tabset>\n\n	</div>\n\n	<div class="rocks-accordion">\n		<div class="rocks-toggle-button" title="Show/hide point features WMS layer">\n			<input\n				type="checkbox"\n				ng-model="controlPanelVM.rocksPanelService.pointsEnabled"\n				ng-change="controlPanelVM.rocksPanelService.togglePoints()" />\n		</div>\n		<div class="title" ng-click="controlPanelVM.setTargetPanel(\'pointFeatures\')">\n			<i class="fa fa-{{ controlPanelVM.targetPanel == \'pointFeatures\' ? \'minus\' : \'plus\' }}"></i>\n			Point Features (WMS)\n		</div>\n	</div>\n\n	<div class="rocks-accordion-content" ng-show="controlPanelVM.targetPanel == \'pointFeatures\'">\n		<rocks-wms-points-legend></rocks-wms-points-legend>\n	</div>\n\n\n	<div class="rocks-accordion">\n		<div class="rocks-toggle-button" title="Show/hide point features WMS layer">\n			<input\n				type="checkbox"\n				ng-model="controlPanelVM.wmsInspectorService.inspectorEnabled"\n				ng-change="controlPanelVM.wmsInspectorService.togglePointInspector()" />\n		</div>\n		<div class="title" ng-click="controlPanelVM.setTargetPanel(\'wmsInspector\')">\n			<i class="fa fa-{{ controlPanelVM.targetPanel == \'wmsInspector\' ? \'minus\' : \'plus\' }}"></i>\n			WMS Inspector (GetFeatureInfo)\n		</div>\n	</div>\n	<div class="rocks-accordion-content" ng-show="controlPanelVM.targetPanel == \'wmsInspector\'">\n		<wms-inspector-panel></wms-inspector-panel>\n	</div>\n\n\n	<div class="rocks-accordion">\n		<div class="title w100" ng-click="controlPanelVM.setTargetPanel(\'clipShip\')">\n			<i class="fa fa-{{ controlPanelVM.targetPanel == \'clipShip\' ? \'minus\' : \'plus\' }}"></i>\n			Download Rock Property Data\n		</div>\n	</div>\n\n	<div class="rocks-accordion-content" ng-show="controlPanelVM.targetPanel == \'clipShip\'">\n\n		<rocks-clip-ship></rocks-clip-ship>\n\n	</div>\n\n</div>'),e.put("rockprops/wms-inspector-panel.html",'\n<div ng-show="wmsInspectorVM.wmsInspectorState.view == \'INTRO\'">\n	<div ng-if="wmsInspectorVM.wmsInspectorService.inspectorEnabled">Click the map to get feature info.</div>\n	<div ng-if="!wmsInspectorVM.wmsInspectorService.inspectorEnabled">Enable WMS Inspector to interrogate WMS layers.</div>\n</div>\n\n<div ng-show="wmsInspectorVM.wmsInspectorState.view == \'LAYERSELECT\'">\n\n	<p style="margin: 10px 0px;" tooltip="Approx 30m accuracy">\n		Select a layer to query:\n		<code>\n			{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lat | number : 2}},\n			{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lon | number : 2}}\n		</code>\n	</p>\n\n	<a\n		class="btn btn-default"\n		style="width: 100%; margin: 2px 0px"\n		ng-click="wmsInspectorVM.wmsInspectorService.queryRocks()"\n		href="javascript:;">\n		Rock Properties Data\n	</a>\n\n	<a\n		ng-repeat="feature in wmsInspectorVM.wmsInspectorService.features"\n		class="btn btn-default"\n	   	style="width: 100%; margin: 2px 0px"\n	   	ng-click="wmsInspectorVM.wmsInspectorService.queryFeature(feature)"\n	   	href="javascript:;">\n		{{feature.name}}\n	</a>\n\n	<a class="btn btn-default"\n	   style="width: 100%; margin-top: 20px"\n	   ng-click="wmsInspectorVM.wmsInspectorState.view = \'INTRO\'"\n	   href="javascript:;">\n		<i class="fa fa-times fa-lg"></i>\n		Cancel\n	</a>\n\n</div>\n\n\n<div ng-show="wmsInspectorVM.wmsInspectorState.view == \'FEATUREINFO\'">\n\n	<div ng-show="wmsInspectorVM.wmsInspectorService.isLoading">\n		<div id="rocks-inspector-loading"></div>\n	</div>\n\n	<div ng-hide="wmsInspectorVM.wmsInspectorService.isLoading">\n\n		<p style="margin: 10px 0px;" tooltip="Approx 30m accuracy">\n			Feature Info for:\n			<code>\n				{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lat | number : 2}},\n				{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lon | number : 2}}\n			</code>\n		</p>\n\n		<!-- put html here.. -->\n		<div ng-bind-html="wmsInspectorVM.wmsInspectorService.featureInfo"></div>\n\n	</div>\n\n	<div>\n\n		<a class="btn btn-default"\n		   style="width: 49%; margin-top: 20px"\n		   ng-click="wmsInspectorVM.wmsInspectorState.view = \'LAYERSELECT\'"\n		   href="javascript:;">\n			<i class="fa fa-arrow-left fa-lg"></i>\n			Back\n		</a>\n\n		<a class="btn btn-default"\n		   style="width: 49%; margin-top: 20px"\n		   ng-click="wmsInspectorVM.wmsInspectorState.view = \'INTRO\'"\n		   href="javascript:;">\n			<i class="fa fa-times fa-lg"></i>\n			Cancel\n		</a>\n\n	</div>\n\n</div>'),e.put("rockprops/wms-points-panel.html",'<div ng-hide="rocksWmsPointsVM.rocksPanelService.pointsEnabled">\n	Enable Point Features to view layers.\n</div>\n\n<div ng-show="rocksWmsPointsVM.rocksPanelService.pointsEnabled">\n\n	<div style="padding: 5px 10px; margin-left: -10px; background: #f0f0f0; border-radius: 3px;">\n		<label>\n			<input\n				type="checkbox"\n				ng-model="rocksWmsPointsVM.wmsPointsService.masterChecked"\n				ng-change="rocksWmsPointsVM.wmsPointsService.toggleChecked()"\n				ng-disabled="!rocksWmsPointsVM.rocksPanelService.pointsEnabled"/>\n			{{ rocksWmsPointsVM.wmsPointsService.masterChecked ? \'Deselect\' : \'Select\' }} all layers\n		</label>\n	</div>\n\n	<div ng-repeat="legend in rocksWmsPointsVM.wmsPointsService.legendData" class=\'rocks-points-legend-item\'>\n\n		<label>\n			<input\n			type="checkbox"\n			ng-model="legend.isSelected" />\n			<img ng-src="{{legend.legendUrl}}" alt="{{legend}} legend icon" />\n		</label>\n\n	</div>\n\n	<a class="btn btn-default"\n	   style="width: 100%; margin-top: 20px"\n	   ng-click="rocksWmsPointsVM.wmsPointsService.updatePointsLayer()"\n	   href="javascript:;">\n		<i class="fa fa-refresh fa-lg"></i>\n		Update layers\n	</a>\n\n</div>')}]);
//# sourceMappingURL=explorer-rock-properties-components.min.js.map
