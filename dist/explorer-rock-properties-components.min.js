var rpComponents;!function(e){var t;!function(e){"use strict";var t=function(){function e(e,t,o,i,r,s,n,l,c){this.count=e,this.lat=t,this.lon=o,this.elev=i,this.lithologyGroup=r,this.property=s,this.provinceName=n,this.sampleType=l,this.stratigraphicUnitName=c}return e.$inject=["count","lat","lon","elev","lithologyGroup","property","provinceName","sampleType","stratigraphicUnitName"],e}();e.Cluster=t}(t=e.cluster||(e.cluster={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var o=function(){function e(e,t,o){var i=this;this.$http=e,this.$rootScope=t,this.zoomLevelService=o,this.reCluster=function(){var e=[],t=new Cesium.LabelCollection;i.getClusters().then(function(o){if(o.data){for(var r=o.data,s=0;s<r.length;s++)e.push(i.buildSphereInstance(r[s])),t.add(i.buildLabel(r[s]));i.drawClusters(e,t)}else console.log("got no clusters")})}}return e.prototype.init=function(e,t){var o=this;this.viewer=e,this.zoomLevelService.viewer=e,this.serviceUrl=t,this.$rootScope.$on("rocks.clusters.update",function(){o.reCluster()})},e.prototype.toggleClusters=function(){var e=this;if(this.clustersCollection)this.clustersCollection.show=!this.clustersCollection.show,this.zoomLevelService.setActive(this.clustersCollection.show),this.reCluster();else{this.clustersCollection=new Cesium.PrimitiveCollection,this.viewer.scene.primitives.add(this.clustersCollection),this.zoomLevelService.setActive(!0),this.reCluster();var t=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);t.setInputAction(function(t){var o=e.viewer.scene.pick(t.position);Cesium.defined(o)&&(console.log("id: "),console.log(o.id))},Cesium.ScreenSpaceEventType.LEFT_CLICK)}},e.prototype.getClusters=function(){return this.$http({method:"GET",url:this.serviceUrl+this.zoomLevelService.nextIndex+".json",headers:{"Content-Type":"application/json"},data:{heightIndex:this.zoomLevelService.nextIndex,extent:this.zoomLevelService.getViewExtent(100)}})},e.prototype.getClusterInfo=function(e){console.log("TODO query service for cluster info for:"),console.log(e)},e.prototype.drawClusters=function(e,t){this.clustersCollection.removeAll(),this.clustersCollection.add(new Cesium.Primitive({geometryInstances:e,appearance:new Cesium.PerInstanceColorAppearance({translucent:!0,closed:!0})})),this.clustersCollection.add(t)},e.prototype.buildSphereInstance=function(e){var t=this.computeClusterAttributes(e.count),o=Cesium.Cartesian3.fromDegrees(e.lon,e.lat),i=Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(o),new Cesium.Cartesian3(e.lon,e.lat,t.size),new Cesium.Matrix4),r=new Cesium.SphereGeometry({vertexFormat:Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,radius:t.size}),s=new Cesium.GeometryInstance({geometry:r,modelMatrix:i,vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(t.color)},id:e});return s},e.prototype.buildLabel=function(e){var t=this.computeClusterAttributes(e.count);return{position:Cesium.Cartesian3.fromDegrees(e.lon,e.lat,20+2*t.size),text:e.count.toString(),fillColor:Cesium.Color.BLACK,outlineColor:Cesium.Color.RED,font:"30px arial, sans-serif",horizontalOrigin:Cesium.HorizontalOrigin.CENTER}},e.prototype.computeClusterAttributes=function(e){return 10>e?{size:1e4*this.zoomLevelService.nextIndex,color:Cesium.Color.fromCssColorString("#4781cd").withAlpha(.5)}:e>=10&&1e3>e?{size:1e4*this.zoomLevelService.nextIndex,color:Cesium.Color.fromCssColorString("#0fc70e").withAlpha(.5)}:{size:1e4*this.zoomLevelService.nextIndex,color:Cesium.Color.fromCssColorString("#ff0000").withAlpha(.5)}},e.$inject=["$http","$rootScope","zoomLevelService"],e}();t.ClusterService=o,angular.module("explorer.rockproperties.clusters",[]).factory("clusterService",["$http","$rootScope","zoomLevelService",function(t,o,i){return new e.clusterService.ClusterService(t,o,i)}])}(t=e.clusterService||(e.clusterService={}))}(rpComponents||(rpComponents={}));var rpComponents;!function(e){var t;!function(t){"use strict";var o=function(){function e(e){var t=this;this.$rootScope=e,this.zoomLevels=[5e3,1e4,2e4,4e4,75e4,15e5,25e5,35e5,55e5,65e5,8e6],this.defaultExtent={west:109,south:-45,east:158,north:-8},this.moveEndHandler=function(){t.nextIndex=t.getIndex(Cesium.Ellipsoid.WGS84.cartesianToCartographic(t.viewer.camera.position).height),t.previousIndex>-1&&t.previousIndex!=t.nextIndex&&t.$rootScope.$broadcast("rocks.clusters.update",t.nextIndex),t.previousIndex=t.nextIndex}}return e.prototype.getIndex=function(e){for(var t=0;t<this.zoomLevels.length;t++)if(e<this.zoomLevels[t])return t;return this.zoomLevels.length-1},e.prototype.setActive=function(e){e?(this.previousIndex=this.getIndex(Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.viewer.camera.position).height),this.nextIndex=this.previousIndex,this.viewer.camera.moveEnd.addEventListener(this.moveEndHandler)):this.viewer.camera.moveEnd.removeEventListener(this.moveEndHandler)},e.prototype.getViewExtent=function(e){var t=Cesium.Ellipsoid.WGS84,o=window.devicePixelRatio||1,i=new Cesium.Cartesian2(-e,-e),r=this.viewer.scene.camera.pickEllipsoid(i,t);i=new Cesium.Cartesian2(this.viewer.scene.canvas.width/o+e,this.viewer.scene.canvas.height/o+e);var s=this.viewer.scene.camera.pickEllipsoid(i,t);return null!=r&&null!=s?(r=t.cartesianToCartographic(r),s=t.cartesianToCartographic(s),r.longitude>s.longitude?this.defaultExtent:{west:Cesium.Math.toDegrees(r.longitude),south:Cesium.Math.toDegrees(s.latitude),east:Cesium.Math.toDegrees(s.longitude),north:Cesium.Math.toDegrees(r.latitude)}):this.defaultExtent},e.$inject=["$rootScope"],e}();t.ZoomLevelService=o,angular.module("explorer.rockproperties.zoom",[]).factory("zoomLevelService",["$rootScope",function(t){return new e.zoom.ZoomLevelService(t)}])}(t=e.zoom||(e.zoom={}))}(rpComponents||(rpComponents={}));
//# sourceMappingURL=explorer-rock-properties-components.min.js.map
