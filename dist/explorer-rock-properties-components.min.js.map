{"version":3,"sources":["components/config.ts","components/cluster-filters.ts","components/spinner.ts","components/gws-util.ts","components/query-builder-export.ts","components/clipship.ts","leaflet/wms-inspector.ts","leaflet/wms-inspector-state.ts","components/wms-points.ts","components/control-panel.ts","leaflet/cluster-inspector.ts","leaflet/zoom.ts","explorer-rock-properties-components.min.js","leaflet/clusters.ts","components/charts.ts","templates/templates.ts"],"names":["rpComponents","config","config_1","RocksConfigService","$rootScope","this","prototype","setConfig","map","$broadcast","$inject","angular","module","factory","filters","RocksClusterFilterCtrl","$scope","clusterService","rocksPanelService","rocksFiltersService","ClusterFilterState","filterQuery","RocksFiltersService","$http","rocksConfigService","clusterFilterState","_this","clusterFilters","$on","get","filterNamesServiceUrl","then","response","data","i","length","filterType","propertyOptions","copy","filterOptions","j","name","isSelected","properties","exportProperties","console","log","setAllExportSelected","selected","applyFilters","buildFilterQuery","reCluster","ga","query","hasOwnProperty","ClusterOption","encodeURIComponent","clearFilters","controller","directive","templateUrl","controllerAs","spinnerService","LoadingSpinnerService","addSpinner","spin","selection","duration","transition","ease","attrTween","d3","interpolateString","setTimeout","radius","Math","min","width","height","tau","PI","arc","svg","innerRadius","outerRadius","startAngle","select","container","append","attr","id","datum","endAngle","style","call","gwsUtilService","GwsUtilService","$q","getWfsFeatureTypeNames","deferred","defer","geoserverWfsUrl","geoserverWfsVersion","success","status","headers","layerNames","getFeatureTypeNamesFromWfsCapsJson","xmlToJson","$","parseXML","resolve","error","err","promise","layerData","FeatureTypeList","FeatureType","layers","push","Name","getWmsLayerNames","geoserverWmsUrl","geoserverWmsVersion","wmsLayerNames","getLayerNamesFromWmsCapsJson","WMS_Capabilities","Capability","Layer","xml","obj","nodeType","attributes","attribute","item","nodeName","nodeValue","hasChildNodes","childNodes","old","queryBuilderExport","QueryBuilder","loadingSpinnerService","rocksClipShipService","propertyQuery","baseUrl","forEach","geoserverWfsExportParams","value","key","slice","wfsLayerNames","startClipShip","features","format","extent","loading","loadingSpinner","targetFeatures","zip","JSZip","support","blob","promises","buildQuery","all","results","numberOfLineBreaks","match","filename","split","join","file","content","generate","type","saveAs","step","window","open","exportUrl","isEmpty","prop","typeNamesQuery","getTypeNamesQuery","bboxQuery","west","south","east","north","exportFormat","hasFilters","filtersHasProperty","onlyHasPropertyFilter","Object","keys","getFilters","getPropertyQuery","filterString","property","concat","substring","clipShipService","RocksClipShipCtrl","$timeout","rocksQueryBuilderExport","targetFormat","targetExtent","RocksClipShipService","isDrawing","exportFormats","geoserverWfsExportFormats","event","startDraw","openGeoserver","win","geoserverDashboardUrl","focus","updateExportFormat","filter","$filter","wmsInspectorService","wmsInspectorService_1","WmsInspectorCtrl","wmsInspectorState","WmsInspectorService","assetsService","configService","isLoading","URL_EXCLUDE","SURFACE_GEO","degrees","lat","cartographic","latitude","lon","longitude","inspectorEnabled","linked","isActive","targetGeom","view","cameraHeight","getReferenceFeatureClasses","rocksFeature","wmsUrl","togglePointInspector","queryRocks","geoserverWmsLayerPrefix","queryFeature","feature","toggleLoading","targetUrl","targetLayers","indexOf","queryString","featureInfo","WmsInspectorState","pointsService","RocksWmsPointsCtrl","wmsPointsService","WmsPointsService","masterChecked","legendParamString","init","wmsServiceUrl","restrictedBounds","geoserverWmsLegendParams","getLegendData","togglePoints","pointsVisible","wmsLayer","show","updatePointsLayer","toggleChecked","legend","legendData","legendUrl","remove","toString","L","tileLayer","wms","transparent","addLayer","controlPanel","RocksPanelCtrl","targetPanel","setTargetPanel","RocksPanelService","clustersEnabled","pointsEnabled","toggleClusters","clusterInspector","ClusterInspectorCtrl","clusterInspectorService","PagingState","count","total","more","ClusterInspectorService","zoomLevelService","clusterChartService","inspectMode","listReady","maxListStep","serviceUrl","rocksServiceUrl","useClusterPicking","chartClusterQuery","summarySpinner","document","getElementById","display","args","nextIndex","targetPos","method","url","buildChart","loadNextListStep","listIndex","listClusterQuery","listSpinner","listFeatures","totalFeatures","pagingState","setPickEnabled","enabled","setClusterPrimitive","primitive","clusterPrimitive","setHighlighted","highlight","getGeometryInstanceAttributes","prevColor","color","clearHighlighted","targetId","chartSpinnerService","zoom","ZoomLevelService","zoomLevels","defaultExtent","moveEndHandler","nextPosition","previousPosition","getIndex","abs","defineProperty","enumerable","configurable","setActive","active","getViewExtent","offset","ClusterHeightWeighter","calculateWeighting","pow","ClusterService","sequence","clusterFilter","movePan","layer","removeLayer","instanceSequence","getZoom","bounds","getBounds","parms","max","getWest","getEast","getSouth","getNorth","result","maxRadius","sqrt","geoJson","pointToLayer","latlng","geojsonMarkerOptions","fillColor","weight","opacity","fillOpacity","marker","circleMarker","bindLabel","noHide","on","addTo","chartService","ClusterChartCtrl","ClusterChartService","hideChart","targetChartId","dataset","innerHTML","propertyData","attKey","attributeName","propertyName","padding","donutWidth","minWidth","minHeight","numberOfCharts","body","clientHeight","clientWidth","top","right","bottom","left","panelWidth","drawLegend","legendPerPage","pageNo","totalPages","selectAll","enter","d","legendWidth","legendSpacing","legendRect","legendText","text","charSpace","sum","round","pageText","prevtriangle","prevLegend","nexttriangle","nextLegend","startIndex","endIndex","dataSubset","seriesSubset","scale","category20","pie","layout","sort","tooltip","path","each","_current","percent","html","x","pageX","y","pageY","legendCount","netLegendHeight","floor","ceil","run","$templateCache","put"],"mappings":"AAEA,GAAOA,eAAP,SAAOA,GAAa,GAAAC,IAAA,SAAAC,GAEhB,YAQA,IAAAC,GAAA,WAQI,QAAAA,GACWC,GAAAC,KAAAD,WAAAA,EAQf,MALID,GAAAG,UAAAC,UAAA,SAAUN,EAAaO,GACnBH,KAAKJ,OAASA,EACdI,KAAKG,IAAMA,EACXH,KAAKD,WAAWK,WAAW,uBAVxBN,EAAAO,SACH,cAWRP,IAjBaD,GAAAC,mBAAkBA,EAmB/BQ,QACKC,OAAO,qCACPC,QAAQ,sBAAuB,aAC5B,SACIT,GAEA,MAAA,IAAIJ,GAAaC,OAAOE,mBAAmBC,OAnCvCH,EAAAD,EAAAC,SAAAD,EAAAC,aAAbD,eAAAA,iBCGP,IAAOA,eAAP,SAAOA,GAAa,GAAAc,IAAA,SAAAA,GAEhB,YAGA,IAAAC,GAAA,WAGI,QAAAA,GACWC,EACAC,EACAC,EACAC,GAHAd,KAAAW,OAAAA,EACAX,KAAAY,eAAAA,EACAZ,KAAAa,kBAAAA,EACAb,KAAAc,oBAAAA,EAEf,MAPWJ,GAAAL,SAAW,SAAU,iBAAkB,oBAAqB,uBAOvEK,IATaD,GAAAC,uBAAsBA,CAenC,IAAAK,GAAA,WAAA,QAAAA,KACIf,KAAAgB,YAAsB,GAC1B,MAAAD,KAFaN,GAAAM,mBAAkBA,CAa/B,IAAAE,GAAA,WAcI,QAAAA,GACWC,EACAnB,EACAoB,EACAP,EACAQ,GAnBf,GAAAC,GAAArB,IAeeA,MAAAkB,MAAAA,EACAlB,KAAAD,WAAAA,EACAC,KAAAmB,mBAAAA,EACAnB,KAAAY,eAAAA,EACAZ,KAAAoB,mBAAAA,EAfXpB,KAAAsB,kBAEAtB,KAAAK,SACI,QACA,aACA,qBACA,iBACA,sBAWAL,KAAKD,WAAWwB,IAAI,qBAAsB,WAEtCL,EAAMM,IAAIH,EAAKF,mBAAmBvB,OAAO6B,uBAAuBC,KAAK,SAACC,GAElEN,EAAKZ,QAAUkB,EAASC,IACxB,KAAI,GAAIC,GAAI,EAAGA,EAAIR,EAAKZ,QAAQqB,OAAQD,IACpC,GAAiC,YAA9BR,EAAKZ,QAAQoB,GAAGE,WAAyB,CAIxC,IAAI,GADAC,GAAkB1B,QAAQ2B,KAAKZ,EAAKZ,QAAQoB,GAAGK,eAC3CC,EAAI,EAAGA,EAAIH,EAAgBF,OAAQK,IACvCH,EAAgBG,IACZC,KAAMJ,EAAgBG,GACtBE,YAAY,EAGpB,IAAIC,GAAkBhC,QAAQ2B,KAAKZ,EAAKZ,QAAQoB,GAChDS,GAAWJ,cAAgBF,EAC3BX,EAAKkB,iBAAmBD,KAIhC,SAACX,GACDa,QAAQC,IAAI,oCACZD,QAAQC,IAAId,MA0C5B,MArCWV,GAAAhB,UAAAyC,qBAAP,SAA4BC,GACxB,IAAI,GAAId,GAAI,EAAGA,EAAI7B,KAAKuC,iBAAiBL,cAAcJ,OAAQD,IAC3D7B,KAAKuC,iBAAiBL,cAAcL,GAAGQ,WAAaM,GAIrD1B,EAAAhB,UAAA2C,aAAP,WACI5C,KAAKoB,mBAAmBJ,YAAchB,KAAK6C,mBAC3C7C,KAAKY,eAAekC,YAEpBC,GAAG,OAAQ,QAAS,2BAA4B,QAAS,4BAGtD9B,EAAAhB,UAAA4C,iBAAP,WAII,IAAI,GAFAG,GAAQ,GAEJnB,EAAI,EAAGA,EAAI7B,KAAKS,QAAQqB,OAAQD,IACjC7B,KAAKS,QAAQoB,GAAGoB,eAAe,kBAAoBjD,KAAKS,QAAQoB,GAAGqB,gBAClEF,EAAQA,EAAQ,WAAYG,mBAAmBnD,KAAKS,QAAQoB,GAAGE,WAAY,IAAK/B,KAAKS,QAAQoB,GAAGqB,eAIxG,OAAOF,IAGJ/B,EAAAhB,UAAAmD,aAAP,WAEI,IAAI,GAAIvB,GAAI,EAAGA,EAAI7B,KAAKS,QAAQqB,OAAQD,IACjC7B,KAAKS,QAAQoB,GAAGoB,eAAe,mBAC9BjD,KAAKS,QAAQoB,GAAGqB,eAAgB,EAIxClD,MAAKoB,mBAAmBJ,YAAc,GACtChB,KAAKY,eAAekC,aAE5B7B,IAxFaR,GAAAQ,oBAAmBA,EA0FhCX,QACKC,OAAO,6CACP8C,WAAW,yBAA0B3C,GACrC4C,UAAU,sBAAuB,WAC9B,OACIC,YAAa,iCACbF,WAAa3C,EACb8C,aAAc,0BAGrBhD,QAAQ,uBACL,QACA,aACA,qBACA,iBACA,qBACA,SACIU,EACAnB,EACAoB,EACAP,EACAQ,GAEA,MAAA,IAAIzB,GAAac,QAAQQ,oBACrBC,EACAnB,EACAoB,EACAP,EACAQ,MAGXZ,QAAQ,sBAAuB,WAAM,MAAA,IAAIb,GAAac,QAAQM,uBA1JnDN,EAAAd,EAAAc,UAAAd,EAAAc,cAAbd,eAAAA,iBCEP,IAAOA,eAAP,SAAOA,GAAa,GAAA8D,IAAA,SAAAA,GAEhB,YAMA,IAAAC,GAAA,WAAA,QAAAA,MAsCA,MApCIA,GAAAzD,UAAA0D,WAAA,SAAW/D,GAEP,MAAO,YAsBH,QAAAgE,GAAcC,EAAgBC,GAC1BD,EAAUE,aACLC,KAAK,UACLF,SAASA,GACTG,UAAU,YAAa,WACpB,MAAOC,IAAGC,kBAAkB,YAAa,iBAGjDC,WAAW,WAAaR,EAAKC,EAAWC,IAAcA,GA7B1D,GAAIO,GAAiBC,KAAKC,IAAI3E,EAAO4E,MAAO5E,EAAO6E,QAAU,EACzDC,EAAc,EAAIJ,KAAKK,GAEvBC,EAAWV,GAAGW,IAAID,MACjBE,YAAqB,GAATT,GACZU,YAAqB,GAATV,GACZW,WAAW,GAEZH,EAAWX,GAAGe,OAAOrF,EAAOsF,WAAWC,OAAO,OAC7CC,KAAK,KAAMxF,EAAOyF,IAClBD,KAAK,QAASxF,EAAO4E,OACrBY,KAAK,SAAUxF,EAAO6E,QACtBU,OAAO,KACPC,KAAK,YAAa,aAAexF,EAAO4E,MAAQ,EAAI,IAAM5E,EAAO6E,OAAS,EAAI,IAEnFI,GAAIM,OAAO,QACNG,OAAOC,SAAU,IAAKb,IACtBc,MAAM,OAAQ,WACdJ,KAAK,IAAKR,GACVa,KAAK7B,EAAM,QAc5BF,IAtCaD,GAAAC,sBAAqBA,EAwClCpD,QACKC,OAAO,sCACPC,QAAQ,yBAA0B,WAAM,MAAA,IAAIb,GAAa8D,eAAeC,0BAlD7DD,EAAA9D,EAAA8D,iBAAA9D,EAAA8D,qBAAb9D,eAAAA,iBCAP,IAAOA,eAAP,SAAOA,GAAa,GAAA+F,IAAA,SAAAA,GAEhB,YAUA,IAAAC,GAAA,WAUI,QAAAA,GACWC,EACA1E,EACAC,GAFAnB,KAAA4F,GAAAA,EACA5F,KAAAkB,MAAAA,EACAlB,KAAAmB,mBAAAA,EA4Gf,MAzGWwE,GAAA1F,UAAA4F,uBAAP,WAAA,GAAAxE,GAAArB,KAEQ8F,EAAgB9F,KAAK4F,GAAGG,OAkB5B,OAhBA/F,MAAKkB,MAAMM,IACPxB,KAAKmB,mBAAmBvB,OAAOoG,gBAC9B,gDACChG,KAAKmB,mBAAmBvB,OAAOqG,qBAEjCC,QAAQ,SAACtE,EAAWuE,EAAaC,EAAcxG,GAC3C,GAAIyG,GAAkBhF,EAAKiF,mCAAmCjF,EAAKkF,UAAUC,EAAEC,SAAS7E,IACxFkE,GAASY,QAAQL,KAGrBM,MAAM,SAASC,GACXpE,QAAQC,IAAI,kCACZD,QAAQC,IAAImE,GACZd,EAASa,UAGVb,EAASe,SAGblB,EAAA1F,UAAAqG,mCAAP,SAA0C1E,GAKtC,IAAI,GAHAkF,GAAiBlF,EAAK,wBAAwBmF,gBAAgBC,YAC9DC,KAEIpF,EAAI,EAAGA,EAAIiF,EAAUhF,OAAQD,IACjCoF,EAAOC,KAAKJ,EAAUjF,GAAGsF,KAAK,SAElC,OAAOF,IAGJtB,EAAA1F,UAAAmH,iBAAP,WAAA,GAAA/F,GAAArB,KAEQ8F,EAAgB9F,KAAK4F,GAAGG,OAkB5B,OAhBA/F,MAAKkB,MAAMM,IACPxB,KAAKmB,mBAAmBvB,OAAOyH,gBAC9B,gDACCrH,KAAKmB,mBAAmBvB,OAAO0H,qBAEjCpB,QAAQ,SAACtE,EAAWuE,EAAaC,EAAcxG,GAC3CyB,EAAKkG,cAAgBlG,EAAKmG,6BAA6BnG,EAAKkF,UAAUC,EAAEC,SAAS7E,KACjFkE,EAASY,QAAQrF,EAAKkG,iBAG1BZ,MAAM,SAASC,GACXpE,QAAQC,IAAI,kCACZD,QAAQC,IAAImE,GACZd,EAASa,UAGVb,EAASe,SAIblB,EAAA1F,UAAAuH,6BAAP,SAAoC5F,GAKhC,IAAI,GAHAkF,GAAiBlF,EAAK6F,iBAAiBC,WAAWC,MAAMA,MACxDV,KAEIpF,EAAI,EAAGA,EAAIiF,EAAUhF,OAAQD,IACjCoF,EAAOC,KAAKJ,EAAUjF,GAAGsF,KAAK,SAElC,OAAOF,IAGJtB,EAAA1F,UAAAsG,UAAP,SAAiBqB,GAEb,GAAIC,KAEJ,IAAoB,GAAhBD,EAAIE,UAEJ,GAAIF,EAAIG,WAAWjG,OAAS,EAAG,CAC3B+F,EAAI,iBACJ,KAAK,GAAI1F,GAAI,EAAGA,EAAIyF,EAAIG,WAAWjG,OAAQK,IAAK,CAC5C,GAAI6F,GAAYJ,EAAIG,WAAWE,KAAK9F,EACpC0F,GAAI,eAAeG,EAAUE,UAAYF,EAAUG,gBAGpC,IAAhBP,EAAIE,WACXD,EAAMD,EAAIO,UAId,IAAIP,EAAIQ,gBACJ,IAAI,GAAIvG,GAAI,EAAGA,EAAI+F,EAAIS,WAAWvG,OAAQD,IAAK,CAC3C,GAAIoG,GAAOL,EAAIS,WAAWJ,KAAKpG,GAC3BqG,EAAWD,EAAKC,QACpB,IAA6B,mBAAlBL,GAAIK,GACXL,EAAIK,GAAYlI,KAAKuG,UAAU0B,OAC5B,CACH,GAAkC,mBAAvBJ,GAAIK,GAAc,KAAkB,CAC3C,GAAII,GAAMT,EAAIK,EACdL,GAAIK,MACJL,EAAIK,GAAUhB,KAAKoB,GAEvBT,EAAIK,GAAUhB,KAAKlH,KAAKuG,UAAU0B,KAI9C,MAAOJ,IAnHJlC,EAAAtF,SACH,KACA,QACA,sBAkHRsF,IAzHaD,GAAAC,eAAcA,EA2H3BrF,QACKC,OAAO,sCACPC,QAAQ,kBAAmB,KAAM,QAAS,qBACvC,SAACoF,EAAkB1E,EAAwBC,GAC3C,MAAA,IAAIxB,GAAa+F,eAAeC,eAAeC,EAAI1E,EAAOC,OA3IlDuE,EAAA/F,EAAA+F,iBAAA/F,EAAA+F,qBAAb/F,eAAAA,iBCEP,IAAOA,eAAP,SAAOA,GAAa,GAAA4I,IAAA,SAAAA,GAEhB,YAQA,IAAAC,GAAA,WAoBI,QAAAA,GACW5C,EACA1E,EACAnB,EACA0I,EACAC,EACAvH,EACAuE,GA3Bf,GAAArE,GAAArB,IAqBeA,MAAA4F,GAAAA,EACA5F,KAAAkB,MAAAA,EACAlB,KAAAD,WAAAA,EACAC,KAAAyI,sBAAAA,EACAzI,KAAA0I,qBAAAA,EACA1I,KAAAmB,mBAAAA,EACAnB,KAAA0F,eAAAA,EAnBX1F,KAAA2I,cAAwB,GAExB3I,KAAAK,SACI,KACA,QACA,aACA,wBACA,uBACA,qBACA,kBAaAL,KAAKD,WAAWwB,IAAI,qBAAsB,WAGtCF,EAAKuH,QAAUvH,EAAKF,mBAAmBvB,OAAOoG,gBAAkB,IAChE1F,QAAQuI,QAAQxH,EAAKF,mBAAmBvB,OAAOkJ,yBAA0B,SAACC,EAAYC,GAClF3H,EAAKuH,SAAWI,EAAK,IAAKD,EAAO,MAGrC1H,EAAKuH,QAAUvH,EAAKuH,QAAQK,MAAM,EAAG,IAGrC5H,EAAKqE,eAAeG,yBAAyBnE,KAAK,SAAC2E,GAC/ChF,EAAK6H,cAAgB7C,MAgLrC,MA3KImC,GAAAvI,UAAAkJ,cAAA,SAAcC,EAAeC,EAAgBC,GAA7C,GAAAjI,GAAArB,IAGIA,MAAKuJ,SAAU,EAGXvJ,KAAKwJ,iBACLxJ,KAAKwJ,eAAiBxJ,KAAKyI,sBAAsB9E,YAC7Ca,MAAO,GACPC,OAAQ,GACRS,UAAW,0BACXG,GAAI,sBAERrF,KAAKwJ,iBAIT,KAAI,GADAC,MACI5H,EAAI,EAAGA,EAAIuH,EAAStH,OAAQD,IAC7BuH,EAASvH,GAAGQ,YAAYoH,EAAevC,KAAKkC,EAASvH,GAAGO,KAG/D,IAAc,QAAXiH,EAAiB,CAEhB,GAAIK,GAAW,GAAIC,MAGnB,IAAGA,MAAMC,QAAQC,KAAK,CAKlB,IAAI,GAHAC,MAGIjI,EAAI,EAAGA,EAAI7B,KAAKkJ,cAAcpH,OAAQD,IAAI,CAE9C,GAAImB,GAAgBhD,KAAK+J,WAAWN,EAAgBH,EAAQD,GAASrJ,KAAKkJ,cAAcrH,KACpFgF,EAAe7G,KAAKkB,MAAMM,IAAIwB,EAClC8G,GAAS5C,KAAKL,GAGlB7G,KAAK4F,GAAGoE,IAAIF,GAAUpI,KAAK,SAACuI,GAExB,IAAI,GAAIpI,GAAI,EAAGA,EAAIoI,EAAQnI,OAAQD,IAAI,CAGnC,GAAIqI,IAA8BD,EAAQpI,GAAS,KAAEsI,MAAM,YAAYrI,MACvE,IAAIoI,EAAqB,EAAG,CAExB,GAAIE,GAAmB/I,EAAK6H,cAAcrH,GAAGwI,MAAM,KAAKC,KAAK,IAC7DZ,GAAIa,KAAKH,EAAU,OAAQH,EAAQpI,GAAS,KAAE,OAKtD,GAAI2I,GAAed,EAAIe,UAAUC,KAAK,QACtCC,QAAOH,EAAS,oBAEhBnJ,EAAKkI,SAAU,EACflI,EAAKqH,qBAAqBkC,KAAO,kBAIpC,CAED,IAAI,GAAI/I,GAAI,EAAGA,EAAI7B,KAAKkJ,cAAcpH,OAAQD,IAC1CgJ,OAAOC,KAAK9K,KAAK+J,WAAWN,EAAgBH,EAAQD,GAASrJ,KAAKkJ,cAAcrH,KAEpF7B,MAAKuJ,SAAU,OAMnBvJ,MAAK+K,UAAY/K,KAAK+J,WAAWN,EAAgBH,EAAQD,EAAQrJ,KAAKkJ,eACtElJ,KAAKuJ,SAAU,GAIvBf,EAAAvI,UAAA8J,WAAA,SAAWzH,EAAiBgH,EAAaD,EAAgBhD,GAkBrD,QAAA2E,GAAiBnD,GACb,IAAI,GAAIoD,KAAQpD,GACZ,GAAGA,EAAI5E,eAAegI,GAClB,OAAO,CAEf,QAAO,EArBX,GASIjI,GATAkI,EAAsBlL,KAAKmL,kBAAkB9E,GAG7C+E,EAAoB,yBAA2B9B,EAAO+B,KAAM,IAAK/B,EAAOgC,MAAO,IAAKhC,EAAOiC,KAAM,IAAKjC,EAAOkC,MAAO,IAEpHxK,EAAsB,GACtBP,KACAgL,EAAwB,iBAAiBpC,EAIzCqC,GAAuBV,EAAQvK,GAC/BkL,EAA8BlL,EAAQwC,eAAe,YACrD2I,KAAkCD,GAAuD,IAAhCE,OAAOC,KAAKrL,GAASqB,OAoClF,OAxBG4J,IAAcC,GAEb3L,KAAK2I,cAAgB,sBAAwBlI,EAAkB,SAAG,IAC9DmL,IACA5K,EAAchB,KAAK+L,WAAWtL,KAK9BiL,GAEJ1L,KAAK2I,cAAgB3I,KAAKgM,iBAAiB1J,GACvCsJ,IACA5K,EAAchB,KAAK+L,WAAWtL,KAMlCT,KAAK2I,cAAgB3I,KAAKgM,iBAAiB1J,GAG/CS,GAAG,OAAQ,QAAS,2BAA4B,QAAS,yBAA0BsG,GACnFrG,EAAShD,KAAK4I,QAAUsC,EAAiBO,EAAeL,EAAYpK,EAAchB,KAAK2I,eAM3FH,EAAAvI,UAAA8L,WAAA,SAAWtL,GAEP,GAAIwL,GAAuB,WAG3B,KAAI,GAAIC,KAAYzL,GAEA,aAAbyL,IACCD,EAAeA,EAAaE,OAAOD,EAAW,KAAOzL,EAAQyL,GAAW,cAKhF,OADAD,GAAeA,EAAaG,UAAU,EAAGH,EAAanK,OAAQ,IAKlE0G,EAAAvI,UAAA+L,iBAAA,SAAiB1J,GAGb,IAAI,GADAU,GAAgB,aACZnB,EAAI,EAAGA,EAAIS,EAAWR,OAAQD,IAClCmB,EAAQA,EAAMmJ,OAAO,aAAe7J,EAAWT,GAAK,YAMxD,OAHAmB,GAAQA,EAAMoJ,UAAU,EAAGpJ,EAAMlB,OAAQ,GACzCkB,EAAQA,EAAMmJ,OAAO,MAKzB3D,EAAAvI,UAAAkL,kBAAA,SAAkBlE,GAGd,IAAI,GADAjE,GAAgB,aACZnB,EAAI,EAAGA,EAAIoF,EAAOnF,OAAQD,IAC9BmB,EAAQA,EAAMmJ,OAAOlF,EAAOpF,GAAK,IAGrC,OADAmB,GAAQA,EAAMoJ,UAAU,EAAGpJ,EAAMlB,OAAS,IAGlD0G,IA1NaD,GAAAC,aAAYA,EA4NzBlI,QACKC,OAAO,0CACPC,QAAQ,2BACL,KACA,QACA,aACA,wBACA,uBACA,qBACA,iBACA,SACIoF,EACA1E,EACAnB,EACA0I,EACAC,EACAvH,EACAuE,GAEA,MAAA,IAAI/F,GAAa4I,mBAAmBC,aAChC5C,EACA1E,EACAnB,EACA0I,EACAC,EACAvH,EACAuE,OAhQA6C,EAAA5I,EAAA4I,qBAAA5I,EAAA4I,yBAAb5I,eAAAA,iBCJP,IAAOA,eAAP,SAAOA,GAAa,GAAA0M,IAAA,SAAAA,GAEhB,YAKA,IAAAC,GAAA,WAUI,QAAAA,GACW3L,EACA4L,EACA7D,EACA7H,EACAC,EACA0L,GALAxM,KAAAW,OAAAA,EACAX,KAAAuM,SAAAA,EACAvM,KAAA0I,qBAAAA,EACA1I,KAAAa,kBAAAA,EACAb,KAAAc,oBAAAA,EACAd,KAAAwM,wBAAAA,EAcf,MAXIF,GAAArM,UAAAkJ,cAAA,WAAA,GAAA9H,GAAArB,IAEIA,MAAKuM,SAAS,WACVlL,EAAKqH,qBAAqBkC,KAAO,WACjCvJ,EAAKmL,wBAAwBrD,cACzB9H,EAAKP,oBAAoByB,iBAAiBL,cAC1Cb,EAAKqH,qBAAqB+D,aAC1BpL,EAAKqH,qBAAqBgE,iBAxB/BJ,EAAAjM,SACH,SACA,WACA,uBACA,oBACA,sBACA,2BAsBRiM,IA9BaD,GAAAC,kBAAiBA,CA0C9B,IAAAK,GAAA,WAcI,QAAAA,GACW5M,EACAe,EACAK,GAjBf,GAAAE,GAAArB,IAeeA,MAAAD,WAAAA,EACAC,KAAAc,oBAAAA,EACAd,KAAAmB,mBAAAA,EAfXnB,KAAA4K,KAAe,YACf5K,KAAA4M,WAAqB,EAKrB5M,KAAAK,SACI,aACA,sBACA,sBASAL,KAAKD,WAAWwB,IAAI,qBAAsB,WACtCF,EAAKwL,cAAgBxL,EAAKF,mBAAmBvB,OAAOkN,4BAGxD9M,KAAKD,WAAWwB,IAAI,qBAAsB,SAACwL,EAAYnL,GACnDP,EAAKuJ,KAAO,iBACZvJ,EAAKqL,aAAe9K,IAsBhC,MAfI+K,GAAA1M,UAAA+M,UAAA,WACIhN,KAAK4M,WAAY,EACjB5M,KAAKD,WAAWK,WAAW,oBAAqB,uBAGpDuM,EAAA1M,UAAAgN,cAAA,WACI,GAAIC,GAAMrC,OAAOC,KAAK9K,KAAKmB,mBAAmBvB,OAAOuN,sBAAuB,SACzED,IACCA,EAAIE,SAIZT,EAAA1M,UAAAoN,mBAAA,SAAmBhE,GACfrJ,KAAKyM,aAAepD,GAE5BsD,IAhDaN,GAAAM,qBAAoBA,EAkDjCrM,QACKC,OAAO,uCACPC,QAAQ,wBAAyB,aAAc,sBAAuB,qBACnE,SACIT,EACAe,EACAK,GAEA,MAAA,IAAIxB,GAAa0M,gBAAgBM,qBAC7B5M,EACAe,EACAK,MAGXkC,WAAW,oBAAqBiJ,GAChChJ,UAAU,gBAAiB,WACxB,OACIC,YAAa,2BACbF,WAAaiJ,EACb9I,aAAc,qBAGrB8J,OAAO,kBAAmB,SAACC,GACxB,MAAO,UAACnE,GAEJ,GAAIA,EAAJ,CACA,IAAI,GAAIvH,GAAI,EAAGA,EAAIuH,EAAStH,OAAQD,IAChC,GAAGuH,EAASvH,GAAGQ,WAAY,OAAO,CAEtC,QAAO,QAhIHgK,EAAA1M,EAAA0M,kBAAA1M,EAAA0M,sBAAb1M,eAAAA,iBCEP,IAAOA,eAAP,SAAOA,GAAa,GAAA6N,IAAA,SAAAC,GAEhB,YAIA,IAAAC,GAAA,WAEI,QAAAA,GACW/M,EACAgN,EACAH,GAFAxN,KAAAW,OAAAA,EACAX,KAAA2N,kBAAAA,EACA3N,KAAAwN,oBAAAA,EAEf,MANWE,GAAArN,SAAW,SAAU,oBAAqB,uBAMrDqN,IAPaD,GAAAC,iBAAgBA,CAiB7B,IAAAE,GAAA,WAwBI,QAAAA,GACW7N,EACAmB,EACAyM,EACAE,EACAC,EACA3M,EACAsH,EACA/C,EACAgD,GAjCf,GAAArH,GAAArB,IAyBeA,MAAAD,WAAAA,EACAC,KAAAkB,MAAAA,EACAlB,KAAA2N,kBAAAA,EACA3N,KAAA6N,cAAAA,EACA7N,KAAA8N,cAAAA,EACA9N,KAAAmB,mBAAAA,EACAnB,KAAAyI,sBAAAA,EACAzI,KAAA0F,eAAAA,EACA1F,KAAA0I,qBAAAA,EA5BJ1I,KAAA+N,WAAqB,EAI5B/N,KAAAgO,YAAsB,gBACtBhO,KAAAiO,YAAsB,kCAEtBjO,KAAAK,SACI,aACA,QACA,oBACA,gBACA,gBACA,qBACA,wBACA,iBACA,wBAeAL,KAAKD,WAAWwB,IAAI,oBAAqB,SAACwL,EAAYnL,GAElDA,EAAKsM,SACDC,IAAKvM,EAAKwM,aAAaC,SACvBC,IAAK1M,EAAKwM,aAAaG,WAKxBlN,EAAKqH,qBAAqBkE,WAI1BvL,EAAKmN,kBAAoB5M,EAAKqB,eAAe,kBAG5C5B,EAAKtB,WAAWK,WAAW,yBAA0B,gBACrDiB,EAAKtB,WAAWK,WAAW,yBAA0BqO,QAAQ,EAAOzF,IAAK,gBAAiB0F,UAAU,IAEpGrN,EAAKsM,kBAAkBgB,WAAa/M,EACpCP,EAAKsM,kBAAkBiB,KAAO,cAC9BvN,EAAKsM,kBAAkBkB,aAAe,KAK9C7O,KAAKD,WAAWwB,IAAI,qBAAsB,WAGtCsM,EAAciB,6BAA6BpN,KAAK,SAAC0H,GAC7C/H,EAAK+H,SAAWA,IAIpB/H,EAAK0N,cACDC,OAAQ3N,EAAKF,mBAAmBvB,OAAOyH,gBACvCjF,KAAM,2BAkHtB,MA7GWwL,GAAA3N,UAAAgP,qBAAP,WACIjP,KAAKwO,kBAAoBxO,KAAKwO,kBAI3BZ,EAAA3N,UAAAiP,WAAP,WAEI,IAAIlP,KAAK+O,aAAa9L,eAAe,WAAajD,KAAK0F,eAAe6B,cAAc,CAChFvH,KAAK+O,aAAa9H,SAClB,KAAI,GAAIpF,GAAI,EAAGA,EAAI7B,KAAK0F,eAAe6B,cAAczF,OAAQD,IAC1D7B,KAAK+O,aAAa9H,OAAOC,KACrBlH,KAAKmB,mBAAmBvB,OAAOuP,wBAC/BnP,KAAK0F,eAAe6B,cAAc1F,IAK7C7B,KAAKoP,aAAapP,KAAK+O,eAGpBnB,EAAA3N,UAAAmP,aAAP,SAAoBC,GAApB,GAAAhO,GAAArB,IAEI+C,IAAG,OAAQ,QAAS,2BAA4B,QAAS,wBAAwBsM,EAAQjN,MAGzFpC,KAAK2N,kBAAkBiB,KAAO,cAC9B5O,KAAKsP,eAEL,IAAIC,GAAoBF,EAAQL,OAC5BQ,EAAyBH,EAAQpI,MAGlCsI,GAAUE,QAAQzP,KAAKgO,aAAe,KACrCuB,EAAYA,EAAUnD,UAAU,EAAImD,EAAUzN,OAAS9B,KAAKgO,YAAYlM,SAKzEyN,EAAUE,QAAQzP,KAAKiO,aAAgB,KAGlCuB,EADDxP,KAAK2N,kBAAkBkB,cAAgB,MACtBW,EAAa,KAGbA,EAAa,IAMrC,IAAIE,GAEA,4DAGYF,EACZ,oDAQCxP,KAAK2N,kBAAkBgB,WAAWT,QAAW,IAAG,IAChDlO,KAAK2N,kBAAkBgB,WAAWT,QAAW,IAAG,KAChDlO,KAAK2N,kBAAkBgB,WAAWT,QAAQI,IAAM,MAAQ,KACxDtO,KAAK2N,kBAAkBgB,WAAWT,QAAQC,IAAM,MAEjD,iBAAkBqB,EAClB,8HAUJxP,MAAKkB,MAAMM,IAAI+N,EAAYG,GAAaxJ,QAAQ,SAACtE,GAE7CP,EAAKsO,YAAc/N,EACnBP,EAAKiO,kBAER3I,MAAM,SAAS/E,EAAWuE,EAAaC,EAAcxG,GAClD4C,QAAQC,IAAI,oCACZzC,KAAK2P,YAAc,+HACnB3P,KAAKsP,mBAIN1B,EAAA3N,UAAAqP,cAAP,WAEOtP,KAAKwJ,eACJxJ,KAAK+N,WAAa/N,KAAK+N,WAIvB/N,KAAKwJ,eAAiBxJ,KAAKyI,sBAAsB9E,YAC7Ca,MAAO,GACPC,OAAQ,GACRS,UAAW,2BACXG,GAAI,4BAERrF,KAAKwJ,iBACLxJ,KAAK+N,WAAY,IAG7BH,IA1LaH,GAAAG,oBAAmBA,EA4LhCtN,QACKC,OAAO,wCACPC,QAAQ,uBACL,aACA,QACA,oBACA,gBACA,gBACA,qBACA,wBACA,iBACA,uBACA,SACIT,EACAmB,EACAyM,EACAE,EACAC,EACA3M,EACAsH,EACA/C,EACAgD,GAEA,MAAA,IAAI/I,GAAa6N,oBAAoBI,oBACjC7N,EACAmB,EACAyM,EACAE,EACAC,EACA3M,EACAsH,EACA/C,EACAgD,MAEXrF,WAAW,mBAAoB1D,EAAa6N,oBAAoBE,kBAChEpK,UAAU,oBAAqB,WAC5B,OACIC,YAAa,qCACbF,WAAaqK,EACblK,aAAc,qBA1PVgK,EAAA7N,EAAA6N,sBAAA7N,EAAA6N,0BAAb7N,eAAAA,iBCJP,IAAOA,eAAP,SAAOA,GAAa,GAAAgO,IAAA,SAAAA,GAEhB,YAeA,IAAAiC,GAAA,WAAA,QAAAA,KACW5P,KAAA4O,KAAe,QAG1B,MAAAgB,KAJajC,GAAAiC,kBAAiBA,EAM9BtP,QACKC,OAAO,6CACPC,QAAQ,qBAAsB,WAAM,MAAA,IAAIb,GAAagO,kBAAkBiC,sBAzB5DjC,EAAAhO,EAAAgO,oBAAAhO,EAAAgO,wBAAbhO,eAAAA,iBCIP,IAAOA,eAAP,SAAOA,GAAa,GAAAkQ,IAAA,SAAAA,GAEhB,YAGA,IAAAC,GAAA,WAGI,QAAAA,GACWnP,EACAoP,EACAlP,EACA8M,GAHA3N,KAAAW,OAAAA,EACAX,KAAA+P,iBAAAA,EACA/P,KAAAa,kBAAAA,EACAb,KAAA2N,kBAAAA,EAEf,MAPWmC,GAAAzP,SAAW,SAAU,mBAAoB,oBAAqB,qBAOzEyP,IATaD,GAAAC,mBAAkBA,CAkB/B,IAAAE,GAAA,WAoBI,QAAAA,GACWjQ,EACA2F,EACAvE,EACAwM,GAxBf,GAAAtM,GAAArB,IAqBeA,MAAAD,WAAAA,EACAC,KAAA0F,eAAAA,EACA1F,KAAAmB,mBAAAA,EACAnB,KAAA2N,kBAAAA,EAhBX3N,KAAAwO,kBAA4B,EAC5BxO,KAAAiQ,eAAyB,EAEzBjQ,KAAAkQ,kBAA4B,GAE5BlQ,KAAAK,SACI,aACA,iBACA,qBACA,qBASAL,KAAKD,WAAWwB,IAAI,qBAAsB,WACtCF,EAAK8O,SAyFjB,MArFWH,GAAA/P,UAAAkQ,KAAP,WAAA,GAAA9O,GAAArB,IAEIA,MAAKoQ,cAAgBpQ,KAAKmB,mBAAmBvB,OAAOyH,gBACpDrH,KAAKG,IAAMH,KAAKmB,mBAAmBhB,IACnCH,KAAKqQ,kBAAoB,IAAK,IAAK,IAAK,IAGxCrQ,KAAKkQ,kBAAoB,IACzB5P,QAAQuI,QAAQ7I,KAAKmB,mBAAmBvB,OAAO0Q,yBAA0B,SAACvH,EAAYC,GAClF3H,EAAK6O,mBAAqBlH,EAAK,IAAKD,EAAO,MAG/C/I,KAAKkQ,kBAAoBlQ,KAAKkQ,kBAAkBjH,MAAM,EAAG,IAAM,UAE/DjJ,KAAK0F,eAAe0B,mBAAmB1F,KAAK,SAACuF,GACzC5F,EAAK4F,OAASA,EACd5F,EAAKkP,mBAINP,EAAA/P,UAAAuQ,aAAP,WAQI,MANAxQ,MAAKyQ,eAAiBzQ,KAAKyQ,cACxBzQ,KAAK0Q,SACJ1Q,KAAK0Q,SAASC,KAAO3Q,KAAKyQ,cAE1BzQ,KAAK4Q,oBAEF5Q,KAAKyQ,eAGTT,EAAA/P,UAAA4Q,cAAP,WACI7Q,KAAKiQ,eAAiBjQ,KAAKiQ,aAC3B,KAAI,GAAIa,KAAU9Q,MAAK+Q,WACnB/Q,KAAK+Q,WAAWD,GAAoB,WAAI9Q,KAAKiQ,eAIrDD,EAAA/P,UAAAsQ,cAAA,WAEIvQ,KAAK+Q,aACL,KAAI,GAAIlP,GAAI,EAAGA,EAAI7B,KAAKiH,OAAOnF,OAAQD,IAEnC7B,KAAK+Q,WAAW/Q,KAAKiH,OAAOpF,KACxBmP,UAAYhR,KAAKoQ,cAAgBpQ,KAAKkQ,kBAAoBlQ,KAAKiH,OAAOpF,GACtEQ,YAAa,IAKzB2N,EAAA/P,UAAA2Q,kBAAA,WAEI,GAAIpB,KACJ,KAAI,GAAIsB,KAAU9Q,MAAK+Q,WACf/Q,KAAK+Q,WAAW9N,eAAe6N,IAAW9Q,KAAK+Q,WAAWD,GAAoB,cAAM,GACpFtB,EAAatI,KAAK4J,EAIvB9Q,MAAK0Q,UACJ1Q,KAAKG,IAAI8Q,OAAOjR,KAAK0Q,UAGzB3N,GAAG,OAAQ,QAAS,2BAA4B,QAAS,4BAA4ByM,EAAa0B,YAElGlR,KAAK0Q,SAAWS,EAAEC,UAAUC,IAAIrR,KAAKoQ,eACjCnJ,OAAQuI,EAAa0B,WACrBI,aAAa,EACbjI,OAAQ,cAEZrJ,KAAKG,IAAIoR,SAASvR,KAAK0Q,WAe/BV,IApHaH,GAAAG,iBAAgBA,EAsH7B1P,QACKC,OAAO,wCACPC,QAAQ,oBAAqB,aAAc,iBAAkB,qBAAsB,oBAChF,SACIT,EACA2F,EACAvE,EACAwM,GAEA,MAAA,IAAIhO,GAAakQ,cAAcG,iBAAiBjQ,EAAY2F,EAAgBvE,EAAoBwM,MACvGtK,WAAW,qBAAsByM,GACjCxM,UAAU,uBAAwB,WAC/B,OACIC,YAAa,kCACbF,WAAayM,EACbtM,aAAc,uBA5JVqM,EAAAlQ,EAAAkQ,gBAAAlQ,EAAAkQ,oBAAblQ,eAAAA,iBCFP,IAAOA,eAAP,SAAOA,GAAa,GAAA6R,IAAA,SAAAA,GAEhB,YAMA,IAAAC,GAAA,WAII,QAAAA,GACW9Q,EACAE,EACA2M,GAPf,GAAAnM,GAAArB,IAKeA,MAAAW,OAAAA,EACAX,KAAAa,kBAAAA,EACAb,KAAAwN,oBAAAA,EALXxN,KAAA0R,YAAsB,GAOlB1R,KAAKW,OAAOY,IAAI,yBAA0B,SAACwL,EAAYnL,GACnDP,EAAKqQ,YAAc9P,IAO/B,MAHI6P,GAAAxR,UAAA0R,eAAA,SAAeD,GACX1R,KAAK0R,YAAe1R,KAAK0R,aAAeA,EAAeA,EAAc,IAZlED,EAAApR,SAAW,SAAU,oBAAqB,uBAcrDoR,IAjBaD,GAAAC,eAAcA,CAyB3B,IAAAG,GAAA,WAYI,QAAAA,GACW7R,EACAa,EACAmP,EACA5O,GAHAnB,KAAAD,WAAAA,EACAC,KAAAY,eAAAA,EACAZ,KAAA+P,iBAAAA,EACA/P,KAAAmB,mBAAAA,EAbXnB,KAAA6R,iBAA2B,EAC3B7R,KAAA8R,eAAyB,EAoC7B,MAZWF,GAAA3R,UAAAkQ,KAAP,SAAYhQ,EAAUP,GAClBI,KAAKG,IAAMA,EACXH,KAAKmB,mBAAmBjB,UAAUN,EAAQO,IAGvCyR,EAAA3R,UAAA8R,eAAP,WACI/R,KAAK6R,gBAAkB7R,KAAKY,eAAemR,kBAGxCH,EAAA3R,UAAAuQ,aAAP,WACIxQ,KAAK8R,cAAgB9R,KAAK+P,iBAAiBS,gBAhCxCoB,EAAAvR,SACH,aACA,iBACA,mBACA,sBA8BRuR,IAxCaJ,GAAAI,kBAAiBA,EA0C9BtR,QACKC,OAAO,2CACPC,QAAQ,qBACL,aAAc,iBAAkB,mBAAoB,qBACpD,SACIT,EACAa,EACAmP,EACA5O,GAEA,MAAA,IAAIxB,GAAa6R,aAAaI,kBAAkB7R,EAAYa,EAAgBmP,EAAkB5O,MAErGkC,WAAW,iBAAkBoO,GAC7BnO,UAAU,oBAAqB,WAC5B,OACIC,YAAa,+BACbF,WAAaoO,EACbjO,aAAc,qBA5FVgO,EAAA7R,EAAA6R,eAAA7R,EAAA6R,mBAAb7R,eAAAA,iBCEP,IAAOA,eAAP,SAAOA,GAAa,GAAAqS,IAAA,SAAAA,GAEhB,YAGA,IAAAC,GAAA,WAEI,QAAAA,GACWtR,EACAuR,EACArR,GAFAb,KAAAW,OAAAA,EACAX,KAAAkS,wBAAAA,EACAlS,KAAAa,kBAAAA,EAEf,MANWoR,GAAA5R,SAAW,SAAU,0BAA2B,qBAM3D4R,IAPaD,GAAAC,qBAAoBA,CA4BjC,IAAAE,GAAA,WAII,QAAAA,GACIC,EACAC,GAEArS,KAAKoS,MAAQA,EACbpS,KAAKqS,MAAQA,EAMrB,MAHWF,GAAAlS,UAAAqS,KAAP,WACI,MAAOtS,MAAKqS,MAAQrS,KAAKoS,OAEjCD,IAfaH,GAAAG,YAAWA,CAiBxB,IAAAI,GAAA,WAkCI,QAAAA,GACWrR,EACAnB,EACAwM,EACAiG,EACA/J,EACAtH,EACAsR,EACArR,GA1Cf,GAAAC,GAAArB,IAmCeA,MAAAkB,MAAAA,EACAlB,KAAAD,WAAAA,EACAC,KAAAuM,SAAAA,EACAvM,KAAAwS,iBAAAA,EACAxS,KAAAyI,sBAAAA,EACAzI,KAAAmB,mBAAAA,EACAnB,KAAAyS,oBAAAA,EACAzS,KAAAoB,mBAAAA,EAxCJpB,KAAA0S,YAAsB,QACtB1S,KAAA2S,WAAqB,EAOrB3S,KAAA4S,YAAsB,IAkCzB5S,KAAKD,WAAWwB,IAAI,qBAAsB,WACtCF,EAAK8O,SA0MjB,MA/LIoC,GAAAtS,UAAAkQ,KAAA,WAEInQ,KAAKG,IAAMH,KAAKmB,mBAAmBhB,IACnCH,KAAK6S,WAAa7S,KAAKmB,mBAAmBvB,OAAOkT,gBAG9C9S,KAAKmB,mBAAmBvB,OAAOmT,mBAqC/BR,EAAAtS,UAAA+S,kBAAP,WAAA,GAAA3R,GAAArB,IAGOA,MAAKiT,eACJC,SAASC,eAAe,iCAAiC3N,MAAM4N,QAAU,SAGzEpT,KAAKiT,eAAiBjT,KAAKyI,sBAAsB9E,YAC7Ca,MAAO,IACPC,OAAQ,IACRS,UAAW,iCACXG,GAAI,kBAERrF,KAAKiT,iBAGT,IAAII,GACA,SAASrT,KAAKwS,iBAAiBc,UAC/B,MAAOtT,KAAKuT,UAAUhF,UACtB,MAAOvO,KAAKuT,UAAUlF,SACtBrO,KAAKoB,mBAAmBJ,YAExBgC,EAAgBhD,KAAK6S,WAAa,QAAUQ,CAEhD7Q,SAAQC,IAAI,SACZD,QAAQC,IAAIO,GAEZhD,KAAKkB,OAEDsS,OAAQ,MACRC,IAAKzQ,IAENtB,KAAK,SAACC,GAEFA,EAASsB,eAAe,SACvB5B,EAAKoR,oBAAoBiB,WAAW/R,EAASC,QAIrDmB,GAAG,OAAQ,QAAS,2BAA4B,QAAS,qCAGtDwP,EAAAtS,UAAA0T,iBAAP,WACI3T,KAAK4T,WAAa5T,KAAK4S,YAEvBpQ,QAAQC,IAAI,oBAAqBzC,KAAK4T,WAEtC5T,KAAK6T,oBAGFtB,EAAAtS,UAAA4T,iBAAP,WAAA,GAAAxS,GAAArB,IAEIwC,SAAQC,IAAI,oBAGTzC,KAAK8T,YACJZ,SAASC,eAAe,+BAA+B3N,MAAM4N,QAAU,SAGvEpT,KAAK8T,YAAc9T,KAAKyI,sBAAsB9E,YAC1Ca,MAAO,IACPC,OAAQ,IACRS,UAAW,+BACXG,GAAI,gCAERrF,KAAK8T,cAGT,IAAIT,GACA,SAASrT,KAAKwS,iBAAiBc,UAC/B,aAAatT,KAAK4S,YAClB,eAAgB5S,KAAK4T,UACrB,MAAO5T,KAAKuT,UAAUhF,UACtB,MAAOvO,KAAKuT,UAAUlF,SACtBrO,KAAKoB,mBAAmBJ,YAExBgC,EAAgBhD,KAAK6S,WAAa,WAAaQ,CAEnD7Q,SAAQC,IAAI,kBACZD,QAAQC,IAAIO,GAEZhD,KAAKkB,OAEDsS,OAAQ,MAMRC,IAAKzQ,IAENtB,KAAK,SAACC,GAEFA,EAASsB,eAAe,SAEvB5B,EAAKkL,SAAS,WAEV2G,SAASC,eAAe,+BAA+B3N,MAAM4N,QAAU,OACvE/R,EAAKsR,WAAY,EAGK,GAAlBtR,EAAKuS,UACLvS,EAAK0S,aAAa3K,SAAW/H,EAAK0S,aAAa3K,SAAS+C,OAAOxK,EAASC,KAAKwH,UAG7E/H,EAAK0S,aAAepS,EAASC,IAEjBP,GAAK0S,aAAa3K,SAAStH,OAAST,EAAK0S,aAAaC,aACtE3S,GAAK4S,YAAc,GAAI9B,GAAY9Q,EAAK0S,aAAa3K,SAAStH,OAAQT,EAAK0S,aAAaC,gBACzF,OAIXjR,GAAG,OAAQ,QAAS,2BAA4B,QAAS,+CAAgD/C,KAAK4T,UAAW,MAG7HrB,EAAAtS,UAAAiU,eAAA,SAAeC,KAUf5B,EAAAtS,UAAAmU,oBAAA,SAAoBC,GAChBrU,KAAKsU,iBAAmBD,GAG5B9B,EAAAtS,UAAAsU,eAAA,SAAelP,EAASmP,GAEpB,GAAIzM,GAAa/H,KAAKsU,iBAAiBG,8BAA8BpP,EAElE0C,IAAcyM,IACbzM,EAAW2M,UAAY3M,EAAW4M,MAClC5M,EAAW4M,MAAQ,YAI3BpC,EAAAtS,UAAA2U,iBAAA,WACI,GAAG5U,KAAK6U,SAAS,CACb,GAAI9M,GAAa/H,KAAKsU,iBAAiBG,8BAA8BzU,KAAK6U,SACvE9M,IAAcA,EAAW9E,eAAe,eACvC8E,EAAW4M,MAAQ5M,EAAW2M,aA5NnCnC,EAAAlS,SACH,QACA,aACA,WACA,mBACA,wBACA,qBACA,sBACA,sBAwNRkS,IAvPaP,GAAAO,wBAAuBA,EAyPpCjS,QACKC,OAAO,+CACP8C,WAAW,uBAAwB4O,GACnC3O,UAAU,6BAA8B,WACrC,OACIC,YAAa,mCACbF,WAAa4O,EACbzO,aAAc,wBAGrBhD,QAAQ,2BACL,QACA,aACA,WACA,mBACA,wBACA,qBACA,sBACA,qBACJ,SACIU,EACAnB,EACAwM,EACAiG,EACAsC,EACA3T,EACAsR,EACArR,GAEA,MAAA,IAAIzB,GAAaqS,iBAAiBO,wBAC9BrR,EACAnB,EACAwM,EACAiG,EACAsC,EACA3T,EACAsR,EACArR,OAhVI4Q,EAAArS,EAAAqS,mBAAArS,EAAAqS,uBAAbrS,eAAAA,iBCCP,IAAOA,eAAP,SAAOA,GAAa,GAAAoV,IAAA,SAAAA,GAEhB,YAiBA,IAAAC,GAAA,WAuCI,QAAAA,GACWjV,EACAoB,GAzCf,GAAAE,GAAArB,IAwCeA,MAAAD,WAAAA,EACAC,KAAAmB,mBAAAA,EArCXnB,KAAAiV,YACI,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KACA,IACA,IACA,KAGA,KACA,IACA,KACA,KAKJjV,KAAAkV,eACI7J,KAAQ,IACRC,MAAS,IACTC,KAAQ,IACRC,MAAS,IAoBNxL,KAAAmV,eAAiB,WACpB9T,EAAK+T,aAAe/T,EAAKlB,KAErBkB,EAAKgU,iBAAiB5Q,OAAS,IAAMpD,EAAKiU,SAASjU,EAAKgU,iBAAiB5Q,SAAWpD,EAAKiS,WACzFhP,KAAKiR,IAAIlU,EAAK+T,aAAa/G,SAAWhN,EAAKgU,iBAAiBhH,UAAY,IAAOhN,EAAKiS,WACpFhP,KAAKiR,IAAIlU,EAAK+T,aAAa7G,UAAYlN,EAAKgU,iBAAiB9G,WAAa,IAAOlN,EAAKiS,WACpE,IAAlBjS,EAAKiS,YAELjS,EAAKtB,WAAWK,WAAW,wBAAyBiB,EAAKiS,WAG7D9Q,QAAQC,IAAI,WAAapB,EAAKiS,WAE9BjS,EAAKgU,iBAAmBhU,EAAK+T,cArB7BpV,KAAKD,WAAWwB,IAAI,qBAAsB,WACtCF,EAAKlB,IAAMkB,EAAKF,mBAAmBhB,MAsD/C,MAlDI0L,QAAA2J,eAAWR,EAAA/U,UAAA,aC2tCHuB,ID3tCR,WACG,MAAOxB,MAAKsV,SAAStV,KAAKoV,aAAa3Q,SC6tClCgR,YAAY,EACZC,cAAc,IDrsCfV,EAAA/U,UAAAqV,SAAP,SAAgB7Q,GACZ,IAAI,GAAI5C,GAAI,EAAGA,EAAI7B,KAAKiV,WAAWnT,OAAQD,IACvC,GAAG4C,EAASzE,KAAKiV,WAAWpT,GACxB,MAAO7B,MAAKiV,WAAWnT,OAASD,CAGxC,OAAO7B,MAAKiV,WAAWnT,OAAS,GAG7BkT,EAAA/U,UAAA0V,UAAP,SAAiBC,GACdpT,QAAQC,IAAI,qBAWRuS,EAAA/U,UAAA4V,cAAP,SAAqBC,GAClB,MAAO,IA9DHd,EAAA3U,SACH,aACA,sBA8DR2U,IAlGaD,GAAAC,iBAAgBA,EAoG7B1U,QACKC,OAAO,mCACPC,QAAQ,oBAAqB,aAAc,qBACxC,SACIT,EACAoB,GACC,MAAA,IAAIxB,GAAaoV,KAAKC,iBAAiBjV,EAAYoB,OA7HhD4T,EAAApV,EAAAoV,OAAApV,EAAAoV,WAAbpV,eAAAA,iBEEP,IAAOA,eAAP,SAAOA,GAAa,GAAAiB,IAAA,SAAAA,GAEhB,YAaA,IAAAmV,GAAA,WAAA,QAAAA,MAIA,MAHIA,GAAA9V,UAAA+V,mBAAA,SAAmBjB,GACf,MAAOzQ,MAAK2R,IAAI,KAAMlB,IAE9BgB,IAJanV,GAAAmV,sBAAqBA,CAMlC,IAAAG,GAAA,WAkBG,QAAAA,GACYhV,EACAnB,EACAyS,EACAC,EACAhK,EACAtH,EACA+Q,EACA9Q,GA1Bf,GAAAC,GAAArB,IAmBeA,MAAAkB,MAAAA,EACAlB,KAAAD,WAAAA,EACAC,KAAAwS,iBAAAA,EACAxS,KAAAyS,oBAAAA,EACAzS,KAAAyI,sBAAAA,EACAzI,KAAAmB,mBAAAA,EACAnB,KAAAkS,wBAAAA,EACAlS,KAAAoB,mBAAAA,EAtBJpB,KAAAmW,SAAmB,EAC3BnW,KAAAoW,cAAwB,GA6GvBpW,KAAA8C,UAAY,aArFV9C,KAAKD,WAAWwB,IAAI,qBAAsB,WACtCF,EAAKlB,IAAMkB,EAAKF,mBAAmBhB,IACnCkB,EAAKwR,WAAaxR,EAAKF,mBAAmBvB,OAAOkT,gBACjDzR,EAAK8O,SAsFf,MAlFG+F,GAAAjW,UAAAkQ,KAAA,WAID,QAAAkG,GAAiBtJ,GACX/M,KAAKsW,QACRtW,KAAKG,IAAIoW,YAAYvW,KAAKsW,OAC1BtW,KAAKsW,MAAQ,KAGb,IAAIE,KAAqBxW,KAAKmW,SAC1BpB,EAAO/U,KAAKG,IAAIsW,UAChBC,EAAS1W,KAAKG,IAAIwW,YAClBC,IACJA,GAAM1P,KAAK,QAAU5C,KAAKuS,IAAIH,EAAOI,UAAY,GAAGxS,KAAK2R,IAAIlB,EAAM,KAAM,QACzE6B,EAAM1P,KAAK,QAAU5C,KAAKC,IAAImS,EAAOK,UAAY,GAAGzS,KAAK2R,IAAIlB,EAAM,KAAM,MACzE6B,EAAM1P,KAAK,QAAU5C,KAAKuS,IAAIH,EAAOM,WAAa,GAAG1S,KAAK2R,IAAIlB,EAAM,KAAM,MAC1E6B,EAAM1P,KAAK,QAAU5C,KAAKC,IAAImS,EAAOO,WAAa,GAAG3S,KAAK2R,IAAIlB,EAAM,KAAM,KAC1E6B,EAAM1P,KAAK,QAAW5C,KAAKuS,IAAI9B,EAAM,GAYvC/U,MAAKkB,MAAMM,IAAIxB,KAAK6S,WAAa,IAAM+D,EAAMtM,KAAK,MAAM5I,KAAK,SAASwV,GACrE,KAAGV,EAAmBxW,KAAKmW,UAA3B,CAGA,GAAIgB,GAAY7S,KAAK8S,KAAKlT,GAAG2S,IAAIK,EAAOtV,KAAKwH,SAAU,SAASnB,GAC/D,MAAOA,GAAK3F,WAAW8P,QAGxBpS,MAAKsW,MAAQnF,EAAEkG,QAAQH,EAAOtV,MAC1B0V,aAAc,SAAUjI,EAASkI,GAChC,GAAIC,IACAnT,OAAQ,EAAI,GAAG8S,EAAY7S,KAAK8S,KAAK/H,EAAQ/M,WAAW8P,OACxDqF,UAAW,UACX9C,MAAO,OACP+C,OAAQ,EACRC,QAAS,EACTC,YAAa,IAEVC,EAAS1G,EAAE2G,aAAaP,EAAQC,GAClCO,UAAU,GAAK1I,EAAQ/M,WAAW8P,OAAS4F,QAAQ,GAWrD,OATAH,GAAOI,GAAG,QAAS,WACTjY,KAAKqP,QAAQhK,GAAGgF,MAAM,OAQzBwN,KAEZK,MAAMlY,KAAKG,QA7DZH,KAAKG,IAAI8X,GAAG,UAAW5B,GACvBrW,KAAKG,IAAI8X,GAAG,UAAW5B,IAiE1BH,EAAAjW,UAAA8R,eAAA,WACG,OAAO,GAjGHmE,EAAA7V,SACF,QACA,aACA,mBACA,sBACA,wBACA,qBACA,0BACA,sBAuGR6V,IAtHatV,GAAAsV,eAAcA,EAwH3B5V,QACKC,OAAO,uCACPC,QAAQ,kBACL,QACA,aACA,mBACA,sBACA,wBACA,qBACA,0BACA,qBACJ,SACIU,EACAnB,EACAyS,EACAC,EACAqC,EACA3T,EACA+Q,EACA9Q,GAEJ,MAAA,IAAIzB,GAAaiB,eAAesV,eAC5BhV,EACAnB,EACAyS,EACAC,EACAqC,EACA3T,EACA+Q,EACA9Q,OA1KQR,EAAAjB,EAAAiB,iBAAAjB,EAAAiB,qBAAbjB,eAAAA,iBCLP,IAAOA,eAAP,SAAOA,GAAa,GAAAwY,IAAA,SAAAA,GAEhB,YAGA,IAAAC,GAAA,WAGI,QAAAA,GACWzX,EACA8R,EACA7R,GAFAZ,KAAAW,OAAAA,EACAX,KAAAyS,oBAAAA,EACAzS,KAAAY,eAAAA,EAEf,MANWwX,GAAA/X,SAAW,SAAU,sBAAuB,kBAMvD+X,IARaD,GAAAC,iBAAgBA,CAe7B,IAAAC,GAAA,WAOI,QAAAA,GACWnX,EACAnB,GADAC,KAAAkB,MAAAA,EACAlB,KAAAD,WAAAA,EAoUf,MAhUWsY,GAAApY,UAAAqY,UAAP,WACItY,KAAKD,WAAWK,WAAW,gBACvBmY,eAAe,KAIhBF,EAAApY,UAAAyT,WAAP,SAAkB8E,GAEdtF,SAASC,eAAe,4BAA4BsF,UAAY,GAGhEzY,KAAKD,WAAWK,WAAW,gBACvBmY,cAAe,uBAInB,IAAIjW,KACJhC,SAAQuI,QAAQ2P,EAAQlW,WAAY,SAAC4J,EAAelD,GAChD,GAAI0P,KACJpY,SAAQuI,QAAQqD,EAAU,SAAClE,EAAgB2Q,GACvCD,EAAaxR,MAAO0R,cAAeD,EAAQvG,MAAOpK,MAEtD1F,EAAW4E,MAAO2R,aAAc7P,EAAKpH,KAAM8W,KAM/C,IAGIlU,GACAC,EACAqU,EACAC,EANAC,EAAmB,KACnBC,EAAoB,IACpBC,EAAkB5W,EAAWR,OAAS,EAAKQ,EAAWR,OAAS,CAMnC,KAA7BoR,SAASiG,KAAKC,aAAsBH,GAAa/F,SAASiG,KAAKE,YAAcL,GAC5EF,GAAYQ,IAAK,EAAGC,MAAO,GAAIC,OAAQ,EAAGC,KAAM,IAChDjV,EAAQ0O,SAASiG,KAAKE,YAAcH,GAAkB,EAAIJ,EAAQW,KAAOX,EAAQS,OACjF9U,EAAsC,IAA7ByO,SAASiG,KAAKC,aACvBL,EAAa,KAGbD,GAAYQ,IAAK,EAAGC,MAAO,EAAGC,OAAQ,EAAGC,KAAM,GAC/CjV,EAAQwU,EAAWE,GAAkB,EAAIJ,EAAQW,KAAOX,EAAQS,OAChE9U,EAASwU,EACTF,EAAa,GAGjB,IAAIW,GAAqBxG,SAASiG,KAAKE,aAAe,EAAIP,EAAQW,KAAOX,EAAQS,OAC7ElV,EAAcC,KAAKC,IAAIC,EAAOC,GAAU,CAI5CnC,GAAWuG,QAAQ,SAACqD,GA8HhB,QAAAyN,GAAoB/X,EAAWgY,EAAuBC,EAAgBC,GAElE,GAAIhJ,GAASjM,EAAIkV,UAAU,aACtBnY,KAAKA,GACLoY,QAAQ7U,OAAO,KACfC,KAAK,QAAQ,WACbA,KAAK,YAAa,SAAU6U,EAAQpY,GAAU,MAAO,eAAiB2C,EAAQ,KAAO,KAAO3C,GAAKqY,EAAcC,GAAmB1V,EAAS,GAAK,MAEjJ2V,EAAkBtJ,EAAO3L,OAAO,QAC/BC,KAAK,IAAK,IACVA,KAAK,QAAS8U,GACd9U,KAAK,SAAU8U,GACf9U,KAAK,QAAS,UACdI,MAAM,OAAO,SAASyU,EAAOpY,GAAQ,MAAO8S,GAAMsF,EAAErB,iBAErDyB,EAAkBvJ,EAAO3L,OAAO,QAC/BC,KAAK,IAAK,IACVA,KAAK,IAAK,GACVA,KAAK,KAAM,SACXI,MAAM,cAAe,SACrB8U,KAAK,SAAUL,GAEZ,GAAIM,IAAqBlW,EAAS,IAAM,CACxC,OAAG4V,GAAErB,cAAc9W,OAASyY,EACjBN,EAAErB,cAAcxM,UAAU,EAAEmO,GAAW,MAEvCN,EAAErB,eAarB,IATAwB,EAAWjV,OAAO,aAAamV,KAAK,SAAUL,GAC1C,GAAI5H,GAAgBnO,GAAGsW,IAAItO,EAAStK,KAAKzB,IAAI,SAAS8Z,GAAU,MAAOA,GAAE7H,QACzE,OAAO6H,GAAErB,cAAgB,KAAOtU,KAAKmW,MAAM,IAAOR,EAAE7H,MAAQC,GAAS,GAAK,OAE9EgI,EAAWlV,OAAO,aAAamV,KAAK,SAAUL,GAC1C,GAAI5H,GAAgBnO,GAAGsW,IAAItO,EAAStK,KAAKzB,IAAI,SAAS8Z,GAAU,MAAOA,GAAE7H,QACzE,OAAO6H,GAAErB,cAAgB,KAAOtU,KAAKmW,MAAM,IAAOR,EAAE7H,MAAQC,GAAS,GAAK,OAG3EyH,EAAa,EAAE,CAEd,GAAIY,GAAgB7V,EAAIM,OAAO,KAC1BC,KAAK,QAAQ,UACbA,KAAK,YAAa,mBAA8BwU,EAAgB,IAAMM,EAAYC,GAAkB1V,EAAS,GAAK,IAEvHiW,GAASvV,OAAO,QAAQmV,KAAKT,EAAO,IAAIC,GACnC1U,KAAK,KAAK,QAEf,IAAIuV,GAAoB9V,EAAIM,OAAO,KAC9BC,KAAK,QAAQ,QACbA,KAAK,YAAa,mBAA8BwU,EAAgB,MAAQM,EAAYC,GAAkB1V,EAAS,GAAK,KACpHwT,GAAG,QAAQ2C,GACXpV,MAAM,SAAS,WAEhBqV,EAAoBhW,EAAIM,OAAO,KAC9BC,KAAK,QAAQ,QACbA,KAAK,YAAa,iBAA4BwU,EAAgB,MAAQM,EAAYC,GAAkB1V,EAAS,GAAK,KAClHwT,GAAG,QAAQ6C,GACXtV,MAAM,SAAS,UAEpBqV,GAAa1V,OAAO,WACfK,MAAM,SAAS,QACfA,MAAM,OAAO,QACbJ,KAAK,SAAS,oBAEnBuV,EAAaxV,OAAO,WACfK,MAAM,SAAS,QACfA,MAAM,OAAO,QACbJ,KAAK,SAAS,qBAEhByU,GAAUC,GACTe,EAAarV,MAAM,UAAU,OAC7BqV,EAAa5C,GAAG,QAAQ,IACnBzS,MAAM,SAAS,KAEN,GAAVqU,IACJc,EAAanV,MAAM,UAAU,OAC7BmV,EAAa1C,GAAG,QAAQ,IACnBzS,MAAM,SAAS,MAMhC,QAAAoV,KACIf,IAEAhV,EAAIkV,UAAU,aAAa9I,SAC3BpM,EAAII,OAAO,WAAWgM,SACtBpM,EAAII,OAAO,SAASgM,SACpBpM,EAAII,OAAO,SAASgM,QAMpB,KAAI,GAJA8J,IAAclB,EAAS,GAAKD,EAC5BoB,EAAWD,EAAanB,EACxBqB,KAEIpZ,EAAI,EAAGA,EAAIqK,EAAStK,KAAKE,OAAOD,IACjCA,GAAKkZ,GAAkBC,EAAJnZ,GAClBoZ,EAAW/T,KAAKgF,EAAStK,KAAKC,GAItC8X,GAAWsB,EAAYrB,EAAeC,EAAQC,GAGlD,QAAAgB,KAEIjB,IAEAhV,EAAIkV,UAAU,aAAa9I,SAC3BpM,EAAII,OAAO,WAAWgM,SACtBpM,EAAII,OAAO,SAASgM,SACpBpM,EAAII,OAAO,SAASgM,QAMpB,KAAI,GAJA8J,IAAclB,EAAS,GAAKD,EAC5BoB,EAAWD,EAAanB,EACxBsB,KAEIrZ,EAAI,EAAGA,EAAIqK,EAAStK,KAAKE,OAAQD,IAClCA,GAAKkZ,GAAkBC,EAAJnZ,GAClBqZ,EAAahU,KAAKgF,EAAStK,KAAKC,GAGxC8X,GAAWuB,EAAatB,EAAcC,EAAOC,GAvPjD,GAAInF,GAAazQ,GAAGiX,MAAMC,aAEtBvW,EAAWX,GAAGe,OAAO,6BACpBE,OAAO,OACPC,KAAK,QAASZ,GACdY,KAAK,SAAUX,GACfe,MAAM,cAAesT,EAAQW,KAAK,MAClCjU,MAAM,eAAgBsT,EAAQS,MAAM,MACpCpU,OAAO,KACPC,KAAK,YAAa,aAAgBZ,EAAQ,EAC3C,KAAQC,EAAS,EAAI,IAAM,KAE3BG,EAAWV,GAAGW,IAAID,MACjBE,YAAYT,EAAS0U,GACrBhU,YAAYV,GAEbgX,EAAWnX,GAAGoX,OAAOD,MACpBtS,MAAM,SAASkR;AAAU,MAAOA,GAAE7H,QAClCmJ,KAAK,MAENC,EAAetX,GAAGe,OAAO,6BACxBE,OAAO,OACPC,KAAK,QAAS,0BAEnBoW,GAAQrW,OAAO,OACVC,KAAK,QAAS,aAEnBoW,EAAQrW,OAAO,OACVC,KAAK,QAAS,SAEnBoW,EAAQrW,OAAO,OACVC,KAAK,QAAS,UAEnB,IAAIqW,GAAO5W,EAAIkV,UAAU,QACpBnY,KAAKyZ,EAAInP,EAAStK,OAClBoY,QACA7U,OAAO,QACPC,KAAK,IAAKR,GACVQ,KAAK,OAAQ,SAAS6U,EAAQpY,GAC3B,MAAO8S,GAAMsF,EAAErY,KAAKgX,iBAEvB8C,KAAK,SAASzB,GAAUja,KAAK2b,SAAW1B,GAE7CwB,GAAKxD,GAAG,YAAa,SAASgC,GAE1B,GAAI5H,GAAQnO,GAAGsW,IAAItO,EAAStK,KAAKzB,IAAI,SAAS8Z,GAC1C,MAAOA,GAAE7H,SAGTwJ,EAAetX,KAAKmW,MAAM,IAAOR,EAAErY,KAAKwQ,MAAQC,GAAS,EAC7DmJ,GAAQvW,OAAO,cAAc4W,KAAK5B,EAAErY,KAAKgX,eACzC4C,EAAQvW,OAAO,UAAU4W,KAAK,UAAU5B,EAAErY,KAAKwQ,OAC/CoJ,EAAQvW,OAAO,YAAY4W,KAAK,YAAYD,EAAU,KACtDJ,EAAQhW,MAAM,UAAW,WAG7BiW,EAAKxD,GAAG,WAAY,WAChBuD,EAAQhW,MAAM,UAAW,UAG7BiW,EAAKxD,GAAG,YAAa,SAASgC,GAE1B,GAAI6B,GAAa5X,GAAG6I,MAAMgP,MAAQrC,EAAa,IAAOxV,GAAG6I,MAAMgP,MAAQ,IAAM7X,GAAG6I,MAAMgP,MAClFC,EAAa9X,GAAG6I,MAAMkP,MAAQ/I,SAASiG,KAAKC,aAAe,IAAOlV,GAAG6I,MAAMkP,MAAQ,IAAM/X,GAAG6I,MAAMkP,MAAQ,EAE9GT,GACKhW,MAAM,MAAOwW,EAAI,MACjBxW,MAAM,OAAQsW,EAAI,QAI3BjX,EAAIM,OAAO,KACNC,KAAK,QAAS,+BACdD,OAAO,QACPC,KAAK,IAAK,GACVA,KAAK,MAASX,EAAS,EAAK,IAC5BW,KAAK,KAAM,SACXI,MAAM,cAAe,UACrBA,MAAM,OAAQ,QACdA,MAAM,cAAe,QACrB8U,KAAKpO,EAAS2M,aAInB,IAKIe,GACAE,EACAD,EAPAqC,EAAsBhQ,EAAStK,KAAKE,OACpCoY,EAAsB,GACtBC,EAAwB,EAExBgC,GAA2BjC,EAAcC,GAAiB+B,CAK9D,IAAIC,EAAkB9X,EAAU,EAAE,CAE9BuV,EAAgBtV,KAAK8X,MAAO/X,GAAU6V,EAAcC,IACpDL,EAAaxV,KAAK+X,KAAKH,EAActC,GACrCC,EAAS,CAMT,KAAI,GAJAkB,IAAsBlB,EAAS,GAAKD,EACpCoB,EAAmBD,EAAanB,EAChCqB,KAEIpZ,EAAI,EAAGA,EAAIqK,EAAStK,KAAKE,OAAQD,IACjCA,GAAKkZ,GAAkBC,EAAJnZ,GACnBoZ,EAAW/T,KAAKgF,EAAStK,KAAKC,GAItC8X,GAAWsB,EAAYrB,EAAeC,EAAQC,OAG9CH,GAAWzN,EAAStK,KAAM0C,KAAK8X,MAAM/X,GAAU6V,EAAcC,IAAiB,EAAG,KA+IzFjH,SAASC,eAAe,4BAA4B3N,MAAM4N,QAAU,OAEpEhP,WAAW,WACP8O,SAASC,eAAe,iCAAiC3N,MAAM4N,QAAU,OACzEF,SAASC,eAAe,4BAA4B3N,MAAM4N,QAAU,SACrE,OAvUAiF,EAAAhY,SACH,QACA,cAyURgY,IA7UaF,GAAAE,oBAAmBA,EA+UhC/X,QACKC,OAAO,qCACPC,QAAQ,uBAAwB,QAAS,aACtC,SAACU,EAAwBnB,GACrB,MAAA,IAAIJ,GAAawY,aAAaE,oBAAoBnX,EAAOnB,MAEhEsD,WAAW,mBAAoB+U,GAC/B9U,UAAU,sBAAuB,WAC9B,OACIC,YAAa,iCACbF,WAAa+U,EACb5U,aAAc,qBA9WV2U,EAAAxY,EAAAwY,eAAAxY,EAAAwY,mBAAbxY,eAAAA,kBCLPW,QAAQC,OAAO,wCAAyC+b,KAAK,iBAAkB,SAASC,GAAqBA,EAAeC,IAAI,2BAA2B,khJAC3JD,EAAeC,IAAI,iCAAiC,ogDACpDD,EAAeC,IAAI,mCAAmC,i4EACtDD,EAAeC,IAAI,iCAAiC,slBACpDD,EAAeC,IAAI,+BAA+B,45FAClDD,EAAeC,IAAI,qCAAqC,inFACxDD,EAAeC,IAAI,kCAAkC","file":"explorer-rock-properties-components.min.js","sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,"/// <reference path=\"../../typings/browser.d.ts\" />\nvar rpComponents;\n(function (rpComponents) {\n    var config;\n    (function (config_1) {\n        'use strict';\n        var RocksConfigService = (function () {\n            function RocksConfigService($rootScope) {\n                this.$rootScope = $rootScope;\n            }\n            RocksConfigService.prototype.setConfig = function (config, map) {\n                this.config = config;\n                this.map = map;\n                this.$rootScope.$broadcast(\"rocks.config.ready\");\n            };\n            RocksConfigService.$inject = [\n                \"$rootScope\"\n            ];\n            return RocksConfigService;\n        }());\n        config_1.RocksConfigService = RocksConfigService;\n        angular\n            .module('explorer.rockproperties.config', [])\n            .factory(\"rocksConfigService\", [\"$rootScope\",\n            function ($rootScope) {\n                return new rpComponents.config.RocksConfigService($rootScope);\n            }]);\n    })(config = rpComponents.config || (rpComponents.config = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"../leaflet/clusters\" />\nvar rpComponents;\n(function (rpComponents) {\n    var filters;\n    (function (filters) {\n        'use strict';\n        var RocksClusterFilterCtrl = (function () {\n            function RocksClusterFilterCtrl($scope, clusterService, rocksPanelService, rocksFiltersService) {\n                this.$scope = $scope;\n                this.clusterService = clusterService;\n                this.rocksPanelService = rocksPanelService;\n                this.rocksFiltersService = rocksFiltersService;\n            }\n            RocksClusterFilterCtrl.$inject = [\"$scope\", \"clusterService\", \"rocksPanelService\", \"rocksFiltersService\"];\n            return RocksClusterFilterCtrl;\n        }());\n        filters.RocksClusterFilterCtrl = RocksClusterFilterCtrl;\n        var ClusterFilterState = (function () {\n            function ClusterFilterState() {\n                this.filterQuery = '';\n            }\n            return ClusterFilterState;\n        }());\n        filters.ClusterFilterState = ClusterFilterState;\n        var RocksFiltersService = (function () {\n            function RocksFiltersService($http, $rootScope, rocksConfigService, clusterService, clusterFilterState) {\n                var _this = this;\n                this.$http = $http;\n                this.$rootScope = $rootScope;\n                this.rocksConfigService = rocksConfigService;\n                this.clusterService = clusterService;\n                this.clusterFilterState = clusterFilterState;\n                this.clusterFilters = {};\n                this.$inject = [\n                    \"$http\",\n                    \"$rootScope\",\n                    \"rocksConfigService\",\n                    \"clusterService\",\n                    \"clusterFilterState\"\n                ];\n                // load filter data\n                this.$rootScope.$on(\"rocks.config.ready\", function () {\n                    $http.get(_this.rocksConfigService.config.filterNamesServiceUrl).then(function (response) {\n                        _this.filters = response.data;\n                        for (var i = 0; i < _this.filters.length; i++) {\n                            if (_this.filters[i].filterType == \"PROPERTY\") {\n                                // set up properties array with flag for export\n                                var propertyOptions = angular.copy(_this.filters[i].filterOptions);\n                                for (var j = 0; j < propertyOptions.length; j++) {\n                                    propertyOptions[j] = {\n                                        name: propertyOptions[j],\n                                        isSelected: false\n                                    };\n                                }\n                                var properties = angular.copy(_this.filters[i]);\n                                properties.filterOptions = propertyOptions;\n                                _this.exportProperties = properties;\n                            }\n                        }\n                    }), function (response) {\n                        console.log(\"Failed to get rock props filters\");\n                        console.log(response);\n                    };\n                });\n            }\n            RocksFiltersService.prototype.setAllExportSelected = function (selected) {\n                for (var i = 0; i < this.exportProperties.filterOptions.length; i++) {\n                    this.exportProperties.filterOptions[i].isSelected = selected;\n                }\n            };\n            RocksFiltersService.prototype.applyFilters = function () {\n                this.clusterFilterState.filterQuery = this.buildFilterQuery();\n                this.clusterService.reCluster();\n                ga('send', 'event', 'explorer-rock-properties', 'click', 'cluster filters applied');\n            };\n            RocksFiltersService.prototype.buildFilterQuery = function () {\n                var query = '';\n                for (var i = 0; i < this.filters.length; i++) {\n                    if (this.filters[i].hasOwnProperty('ClusterOption') && this.filters[i].ClusterOption) {\n                        query = query + '&filter=' + encodeURIComponent(this.filters[i].filterType + '=' + this.filters[i].ClusterOption);\n                    }\n                }\n                return query;\n            };\n            RocksFiltersService.prototype.clearFilters = function () {\n                for (var i = 0; i < this.filters.length; i++) {\n                    if (this.filters[i].hasOwnProperty('ClusterOption')) {\n                        this.filters[i].ClusterOption = false;\n                    }\n                }\n                this.clusterFilterState.filterQuery = \"\";\n                this.clusterService.reCluster();\n            };\n            return RocksFiltersService;\n        }());\n        filters.RocksFiltersService = RocksFiltersService;\n        angular\n            .module('explorer.rockproperties.clusterfilters', [])\n            .controller(\"rocksClusterFilterCtrl\", RocksClusterFilterCtrl)\n            .directive(\"rocksClusterFilters\", function () {\n            return {\n                templateUrl: 'rockprops/cluster-filters.html',\n                controller: RocksClusterFilterCtrl,\n                controllerAs: 'rocksClusterFilterVM'\n            };\n        })\n            .factory(\"rocksFiltersService\", [\n            \"$http\",\n            \"$rootScope\",\n            \"rocksConfigService\",\n            \"clusterService\",\n            \"clusterFilterState\",\n            function ($http, $rootScope, rocksConfigService, clusterService, clusterFilterState) {\n                return new rpComponents.filters.RocksFiltersService($http, $rootScope, rocksConfigService, clusterService, clusterFilterState);\n            }])\n            .factory(\"clusterFilterState\", [function () { return new rpComponents.filters.ClusterFilterState(); }]);\n    })(filters = rpComponents.filters || (rpComponents.filters = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/**\n * Simple loading spinner so we're not tied to any img/icon font's\n */\nvar rpComponents;\n(function (rpComponents) {\n    var spinnerService;\n    (function (spinnerService) {\n        'use strict';\n        var LoadingSpinnerService = (function () {\n            function LoadingSpinnerService() {\n            }\n            LoadingSpinnerService.prototype.addSpinner = function (config) {\n                return function () {\n                    var radius = Math.min(config.width, config.height) / 2;\n                    var tau = 2 * Math.PI;\n                    var arc = d3.svg.arc()\n                        .innerRadius(radius * 0.5)\n                        .outerRadius(radius * 0.9)\n                        .startAngle(0);\n                    var svg = d3.select(config.container).append(\"svg\")\n                        .attr(\"id\", config.id)\n                        .attr(\"width\", config.width)\n                        .attr(\"height\", config.height)\n                        .append(\"g\")\n                        .attr(\"transform\", \"translate(\" + config.width / 2 + \",\" + config.height / 2 + \")\");\n                    svg.append(\"path\")\n                        .datum({ endAngle: 0.33 * tau })\n                        .style(\"fill\", \"#4D4D4D\")\n                        .attr(\"d\", arc)\n                        .call(spin, 1500);\n                    function spin(selection, duration) {\n                        selection.transition()\n                            .ease(\"linear\")\n                            .duration(duration)\n                            .attrTween(\"transform\", function () {\n                            return d3.interpolateString(\"rotate(0)\", \"rotate(360)\");\n                        });\n                        setTimeout(function () { spin(selection, duration); }, duration);\n                    }\n                };\n            };\n            return LoadingSpinnerService;\n        }());\n        spinnerService.LoadingSpinnerService = LoadingSpinnerService;\n        angular\n            .module('explorer.rockproperties.spinner', [])\n            .factory(\"loadingSpinnerService\", [function () { return new rpComponents.spinnerService.LoadingSpinnerService(); }]);\n    })(spinnerService = rpComponents.spinnerService || (rpComponents.spinnerService = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/**\n *\n * Geoserver Utils, e.g. get list of layers names from web map service.\n *\n */\nvar rpComponents;\n(function (rpComponents) {\n    var gwsUtilService;\n    (function (gwsUtilService) {\n        'use strict';\n        var GwsUtilService = (function () {\n            function GwsUtilService($q, $http, rocksConfigService) {\n                this.$q = $q;\n                this.$http = $http;\n                this.rocksConfigService = rocksConfigService;\n            }\n            GwsUtilService.prototype.getWfsFeatureTypeNames = function () {\n                var _this = this;\n                var deferred = this.$q.defer();\n                this.$http.get(this.rocksConfigService.config.geoserverWfsUrl\n                    + '?request=GetCapabilities&service=wfs&version='\n                    + this.rocksConfigService.config.geoserverWfsVersion).\n                    success(function (data, status, headers, config) {\n                    var layerNames = _this.getFeatureTypeNamesFromWfsCapsJson(_this.xmlToJson($.parseXML(data)));\n                    deferred.resolve(layerNames);\n                }).\n                    error(function (err) {\n                    console.log(\"GetCapabilities request failed\");\n                    console.log(err);\n                    deferred.error();\n                });\n                return deferred.promise;\n            };\n            GwsUtilService.prototype.getFeatureTypeNamesFromWfsCapsJson = function (data) {\n                var layerData = data[\"wfs:WFS_Capabilities\"].FeatureTypeList.FeatureType;\n                var layers = [];\n                for (var i = 0; i < layerData.length; i++) {\n                    layers.push(layerData[i].Name[\"#text\"]);\n                }\n                return layers;\n            };\n            GwsUtilService.prototype.getWmsLayerNames = function () {\n                var _this = this;\n                var deferred = this.$q.defer();\n                this.$http.get(this.rocksConfigService.config.geoserverWmsUrl\n                    + '?request=GetCapabilities&service=wms&version='\n                    + this.rocksConfigService.config.geoserverWmsVersion).\n                    success(function (data, status, headers, config) {\n                    _this.wmsLayerNames = _this.getLayerNamesFromWmsCapsJson(_this.xmlToJson($.parseXML(data)));\n                    deferred.resolve(_this.wmsLayerNames);\n                }).\n                    error(function (err) {\n                    console.log(\"GetCapabilities request failed\");\n                    console.log(err);\n                    deferred.error();\n                });\n                return deferred.promise;\n            };\n            GwsUtilService.prototype.getLayerNamesFromWmsCapsJson = function (data) {\n                var layerData = data.WMS_Capabilities.Capability.Layer.Layer;\n                var layers = [];\n                for (var i = 0; i < layerData.length; i++) {\n                    layers.push(layerData[i].Name[\"#text\"]);\n                }\n                return layers;\n            };\n            GwsUtilService.prototype.xmlToJson = function (xml) {\n                var obj = {};\n                if (xml.nodeType == 1) {\n                    // do attributes\n                    if (xml.attributes.length > 0) {\n                        obj[\"@attributes\"] = {};\n                        for (var j = 0; j < xml.attributes.length; j++) {\n                            var attribute = xml.attributes.item(j);\n                            obj[\"@attributes\"][attribute.nodeName] = attribute.nodeValue;\n                        }\n                    }\n                }\n                else if (xml.nodeType == 3) {\n                    obj = xml.nodeValue;\n                }\n                // do children\n                if (xml.hasChildNodes()) {\n                    for (var i = 0; i < xml.childNodes.length; i++) {\n                        var item = xml.childNodes.item(i);\n                        var nodeName = item.nodeName;\n                        if (typeof (obj[nodeName]) == \"undefined\") {\n                            obj[nodeName] = this.xmlToJson(item);\n                        }\n                        else {\n                            if (typeof (obj[nodeName].push) == \"undefined\") {\n                                var old = obj[nodeName];\n                                obj[nodeName] = [];\n                                obj[nodeName].push(old);\n                            }\n                            obj[nodeName].push(this.xmlToJson(item));\n                        }\n                    }\n                }\n                return obj;\n            };\n            GwsUtilService.$inject = [\n                \"$q\",\n                \"$http\",\n                \"rocksConfigService\"\n            ];\n            return GwsUtilService;\n        }());\n        gwsUtilService.GwsUtilService = GwsUtilService;\n        angular\n            .module('explorer.rockproperties.gwsutil', [])\n            .factory(\"gwsUtilService\", [\"$q\", \"$http\", \"rocksConfigService\",\n            function ($q, $http, rocksConfigService) {\n                return new rpComponents.gwsUtilService.GwsUtilService($q, $http, rocksConfigService);\n            }]);\n    })(gwsUtilService = rpComponents.gwsUtilService || (rpComponents.gwsUtilService = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"clipship\" />\n/// <reference path=\"config\" />\n/// <reference path=\"spinner\" />\n/// <reference path=\"gws-util\" />\nvar rpComponents;\n(function (rpComponents) {\n    var queryBuilderExport;\n    (function (queryBuilderExport) {\n        'use strict';\n        var QueryBuilder = (function () {\n            function QueryBuilder($q, $http, $rootScope, loadingSpinnerService, rocksClipShipService, rocksConfigService, gwsUtilService) {\n                var _this = this;\n                this.$q = $q;\n                this.$http = $http;\n                this.$rootScope = $rootScope;\n                this.loadingSpinnerService = loadingSpinnerService;\n                this.rocksClipShipService = rocksClipShipService;\n                this.rocksConfigService = rocksConfigService;\n                this.gwsUtilService = gwsUtilService;\n                this.propertyQuery = \"\";\n                this.$inject = [\n                    \"$q\",\n                    \"$http\",\n                    \"$rootScope\",\n                    \"loadingSpinnerService\",\n                    \"rocksClipShipService\",\n                    \"rocksConfigService\",\n                    \"gwsUtilService\"\n                ];\n                this.$rootScope.$on(\"rocks.config.ready\", function () {\n                    // build base query URL from config\n                    _this.baseUrl = _this.rocksConfigService.config.geoserverWfsUrl + \"?\";\n                    angular.forEach(_this.rocksConfigService.config.geoserverWfsExportParams, function (value, key) {\n                        _this.baseUrl += key + \"=\" + value + \"&\";\n                    });\n                    // lose trailing &\n                    _this.baseUrl = _this.baseUrl.slice(0, -1);\n                    // get WFS layer names\n                    _this.gwsUtilService.getWfsFeatureTypeNames().then(function (layerNames) {\n                        _this.wfsLayerNames = layerNames;\n                    });\n                });\n            }\n            QueryBuilder.prototype.startClipShip = function (features, format, extent) {\n                var _this = this;\n                // TODO fire flasher event for UI?\n                this.loading = true;\n                // init spinner\n                if (!this.loadingSpinner) {\n                    this.loadingSpinner = this.loadingSpinnerService.addSpinner({\n                        width: 80,\n                        height: 80,\n                        container: \"#rock-clip-ship-loading\",\n                        id: \"clip-ship-spinner\"\n                    });\n                    this.loadingSpinner();\n                }\n                var targetFeatures = [];\n                for (var i = 0; i < features.length; i++) {\n                    if (features[i].isSelected)\n                        targetFeatures.push(features[i].name);\n                }\n                if (format === \"csv\") {\n                    var zip = new JSZip();\n                    // give zip file to decent browsers\n                    if (JSZip.support.blob) {\n                        var promises = [];\n                        // create a Get query for each layer\n                        for (var i = 0; i < this.wfsLayerNames.length; i++) {\n                            var query = this.buildQuery(targetFeatures, extent, format, [this.wfsLayerNames[i]]);\n                            var promise = this.$http.get(query);\n                            promises.push(promise);\n                        }\n                        this.$q.all(promises).then(function (results) {\n                            for (var i = 0; i < results.length; i++) {\n                                // we'll assume that if there's more than one line we've got data to write\n                                var numberOfLineBreaks = (results[i]['data'].match(/\\n/g) || []).length;\n                                if (numberOfLineBreaks > 1) {\n                                    var filename = _this.wfsLayerNames[i].split(' ').join('-');\n                                    zip.file(filename + \".csv\", results[i]['data'] + \"\\n\");\n                                }\n                            }\n                            // FileSaver.js\n                            var content = zip.generate({ type: \"blob\" });\n                            saveAs(content, \"rocks-export.zip\");\n                            _this.loading = false;\n                            _this.rocksClipShipService.step = 'startDraw';\n                        });\n                    }\n                    else {\n                        // just give separate file for each layer\n                        for (var i = 0; i < this.wfsLayerNames.length; i++) {\n                            window.open(this.buildQuery(targetFeatures, extent, format, [this.wfsLayerNames[i]]));\n                        }\n                        this.loading = false;\n                    }\n                }\n                else {\n                    // give the user the query url directly\n                    this.exportUrl = this.buildQuery(targetFeatures, extent, format, this.wfsLayerNames);\n                    this.loading = false;\n                }\n            };\n            QueryBuilder.prototype.buildQuery = function (properties, extent, format, layerNames) {\n                var typeNamesQuery = this.getTypeNamesQuery(layerNames);\n                // BBOX and FILTER queries are mutually exclusive, so must use CQL\n                var bboxQuery = \"&CQL_FILTER=BBOX(GEOM,\" + extent.west + \",\" + extent.south + \",\" + extent.east + \",\" + extent.north + \")\";\n                var filterQuery = \"\";\n                var filters = {}; // filterState.filters;\n                var exportFormat = \"&outputFormat=\" + format;\n                var query;\n                var hasFilters = !isEmpty(filters);\n                var filtersHasProperty = filters.hasOwnProperty(\"PROPERTY\");\n                var onlyHasPropertyFilter = (filtersHasProperty && (Object.keys(filters).length === 1)) ? true : false;\n                function isEmpty(obj) {\n                    for (var prop in obj) {\n                        if (obj.hasOwnProperty(prop))\n                            return false;\n                    }\n                    return true;\n                }\n                // single feature/layer query with filters\n                if (hasFilters && filtersHasProperty) {\n                    this.propertyQuery = \"%20AND%20PROPERTY='\" + filters['PROPERTY'] + \"'\";\n                    if (!onlyHasPropertyFilter) {\n                        filterQuery = this.getFilters(filters);\n                    }\n                }\n                else if (hasFilters) {\n                    this.propertyQuery = this.getPropertyQuery(properties);\n                    if (!onlyHasPropertyFilter) {\n                        filterQuery = this.getFilters(filters);\n                    }\n                }\n                else {\n                    this.propertyQuery = this.getPropertyQuery(properties);\n                }\n                ga('send', 'event', 'explorer-rock-properties', 'click', 'clipship data export: ' + format);\n                query = this.baseUrl + typeNamesQuery + exportFormat + bboxQuery + filterQuery + this.propertyQuery;\n                return query;\n            };\n            // create filter query for each of the selected attribute values\n            // don't include PROPERTY here as we want to apply OR logic\n            QueryBuilder.prototype.getFilters = function (filters) {\n                var filterString = \"%20AND%20\";\n                // create filters string\n                for (var property in filters) {\n                    if (property !== \"PROPERTY\") {\n                        filterString = filterString.concat(property + \"='\" + filters[property] + \"'%20AND%20\");\n                    }\n                }\n                // trim tailing AND\n                filterString = filterString.substring(0, filterString.length - 9);\n                return filterString;\n            };\n            // build CQL query for properties\n            QueryBuilder.prototype.getPropertyQuery = function (properties) {\n                var query = \"%20AND%20(\";\n                for (var i = 0; i < properties.length; i++) {\n                    query = query.concat(\"PROPERTY='\" + properties[i] + \"'%20OR%20\");\n                }\n                // trim trailing OR, close bracket\n                query = query.substring(0, query.length - 8);\n                query = query.concat(\")\");\n                return query;\n            };\n            QueryBuilder.prototype.getTypeNamesQuery = function (layers) {\n                var query = \"&typeName=\";\n                for (var i = 0; i < layers.length; i++) {\n                    query = query.concat(layers[i] + \",\");\n                }\n                query = query.substring(0, query.length - 1);\n                return query;\n            };\n            return QueryBuilder;\n        }());\n        queryBuilderExport.QueryBuilder = QueryBuilder;\n        angular\n            .module('explorer.rockproperties.queryexport', [])\n            .factory(\"rocksQueryBuilderExport\", [\n            \"$q\",\n            \"$http\",\n            \"$rootScope\",\n            \"loadingSpinnerService\",\n            \"rocksClipShipService\",\n            \"rocksConfigService\",\n            \"gwsUtilService\",\n            function ($q, $http, $rootScope, loadingSpinnerService, rocksClipShipService, rocksConfigService, gwsUtilService) {\n                return new rpComponents.queryBuilderExport.QueryBuilder($q, $http, $rootScope, loadingSpinnerService, rocksClipShipService, rocksConfigService, gwsUtilService);\n            }]);\n    })(queryBuilderExport = rpComponents.queryBuilderExport || (rpComponents.queryBuilderExport = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"query-builder-export\" />\n/// <reference path=\"cluster-filters\" />\n/// <reference path=\"control-panel\" />\nvar rpComponents;\n(function (rpComponents) {\n    var clipShipService;\n    (function (clipShipService) {\n        'use strict';\n        var RocksClipShipCtrl = (function () {\n            function RocksClipShipCtrl($scope, $timeout, rocksClipShipService, rocksPanelService, rocksFiltersService, rocksQueryBuilderExport) {\n                this.$scope = $scope;\n                this.$timeout = $timeout;\n                this.rocksClipShipService = rocksClipShipService;\n                this.rocksPanelService = rocksPanelService;\n                this.rocksFiltersService = rocksFiltersService;\n                this.rocksQueryBuilderExport = rocksQueryBuilderExport;\n            }\n            RocksClipShipCtrl.prototype.startClipShip = function () {\n                var _this = this;\n                this.$timeout(function () {\n                    _this.rocksClipShipService.step = 'download';\n                    _this.rocksQueryBuilderExport.startClipShip(_this.rocksFiltersService.exportProperties.filterOptions, _this.rocksClipShipService.targetFormat, _this.rocksClipShipService.targetExtent);\n                });\n            };\n            RocksClipShipCtrl.$inject = [\n                \"$scope\",\n                \"$timeout\",\n                \"rocksClipShipService\",\n                \"rocksPanelService\",\n                \"rocksFiltersService\",\n                \"rocksQueryBuilderExport\"\n            ];\n            return RocksClipShipCtrl;\n        }());\n        clipShipService.RocksClipShipCtrl = RocksClipShipCtrl;\n        var RocksClipShipService = (function () {\n            function RocksClipShipService($rootScope, rocksFiltersService, rocksConfigService) {\n                var _this = this;\n                this.$rootScope = $rootScope;\n                this.rocksFiltersService = rocksFiltersService;\n                this.rocksConfigService = rocksConfigService;\n                this.step = \"startDraw\";\n                this.isDrawing = false;\n                this.$inject = [\n                    \"$rootScope\",\n                    \"rocksFiltersService\",\n                    \"rocksConfigService\"\n                ];\n                this.$rootScope.$on(\"rocks.config.ready\", function () {\n                    _this.exportFormats = _this.rocksConfigService.config.geoserverWfsExportFormats;\n                });\n                this.$rootScope.$on(\"rocks.extent.ready\", function (event, data) {\n                    _this.step = \"selectFeatures\";\n                    _this.targetExtent = data;\n                });\n            }\n            /**\n             * broadcast event to trigger draw, and return extent\n             */\n            RocksClipShipService.prototype.startDraw = function () {\n                this.isDrawing = true;\n                this.$rootScope.$broadcast(\"draw.extent.start\", \"rocks.extent.ready\");\n            };\n            RocksClipShipService.prototype.openGeoserver = function () {\n                var win = window.open(this.rocksConfigService.config.geoserverDashboardUrl, '_blank');\n                if (win) {\n                    win.focus();\n                }\n            };\n            RocksClipShipService.prototype.updateExportFormat = function (format) {\n                this.targetFormat = format;\n            };\n            return RocksClipShipService;\n        }());\n        clipShipService.RocksClipShipService = RocksClipShipService;\n        angular\n            .module('explorer.rockproperties.clipship', [])\n            .factory(\"rocksClipShipService\", [\"$rootScope\", \"rocksFiltersService\", \"rocksConfigService\",\n            function ($rootScope, rocksFiltersService, rocksConfigService) {\n                return new rpComponents.clipShipService.RocksClipShipService($rootScope, rocksFiltersService, rocksConfigService);\n            }\n        ])\n            .controller(\"rocksClipShipCtrl\", RocksClipShipCtrl)\n            .directive(\"rocksClipShip\", function () {\n            return {\n                templateUrl: 'rockprops/clip-ship.html',\n                controller: RocksClipShipCtrl,\n                controllerAs: 'rocksClipShipVM'\n            };\n        })\n            .filter('noClipSelected', [function ($filter) {\n                return function (features) {\n                    if (!features)\n                        return;\n                    for (var i = 0; i < features.length; i++) {\n                        if (features[i].isSelected)\n                            return false;\n                    }\n                    return true;\n                };\n            }]);\n    })(clipShipService = rpComponents.clipShipService || (rpComponents.clipShipService = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"../components/spinner\" />\n/// <reference path=\"../components/clipship\" />\nvar rpComponents;\n(function (rpComponents) {\n    var wmsInspectorService;\n    (function (wmsInspectorService_1) {\n        'use strict';\n        var WmsInspectorCtrl = (function () {\n            function WmsInspectorCtrl($scope, wmsInspectorState, wmsInspectorService) {\n                this.$scope = $scope;\n                this.wmsInspectorState = wmsInspectorState;\n                this.wmsInspectorService = wmsInspectorService;\n            }\n            WmsInspectorCtrl.$inject = [\"$scope\", \"wmsInspectorState\", \"wmsInspectorService\"];\n            return WmsInspectorCtrl;\n        }());\n        wmsInspectorService_1.WmsInspectorCtrl = WmsInspectorCtrl;\n        var WmsInspectorService = (function () {\n            function WmsInspectorService($rootScope, $http, wmsInspectorState, assetsService, configService, rocksConfigService, loadingSpinnerService, gwsUtilService, rocksClipShipService) {\n                var _this = this;\n                this.$rootScope = $rootScope;\n                this.$http = $http;\n                this.wmsInspectorState = wmsInspectorState;\n                this.assetsService = assetsService;\n                this.configService = configService;\n                this.rocksConfigService = rocksConfigService;\n                this.loadingSpinnerService = loadingSpinnerService;\n                this.gwsUtilService = gwsUtilService;\n                this.rocksClipShipService = rocksClipShipService;\n                this.isLoading = false;\n                this.URL_EXCLUDE = \"?SERVICE=WMS&\";\n                this.SURFACE_GEO = \"GA_Surface_Geology_of_Australia\";\n                this.$inject = [\n                    \"$rootScope\",\n                    \"$http\",\n                    \"wmsInspectorState\",\n                    \"assetsService\",\n                    \"configService\",\n                    \"rocksConfigService\",\n                    \"loadingSpinnerService\",\n                    \"gwsUtilService\",\n                    \"rocksClipShipService\"\n                ];\n                // register listener for pointInspector\n                this.$rootScope.$on(\"viewer.click.left\", function (event, data) {\n                    data.degrees = {\n                        lat: data.cartographic.latitude,\n                        lon: data.cartographic.longitude\n                    };\n                    // TODO should flasher for this so user knows why\n                    // (we don't want inspector interuppting clipship drawing)\n                    if (_this.rocksClipShipService.isDrawing) {\n                        return;\n                    }\n                    if (_this.inspectorEnabled && data.hasOwnProperty('cartographic')) {\n                        // make sure panel is visible\n                        _this.$rootScope.$broadcast(\"rocks.accordion.update\", \"wmsInspector\");\n                        _this.$rootScope.$broadcast(\"toolbar.toggle.update\", { linked: false, key: \"rocksClusters\", isActive: true });\n                        _this.wmsInspectorState.targetGeom = data;\n                        _this.wmsInspectorState.view = \"LAYERSELECT\";\n                        _this.wmsInspectorState.cameraHeight = 0;\n                    }\n                });\n                this.$rootScope.$on('rocks.config.ready', function () {\n                    // load feature classes\n                    assetsService.getReferenceFeatureClasses().then(function (features) {\n                        _this.features = features;\n                    });\n                    // init rocks feature\n                    _this.rocksFeature = {\n                        wmsUrl: _this.rocksConfigService.config.geoserverWmsUrl,\n                        name: 'Rock Properties Layer'\n                    };\n                });\n            }\n            WmsInspectorService.prototype.togglePointInspector = function () {\n                this.inspectorEnabled != this.inspectorEnabled;\n            };\n            // TODO we should restrict the query to visible layers\n            WmsInspectorService.prototype.queryRocks = function () {\n                if (!this.rocksFeature.hasOwnProperty('layers') && this.gwsUtilService.wmsLayerNames) {\n                    this.rocksFeature.layers = [];\n                    for (var i = 0; i < this.gwsUtilService.wmsLayerNames.length; i++) {\n                        this.rocksFeature.layers.push(this.rocksConfigService.config.geoserverWmsLayerPrefix +\n                            this.gwsUtilService.wmsLayerNames[i]);\n                    }\n                }\n                this.queryFeature(this.rocksFeature);\n            };\n            WmsInspectorService.prototype.queryFeature = function (feature) {\n                var _this = this;\n                ga('send', 'event', 'explorer-rock-properties', 'click', 'wms inspector query: ' + feature.name);\n                // set view\n                this.wmsInspectorState.view = \"FEATUREINFO\";\n                this.toggleLoading();\n                var targetUrl = feature.wmsUrl;\n                var targetLayers = feature.layers;\n                // clean any endpoints already containing '?'\n                if (targetUrl.indexOf(this.URL_EXCLUDE) > -1) {\n                    targetUrl = targetUrl.substring(0, (targetUrl.length - this.URL_EXCLUDE.length));\n                }\n                // surface geology has scale dependencies, so we need to check\n                // zoom (aka camera height) to ensure we query the correct layer\n                if (targetUrl.indexOf(this.SURFACE_GEO) > -1) {\n                    if (this.wmsInspectorState.cameraHeight <= 340000) {\n                        targetLayers = [targetLayers[0]];\n                    }\n                    else {\n                        targetLayers = [targetLayers[1]];\n                    }\n                }\n                var queryString = '?SERVICE=WMS' +\n                    '&REQUEST=GetFeatureInfo' +\n                    '&VERSION=1.1.1' +\n                    '&LAYERS=' + targetLayers +\n                    '&STYLES=' +\n                    '&SRS=EPSG%3A4326' +\n                    '&FORMAT=image%2Fpng' +\n                    // we use the click pos as the bottom left corner\n                    // and offset the top right by ~30 meters\n                    // (can be hard to click on a point if res is too fine)\n                    '&BBOX=' +\n                    (this.wmsInspectorState.targetGeom.degrees.lon) + ',' +\n                    (this.wmsInspectorState.targetGeom.degrees.lat) + ',' +\n                    (this.wmsInspectorState.targetGeom.degrees.lon + 0.003) + ',' +\n                    (this.wmsInspectorState.targetGeom.degrees.lat + 0.003) +\n                    '&QUERY_LAYERS=' + targetLayers +\n                    '&INFO_FORMAT=text%2Fhtml' +\n                    '&FEATURE_COUNT=100' +\n                    '&WIDTH=2' +\n                    '&HEIGHT=2' +\n                    '&X=1' +\n                    '&Y=1' +\n                    '&TRANSPARENT=true' +\n                    '&EXCEPTIONS=application%2Fvnd.ogc.se_xml';\n                // send the query\n                this.$http.get(targetUrl + queryString).success(function (data) {\n                    _this.featureInfo = data;\n                    _this.toggleLoading();\n                })\n                    .error(function (data, status, headers, config) {\n                    console.log(\"Couldn't load WMS GetFeatureInfo\");\n                    this.featureInfo = \"<h5>Couldn't load WMS GetFeatureInfo for this layer.</h5><p>You may not be able to access this function for some layers.</p>\";\n                    this.toggleLoading();\n                });\n            };\n            WmsInspectorService.prototype.toggleLoading = function () {\n                if (this.loadingSpinner) {\n                    this.isLoading = !this.isLoading;\n                }\n                else {\n                    this.loadingSpinner = this.loadingSpinnerService.addSpinner({\n                        width: 60,\n                        height: 60,\n                        container: \"#rocks-inspector-loading\",\n                        id: \"rocks-inspector-spinner\"\n                    });\n                    this.loadingSpinner();\n                    this.isLoading = true;\n                }\n            };\n            return WmsInspectorService;\n        }());\n        wmsInspectorService_1.WmsInspectorService = WmsInspectorService;\n        angular\n            .module('explorer.rockproperties.inspector', [])\n            .factory(\"wmsInspectorService\", [\n            \"$rootScope\",\n            \"$http\",\n            \"wmsInspectorState\",\n            \"assetsService\",\n            \"configService\",\n            \"rocksConfigService\",\n            \"loadingSpinnerService\",\n            \"gwsUtilService\",\n            \"rocksClipShipService\",\n            function ($rootScope, $http, wmsInspectorState, assetsService, configService, rocksConfigService, loadingSpinnerService, gwsUtilService, rocksClipShipService) {\n                return new rpComponents.wmsInspectorService.WmsInspectorService($rootScope, $http, wmsInspectorState, assetsService, configService, rocksConfigService, loadingSpinnerService, gwsUtilService, rocksClipShipService);\n            }])\n            .controller(\"wmsInspectorCtrl\", rpComponents.wmsInspectorService.WmsInspectorCtrl)\n            .directive(\"wmsInspectorPanel\", function () {\n            return {\n                templateUrl: 'rockprops/wms-inspector-panel.html',\n                controller: WmsInspectorCtrl,\n                controllerAs: 'wmsInspectorVM'\n            };\n        });\n    })(wmsInspectorService = rpComponents.wmsInspectorService || (rpComponents.wmsInspectorService = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\nvar rpComponents;\n(function (rpComponents) {\n    var wmsInspectorState;\n    (function (wmsInspectorState) {\n        'use strict';\n        /*\n            The WMS inspector panel can be in 1 of 3 view states:\n            1. INTRO - the default/home shows prompt\n            2. LAYERSELECT - user presented with layers to interrogate with GetFeatureInfo when\n            they have clicked a point on the map\n            3. FEATUREINFO - view to present raw html returned by GetFeatureInfo\n         */\n        var WmsInspectorState = (function () {\n            function WmsInspectorState() {\n                this.view = \"INTRO\";\n            }\n            return WmsInspectorState;\n        }());\n        wmsInspectorState.WmsInspectorState = WmsInspectorState;\n        angular\n            .module('explorer.rockproperties.inspectorstate', [])\n            .factory(\"wmsInspectorState\", [function () { return new rpComponents.wmsInspectorState.WmsInspectorState(); }]);\n    })(wmsInspectorState = rpComponents.wmsInspectorState || (rpComponents.wmsInspectorState = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"config\" />\n/// <reference path=\"../components/control-panel\" />\n/// <reference path=\"../leaflet/wms-inspector\" />\n/// <reference path=\"../leaflet/wms-inspector-state\" />\n/// <reference path=\"gws-util\" />\nvar rpComponents;\n(function (rpComponents) {\n    var pointsService;\n    (function (pointsService) {\n        'use strict';\n        var RocksWmsPointsCtrl = (function () {\n            function RocksWmsPointsCtrl($scope, wmsPointsService, rocksPanelService, wmsInspectorState) {\n                this.$scope = $scope;\n                this.wmsPointsService = wmsPointsService;\n                this.rocksPanelService = rocksPanelService;\n                this.wmsInspectorState = wmsInspectorState;\n            }\n            RocksWmsPointsCtrl.$inject = [\"$scope\", \"wmsPointsService\", \"rocksPanelService\", \"wmsInspectorState\"];\n            return RocksWmsPointsCtrl;\n        }());\n        pointsService.RocksWmsPointsCtrl = RocksWmsPointsCtrl;\n        var WmsPointsService = (function () {\n            function WmsPointsService($rootScope, gwsUtilService, rocksConfigService, wmsInspectorState) {\n                var _this = this;\n                this.$rootScope = $rootScope;\n                this.gwsUtilService = gwsUtilService;\n                this.rocksConfigService = rocksConfigService;\n                this.wmsInspectorState = wmsInspectorState;\n                this.inspectorEnabled = true;\n                this.masterChecked = true;\n                this.legendParamString = \"\";\n                this.$inject = [\n                    \"$rootScope\",\n                    \"gwsUtilService\",\n                    \"rocksConfigService\",\n                    \"wmsInspectorState\"\n                ];\n                this.$rootScope.$on('rocks.config.ready', function () {\n                    _this.init();\n                });\n            }\n            WmsPointsService.prototype.init = function () {\n                var _this = this;\n                this.wmsServiceUrl = this.rocksConfigService.config.geoserverWmsUrl;\n                this.map = this.rocksConfigService.map;\n                this.restrictedBounds = [109, -45, 158, -8];\n                // build our legend param string from config\n                this.legendParamString = \"?\";\n                angular.forEach(this.rocksConfigService.config.geoserverWmsLegendParams, function (value, key) {\n                    _this.legendParamString += key + \"=\" + value + \"&\";\n                });\n                // lose trailing &\n                this.legendParamString = this.legendParamString.slice(0, -1) + \"&LAYER=\";\n                this.gwsUtilService.getWmsLayerNames().then(function (layers) {\n                    _this.layers = layers;\n                    _this.getLegendData();\n                });\n            };\n            WmsPointsService.prototype.togglePoints = function () {\n                this.pointsVisible = !this.pointsVisible;\n                if (this.wmsLayer) {\n                    this.wmsLayer.show = this.pointsVisible;\n                }\n                else {\n                    this.updatePointsLayer();\n                }\n                return this.pointsVisible;\n            };\n            WmsPointsService.prototype.toggleChecked = function () {\n                this.masterChecked != this.masterChecked;\n                for (var legend in this.legendData) {\n                    this.legendData[legend]['isSelected'] = this.masterChecked;\n                }\n            };\n            WmsPointsService.prototype.getLegendData = function () {\n                this.legendData = {};\n                for (var i = 0; i < this.layers.length; i++) {\n                    this.legendData[this.layers[i]] = {\n                        legendUrl: this.wmsServiceUrl + this.legendParamString + this.layers[i],\n                        isSelected: true\n                    };\n                }\n            };\n            WmsPointsService.prototype.updatePointsLayer = function () {\n                var targetLayers = [];\n                for (var legend in this.legendData) {\n                    if (this.legendData.hasOwnProperty(legend) && this.legendData[legend]['isSelected'] === true) {\n                        targetLayers.push(legend);\n                    }\n                }\n                if (this.wmsLayer) {\n                    this.map.remove(this.wmsLayer);\n                }\n                ga('send', 'event', 'explorer-rock-properties', 'click', 'update wms points layer: ' + targetLayers.toString());\n                this.wmsLayer = L.tileLayer.wms(this.wmsServiceUrl, {\n                    layers: targetLayers.toString(),\n                    transparent: true,\n                    format: 'image/png'\n                });\n                this.map.addLayer(this.wmsLayer);\n                /*            this.wmsLayer = this.viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({\n                                url : this.wmsServiceUrl,\n                                layers: targetLayers.toString(),\n                                rectangle: this.restrictedBounds,\n                                parameters : {\n                                    transparent : 'true',\n                                    format : 'image/png'\n                                },\n                                enablePickFeatures: false\n                            }));\n                            this.wmsLayer.alpha = 0.7;\n                */\n            };\n            return WmsPointsService;\n        }());\n        pointsService.WmsPointsService = WmsPointsService;\n        angular\n            .module('explorer.rockproperties.wmspoints', [])\n            .factory(\"wmsPointsService\", [\"$rootScope\", \"gwsUtilService\", \"rocksConfigService\", \"wmsInspectorState\",\n            function ($rootScope, gwsUtilService, rocksConfigService, wmsInspectorState) {\n                return new rpComponents.pointsService.WmsPointsService($rootScope, gwsUtilService, rocksConfigService, wmsInspectorState);\n            }])\n            .controller(\"rocksWmsPointsCtrl\", RocksWmsPointsCtrl)\n            .directive(\"rocksWmsPointsLegend\", function () {\n            return {\n                templateUrl: 'rockprops/wms-points-panel.html',\n                controller: RocksWmsPointsCtrl,\n                controllerAs: 'rocksWmsPointsVM'\n            };\n        });\n    })(pointsService = rpComponents.pointsService || (rpComponents.pointsService = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"../leaflet/clusters\" />\n/// <reference path=\"../leaflet/wms-inspector\" />\n/// <reference path=\"wms-points\" />\nvar rpComponents;\n(function (rpComponents) {\n    var controlPanel;\n    (function (controlPanel) {\n        'use strict';\n        var RocksPanelCtrl = (function () {\n            function RocksPanelCtrl($scope, rocksPanelService, wmsInspectorService) {\n                var _this = this;\n                this.$scope = $scope;\n                this.rocksPanelService = rocksPanelService;\n                this.wmsInspectorService = wmsInspectorService;\n                this.targetPanel = '';\n                this.$scope.$on(\"rocks.accordion.update\", function (event, data) {\n                    _this.targetPanel = data;\n                });\n            }\n            RocksPanelCtrl.prototype.setTargetPanel = function (targetPanel) {\n                this.targetPanel = (this.targetPanel != targetPanel) ? targetPanel : \"\";\n            };\n            RocksPanelCtrl.$inject = [\"$scope\", \"rocksPanelService\", \"wmsInspectorService\"];\n            return RocksPanelCtrl;\n        }());\n        controlPanel.RocksPanelCtrl = RocksPanelCtrl;\n        var RocksPanelService = (function () {\n            function RocksPanelService($rootScope, clusterService, wmsPointsService, rocksConfigService) {\n                this.$rootScope = $rootScope;\n                this.clusterService = clusterService;\n                this.wmsPointsService = wmsPointsService;\n                this.rocksConfigService = rocksConfigService;\n                this.clustersEnabled = false;\n                this.pointsEnabled = false;\n            }\n            /**\n             *\n             * The entry point for the component.\n             *\n             * @param map\n             * @param clusterServiceUrl\n             * @param wmsServiceUrl\n             * @param pickEnabled\n             */\n            RocksPanelService.prototype.init = function (map, config) {\n                this.map = map;\n                this.rocksConfigService.setConfig(config, map);\n            };\n            RocksPanelService.prototype.toggleClusters = function () {\n                this.clustersEnabled = this.clusterService.toggleClusters();\n            };\n            RocksPanelService.prototype.togglePoints = function () {\n                this.pointsEnabled = this.wmsPointsService.togglePoints();\n            };\n            RocksPanelService.$inject = [\n                \"$rootScope\",\n                \"clusterService\",\n                \"wmsPointsService\",\n                \"rocksConfigService\"\n            ];\n            return RocksPanelService;\n        }());\n        controlPanel.RocksPanelService = RocksPanelService;\n        angular\n            .module('explorer.rockproperties.controlpanel', [])\n            .factory(\"rocksPanelService\", [\n            \"$rootScope\", \"clusterService\", \"wmsPointsService\", \"rocksConfigService\",\n            function ($rootScope, clusterService, wmsPointsService, rocksConfigService) {\n                return new rpComponents.controlPanel.RocksPanelService($rootScope, clusterService, wmsPointsService, rocksConfigService);\n            }\n        ])\n            .controller(\"rocksPanelCtrl\", RocksPanelCtrl)\n            .directive(\"rocksControlPanel\", function () {\n            return {\n                templateUrl: 'rockprops/control-panel.html',\n                controller: RocksPanelCtrl,\n                controllerAs: 'controlPanelVM'\n            };\n        });\n    })(controlPanel = rpComponents.controlPanel || (rpComponents.controlPanel = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"../components/control-panel\" />\n/// <reference path=\"../components/charts\" />\nvar rpComponents;\n(function (rpComponents) {\n    var clusterInspector;\n    (function (clusterInspector) {\n        'use strict';\n        var ClusterInspectorCtrl = (function () {\n            function ClusterInspectorCtrl($scope, clusterInspectorService, rocksPanelService) {\n                this.$scope = $scope;\n                this.clusterInspectorService = clusterInspectorService;\n                this.rocksPanelService = rocksPanelService;\n            }\n            ClusterInspectorCtrl.$inject = [\"$scope\", \"clusterInspectorService\", \"rocksPanelService\"];\n            return ClusterInspectorCtrl;\n        }());\n        clusterInspector.ClusterInspectorCtrl = ClusterInspectorCtrl;\n        var PagingState = (function () {\n            function PagingState(count, total) {\n                this.count = count;\n                this.total = total;\n            }\n            PagingState.prototype.more = function () {\n                return this.total > this.count;\n            };\n            return PagingState;\n        }());\n        clusterInspector.PagingState = PagingState;\n        var ClusterInspectorService = (function () {\n            function ClusterInspectorService($http, $rootScope, $timeout, zoomLevelService, loadingSpinnerService, rocksConfigService, clusterChartService, clusterFilterState) {\n                var _this = this;\n                this.$http = $http;\n                this.$rootScope = $rootScope;\n                this.$timeout = $timeout;\n                this.zoomLevelService = zoomLevelService;\n                this.loadingSpinnerService = loadingSpinnerService;\n                this.rocksConfigService = rocksConfigService;\n                this.clusterChartService = clusterChartService;\n                this.clusterFilterState = clusterFilterState;\n                this.inspectMode = \"CHART\";\n                this.listReady = false;\n                // TODO decide reasonable step size when plugged into real service\n                this.maxListStep = 100;\n                this.$rootScope.$on('rocks.config.ready', function () {\n                    _this.init();\n                });\n            }\n            /**\n             *\n             \n             * @param map\n             * @param summaryService\n             * @param usePicking\n             */\n            ClusterInspectorService.prototype.init = function () {\n                this.map = this.rocksConfigService.map;\n                this.serviceUrl = this.rocksConfigService.config.rocksServiceUrl;\n                // setup our pick handler\n                if (this.rocksConfigService.config.useClusterPicking) {\n                }\n            };\n            /**\n             *\n             * Gets a summary of cluster data to pass to chartService.\n             *\n             * @param cluster\n             */\n            ClusterInspectorService.prototype.chartClusterQuery = function () {\n                var _this = this;\n                //  spinner for summary chart load\n                if (this.summarySpinner) {\n                    document.getElementById(\"cluster-summary-chart-loading\").style.display = 'block';\n                }\n                else {\n                    this.summarySpinner = this.loadingSpinnerService.addSpinner({\n                        width: 100,\n                        height: 100,\n                        container: \"#cluster-summary-chart-loading\",\n                        id: \"chart-spinner\"\n                    });\n                    this.summarySpinner();\n                }\n                var args = '?zoom=' + this.zoomLevelService.nextIndex +\n                    '&x=' + this.targetPos.longitude +\n                    '&y=' + this.targetPos.latitude +\n                    this.clusterFilterState.filterQuery;\n                var query = this.serviceUrl + 'query' + args;\n                console.log(\"query\");\n                console.log(query);\n                this.$http({\n                    method: 'GET',\n                    url: query\n                }).then(function (response) {\n                    if (response.hasOwnProperty('data')) {\n                        _this.clusterChartService.buildChart(response.data);\n                    }\n                });\n                ga('send', 'event', 'explorer-rock-properties', 'click', 'cluster inspector summary charts');\n            };\n            ClusterInspectorService.prototype.loadNextListStep = function () {\n                this.listIndex += this.maxListStep;\n                console.log(\"loadNextListStep \" + this.listIndex);\n                this.listClusterQuery();\n            };\n            ClusterInspectorService.prototype.listClusterQuery = function () {\n                var _this = this;\n                console.log(\"listClusterQuery\");\n                //  spinner for summary chart load\n                if (this.listSpinner) {\n                    document.getElementById(\"cluster-result-list-loading\").style.display = 'block';\n                }\n                else {\n                    this.listSpinner = this.loadingSpinnerService.addSpinner({\n                        width: 100,\n                        height: 100,\n                        container: \"#cluster-result-list-loading\",\n                        id: \"cluster-result-list-spinner\"\n                    });\n                    this.listSpinner();\n                }\n                var args = '?zoom=' + this.zoomLevelService.nextIndex +\n                    '&maxCount=' + this.maxListStep +\n                    '&startIndex=' + this.listIndex +\n                    '&x=' + this.targetPos.longitude +\n                    '&y=' + this.targetPos.latitude +\n                    this.clusterFilterState.filterQuery;\n                var query = this.serviceUrl + 'features' + args;\n                console.log(\"features query\");\n                console.log(query);\n                this.$http({\n                    method: 'GET',\n                    // mock\n                    //url: this.serviceUrl + '/mock-feature-list.json'\n                    // real service\n                    url: query\n                }).then(function (response) {\n                    if (response.hasOwnProperty('data')) {\n                        _this.$timeout(function () {\n                            document.getElementById(\"cluster-result-list-loading\").style.display = 'none';\n                            _this.listReady = true;\n                            // step, merge features\n                            if (_this.listIndex != 0) {\n                                _this.listFeatures.features = _this.listFeatures.features.concat(response.data.features);\n                            }\n                            else {\n                                _this.listFeatures = response.data;\n                            }\n                            var morePages = _this.listFeatures.features.length < _this.listFeatures.totalFeatures;\n                            _this.pagingState = new PagingState(_this.listFeatures.features.length, _this.listFeatures.totalFeatures);\n                        }, 1000);\n                    }\n                });\n                ga('send', 'event', 'explorer-rock-properties', 'click', 'cluster inspector feature list (startIndex: ' + this.listIndex + ')');\n            };\n            ClusterInspectorService.prototype.setPickEnabled = function (enabled) {\n                if (enabled) {\n                }\n                else {\n                }\n            };\n            ClusterInspectorService.prototype.setClusterPrimitive = function (primitive) {\n                this.clusterPrimitive = primitive;\n            };\n            ClusterInspectorService.prototype.setHighlighted = function (id, highlight) {\n                var attributes = this.clusterPrimitive.getGeometryInstanceAttributes(id);\n                if (attributes && highlight) {\n                    attributes.prevColor = attributes.color;\n                    attributes.color = '#ff00ff';\n                }\n            };\n            ClusterInspectorService.prototype.clearHighlighted = function () {\n                if (this.targetId) {\n                    var attributes = this.clusterPrimitive.getGeometryInstanceAttributes(this.targetId);\n                    if (attributes && attributes.hasOwnProperty('prevColor')) {\n                        attributes.color = attributes.prevColor;\n                    }\n                }\n            };\n            ClusterInspectorService.$inject = [\n                \"$http\",\n                \"$rootScope\",\n                \"$timeout\",\n                \"zoomLevelService\",\n                \"loadingSpinnerService\",\n                \"rocksConfigService\",\n                \"clusterChartService\",\n                \"clusterFilterState\"\n            ];\n            return ClusterInspectorService;\n        }());\n        clusterInspector.ClusterInspectorService = ClusterInspectorService;\n        angular\n            .module('explorer.rockproperties.clusterinspector', [])\n            .controller(\"clusterInspectorCtrl\", ClusterInspectorCtrl)\n            .directive(\"rocksClusterInspectorPanel\", function () {\n            return {\n                templateUrl: 'rockprops/cluster-inspector.html',\n                controller: ClusterInspectorCtrl,\n                controllerAs: 'clusterInspectorVM'\n            };\n        })\n            .factory(\"clusterInspectorService\", [\n            \"$http\",\n            \"$rootScope\",\n            \"$timeout\",\n            \"zoomLevelService\",\n            \"loadingSpinnerService\",\n            \"rocksConfigService\",\n            \"clusterChartService\",\n            \"clusterFilterState\",\n            function ($http, $rootScope, $timeout, zoomLevelService, chartSpinnerService, rocksConfigService, clusterChartService, clusterFilterState) {\n                return new rpComponents.clusterInspector.ClusterInspectorService($http, $rootScope, $timeout, zoomLevelService, chartSpinnerService, rocksConfigService, clusterChartService, clusterFilterState);\n            }]);\n    })(clusterInspector = rpComponents.clusterInspector || (rpComponents.clusterInspector = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/**\n *\n * Handles the arbitrary 'zoom' levels/ranges that we will display different cluster granularities.\n *\n *\n */\nvar rpComponents;\n(function (rpComponents) {\n    var zoom;\n    (function (zoom) {\n        'use strict';\n        var ZoomLevelService = (function () {\n            function ZoomLevelService($rootScope, rocksConfigService) {\n                var _this = this;\n                this.$rootScope = $rootScope;\n                this.rocksConfigService = rocksConfigService;\n                this.zoomLevels = [\n                    5000,\n                    10000,\n                    20000,\n                    30000,\n                    50000,\n                    80000,\n                    200000,\n                    1000000,\n                    1500000,\n                    2000000,\n                    4000000,\n                    6500000,\n                    // these's tiles are pretty broad\n                    8500000,\n                    10000000,\n                    15000000,\n                    100000000\n                ];\n                this.defaultExtent = {\n                    \"west\": 109,\n                    \"south\": -45,\n                    \"east\": 158,\n                    \"north\": -8\n                };\n                this.moveEndHandler = function () {\n                    _this.nextPosition = _this.map;\n                    // changed indexes or exceed threshold for pan, trigger recluster\n                    if ((_this.previousPosition.height > -1 && _this.getIndex(_this.previousPosition.height) != _this.nextIndex) ||\n                        (Math.abs(_this.nextPosition.latitude - _this.previousPosition.latitude) > 0.01 / _this.nextIndex ||\n                            Math.abs(_this.nextPosition.longitude - _this.previousPosition.longitude) > 0.01 / _this.nextIndex) ||\n                        _this.nextIndex == 16) {\n                        _this.$rootScope.$broadcast('rocks.clusters.update', _this.nextIndex);\n                    }\n                    console.log(\"INDEX = \" + _this.nextIndex);\n                    _this.previousPosition = _this.nextPosition;\n                };\n                this.$rootScope.$on('rocks.config.ready', function () {\n                    _this.map = _this.rocksConfigService.map;\n                });\n            }\n            Object.defineProperty(ZoomLevelService.prototype, \"nextIndex\", {\n                get: function () {\n                    return this.getIndex(this.nextPosition.height);\n                },\n                enumerable: true,\n                configurable: true\n            });\n            /**\n             *\n             * Get the lowest index the height fits into\n             *\n             * @param height\n             * @returns {number}\n             */\n            ZoomLevelService.prototype.getIndex = function (height) {\n                for (var i = 0; i < this.zoomLevels.length; i++) {\n                    if (height < this.zoomLevels[i]) {\n                        return this.zoomLevels.length - i;\n                    }\n                }\n                return this.zoomLevels.length - 1;\n            };\n            ZoomLevelService.prototype.setActive = function (active) {\n                console.log(\"setActive called\");\n            };\n            /**\n             *\n             * WKT? GeoJSON? - leave until approach is clearer.\n             * TODO this is here temporarily, more thought needed re managing the buffered extent currently handled by minimap.\n             *\n             * @param offset\n             * @returns {any}\n             */\n            ZoomLevelService.prototype.getViewExtent = function (offset) {\n                return 0;\n            };\n            ZoomLevelService.$inject = [\n                \"$rootScope\",\n                \"rocksConfigService\"\n            ];\n            return ZoomLevelService;\n        }());\n        zoom.ZoomLevelService = ZoomLevelService;\n        angular\n            .module('explorer.rockproperties.zoom', [])\n            .factory(\"zoomLevelService\", [\"$rootScope\", \"rocksConfigService\",\n            function ($rootScope, rocksConfigService) {\n                return new rpComponents.zoom.ZoomLevelService($rootScope, rocksConfigService);\n            }]);\n    })(zoom = rpComponents.zoom || (rpComponents.zoom = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"../components/charts\" />\n/// <reference path=\"../components/config\" />\n/// <reference path=\"../components/cluster-filters\" />\n/// <reference path=\"../components/spinner\" />\n/// <reference path=\"cluster-inspector\" />\n/// <reference path=\"zoom\" />\nvar rpComponents;\n(function (rpComponents) {\n    var clusterService;\n    (function (clusterService) {\n        'use strict';\n        var ClusterHeightWeighter = (function () {\n            function ClusterHeightWeighter() {\n            }\n            ClusterHeightWeighter.prototype.calculateWeighting = function (zoom) {\n                return Math.pow(1.43, zoom);\n            };\n            return ClusterHeightWeighter;\n        }());\n        clusterService.ClusterHeightWeighter = ClusterHeightWeighter;\n        var ClusterService = (function () {\n            function ClusterService($http, $rootScope, zoomLevelService, clusterChartService, loadingSpinnerService, rocksConfigService, clusterInspectorService, clusterFilterState) {\n                var _this = this;\n                this.$http = $http;\n                this.$rootScope = $rootScope;\n                this.zoomLevelService = zoomLevelService;\n                this.clusterChartService = clusterChartService;\n                this.loadingSpinnerService = loadingSpinnerService;\n                this.rocksConfigService = rocksConfigService;\n                this.clusterInspectorService = clusterInspectorService;\n                this.clusterFilterState = clusterFilterState;\n                this.sequence = 0;\n                this.clusterFilter = '';\n                /**\n                 *\n                 * We get a performance benefit when we use fewer\n                 * primitives/collections to draw multiple static geometries.\n                 *\n                 */\n                this.reCluster = function () {\n                };\n                this.$rootScope.$on('rocks.config.ready', function () {\n                    _this.map = _this.rocksConfigService.map;\n                    _this.serviceUrl = _this.rocksConfigService.config.rocksServiceUrl;\n                    _this.init();\n                });\n            }\n            ClusterService.prototype.init = function () {\n                this.map.on('zoomend', movePan);\n                this.map.on('dragend', movePan);\n                function movePan(event) {\n                    if (this.layer) {\n                        this.map.removeLayer(this.layer);\n                        this.layer = null;\n                    }\n                    var instanceSequence = ++this.sequence;\n                    var zoom = this.map.getZoom();\n                    var bounds = this.map.getBounds();\n                    var parms = [];\n                    parms.push(\"xmin=\" + Math.max(bounds.getWest() - 20 / Math.pow(zoom, 1.2), -180));\n                    +parms.push(\"xmax=\" + Math.min(bounds.getEast() + 20 / Math.pow(zoom, 1.2), 180));\n                    parms.push(\"ymin=\" + Math.max(bounds.getSouth() - 10 / Math.pow(zoom, 1.2), -90));\n                    parms.push(\"ymax=\" + Math.min(bounds.getNorth() + 10 / Math.pow(zoom, 1.2), 90));\n                    parms.push(\"zoom=\" + (Math.max(zoom, 2)));\n                    var geojsonMarkerOptions = {\n                        radius: 8,\n                        fillColor: \"#ff7800\",\n                        color: \"#000\",\n                        weight: 1,\n                        opacity: 1,\n                        fillOpacity: 0.8\n                    };\n                    this.$http.get(this.serviceUrl + \"?\" + parms.join(\"&\")).then(function (result) {\n                        if (instanceSequence < this.sequence) {\n                            return;\n                        }\n                        var maxRadius = Math.sqrt(d3.max(result.data.features, function (item) {\n                            return item.properties.count;\n                        }));\n                        this.layer = L.geoJson(result.data, {\n                            pointToLayer: function (feature, latlng) {\n                                var geojsonMarkerOptions = {\n                                    radius: 4 + 20 / maxRadius * Math.sqrt(feature.properties.count),\n                                    fillColor: \"#ff7800\",\n                                    color: \"#000\",\n                                    weight: 1,\n                                    opacity: 1,\n                                    fillOpacity: 0.8\n                                };\n                                var marker = L.circleMarker(latlng, geojsonMarkerOptions)\n                                    .bindLabel(\"\" + feature.properties.count, { noHide: true });\n                                marker.on(\"click\", function () {\n                                    var id = this.feature.id.split(\"/\");\n                                    //\t\t    \t\t        \trocks3dNavigatorService.to({\n                                    //\t\t    \t\t        \t\tzoom: id[0],\n                                    //\t\t    \t\t        \t\tx: id[1],\n                                    //\t\t    \t\t        \t\ty: id[2]\n                                    //\t\t    \t\t        \t})\n                                });\n                                return marker;\n                            }\n                        }).addTo(this.map);\n                    });\n                }\n            };\n            ClusterService.prototype.toggleClusters = function () {\n                return true;\n            };\n            ClusterService.$inject = [\n                \"$http\",\n                \"$rootScope\",\n                \"zoomLevelService\",\n                \"clusterChartService\",\n                \"loadingSpinnerService\",\n                \"rocksConfigService\",\n                \"clusterInspectorService\",\n                \"clusterFilterState\"\n            ];\n            return ClusterService;\n        }());\n        clusterService.ClusterService = ClusterService;\n        angular\n            .module('explorer.rockproperties.clusters', [])\n            .factory(\"clusterService\", [\n            \"$http\",\n            \"$rootScope\",\n            \"zoomLevelService\",\n            \"clusterChartService\",\n            \"loadingSpinnerService\",\n            \"rocksConfigService\",\n            \"clusterInspectorService\",\n            \"clusterFilterState\",\n            function ($http, $rootScope, zoomLevelService, clusterChartService, chartSpinnerService, rocksConfigService, clusterInspectorService, clusterFilterState) {\n                return new rpComponents.clusterService.ClusterService($http, $rootScope, zoomLevelService, clusterChartService, chartSpinnerService, rocksConfigService, clusterInspectorService, clusterFilterState);\n            }]);\n    })(clusterService = rpComponents.clusterService || (rpComponents.clusterService = {}));\n})(rpComponents || (rpComponents = {}));\n/// <reference path=\"../../typings/browser.d.ts\" />\n/// <reference path=\"../leaflet/clusters.ts\" />\nvar rpComponents;\n(function (rpComponents) {\n    var chartService;\n    (function (chartService) {\n        'use strict';\n        var ClusterChartCtrl = (function () {\n            function ClusterChartCtrl($scope, clusterChartService, clusterService) {\n                this.$scope = $scope;\n                this.clusterChartService = clusterChartService;\n                this.clusterService = clusterService;\n            }\n            ClusterChartCtrl.$inject = [\"$scope\", \"clusterChartService\", \"clusterService\"];\n            return ClusterChartCtrl;\n        }());\n        chartService.ClusterChartCtrl = ClusterChartCtrl;\n        var ClusterChartService = (function () {\n            function ClusterChartService($http, $rootScope) {\n                this.$http = $http;\n                this.$rootScope = $rootScope;\n            }\n            ClusterChartService.prototype.hideChart = function () {\n                this.$rootScope.$broadcast(\"chart.update\", {\n                    targetChartId: false\n                });\n            };\n            ClusterChartService.prototype.buildChart = function (dataset) {\n                document.getElementById(\"cluster-summary-chart-d3\").innerHTML = \"\";\n                // trigger open/display a chart div\n                this.$rootScope.$broadcast(\"chart.update\", {\n                    targetChartId: \"clusterSummaryChart\"\n                });\n                // push data into array for d3 charting\n                var properties = [];\n                angular.forEach(dataset.properties, function (property, key) {\n                    var propertyData = [];\n                    angular.forEach(property, function (attribute, attKey) {\n                        propertyData.push({ attributeName: attKey, count: attribute });\n                    });\n                    properties.push({ propertyName: key, data: propertyData });\n                });\n                /*---------------------------------------- D3 -----------------------------------------*/\n                // LAYOUT\n                var minWidth = 1250;\n                var minHeight = 255;\n                var numberOfCharts = (properties.length < 7) ? properties.length : 4; // use two rows if we get too many properties\n                var width;\n                var height;\n                var padding;\n                var donutWidth;\n                if (document.body.clientHeight * 0.35 > minHeight && document.body.clientWidth > minWidth) {\n                    padding = { top: 0, right: 10, bottom: 0, left: 10 };\n                    width = document.body.clientWidth / numberOfCharts - (2 * padding.left + padding.right);\n                    height = document.body.clientHeight * 0.35;\n                    donutWidth = 20;\n                }\n                else {\n                    padding = { top: 0, right: 5, bottom: 0, left: 5 };\n                    width = minWidth / numberOfCharts - (2 * padding.left + padding.right);\n                    height = minHeight;\n                    donutWidth = 15;\n                }\n                var panelWidth = document.body.clientWidth - (2 * padding.left + padding.right);\n                var radius = Math.min(width, height) / 2;\n                // DATA\n                // build a chart for each property\n                properties.forEach(function (property) {\n                    var color = d3.scale.category20();\n                    var svg = d3.select('#cluster-summary-chart-d3')\n                        .append('svg')\n                        .attr('width', width)\n                        .attr('height', height)\n                        .style('margin-left', padding.left + 'px')\n                        .style('margin-right', padding.right + 'px')\n                        .append('g')\n                        .attr('transform', 'translate(' + (width / 2) +\n                        ',' + ((height / 2) + 10) + ')');\n                    var arc = d3.svg.arc()\n                        .innerRadius(radius - donutWidth)\n                        .outerRadius(radius);\n                    var pie = d3.layout.pie()\n                        .value(function (d) { return d.count; })\n                        .sort(null);\n                    var tooltip = d3.select('#cluster-summary-chart-d3')\n                        .append('div')\n                        .attr('class', 'cluster-summary-tooltip');\n                    tooltip.append('div')\n                        .attr('class', 'attribute');\n                    tooltip.append('div')\n                        .attr('class', 'count');\n                    tooltip.append('div')\n                        .attr('class', 'percent');\n                    var path = svg.selectAll('path')\n                        .data(pie(property.data))\n                        .enter()\n                        .append('path')\n                        .attr('d', arc)\n                        .attr('fill', function (d, i) {\n                        return color(d.data.attributeName);\n                    })\n                        .each(function (d) { this._current = d; });\n                    path.on('mouseover', function (d) {\n                        var total = d3.sum(property.data.map(function (d) {\n                            return d.count;\n                        }));\n                        var percent = Math.round(1000 * d.data.count / total) / 10;\n                        tooltip.select('.attribute').html(d.data.attributeName);\n                        tooltip.select('.count').html(\"Count: \" + d.data.count);\n                        tooltip.select('.percent').html(\"Percent: \" + percent + '%');\n                        tooltip.style('display', 'block');\n                    });\n                    path.on('mouseout', function () {\n                        tooltip.style('display', 'none');\n                    });\n                    path.on('mousemove', function (d) {\n                        var x = (d3.event.pageX > panelWidth - 180) ? d3.event.pageX - 180 : d3.event.pageX;\n                        var y = (d3.event.pageY > document.body.clientHeight - 120) ? d3.event.pageY - 100 : d3.event.pageY + 10;\n                        tooltip\n                            .style('top', y + 'px')\n                            .style('left', x + 'px');\n                    });\n                    // title\n                    svg.append(\"g\")\n                        .attr(\"class\", \"cluster-summary-chart-title\")\n                        .append(\"text\")\n                        .attr(\"x\", 0)\n                        .attr(\"y\", -((height / 2) + 7))\n                        .attr(\"dy\", \".71em\")\n                        .style(\"text-anchor\", \"middle\")\n                        .style(\"fill\", \"#000\")\n                        .style(\"font-weight\", \"bold\")\n                        .text(property.propertyName);\n                    // PAGINATED LEGEND\n                    var legendCount = property.data.length;\n                    var legendWidth = 15;\n                    var legendSpacing = 6;\n                    var netLegendHeight = (legendWidth + legendSpacing) * legendCount;\n                    var legendPerPage;\n                    var totalPages;\n                    var pageNo;\n                    if ((netLegendHeight / radius) > 1) {\n                        legendPerPage = Math.floor(radius / (legendWidth + legendSpacing));\n                        totalPages = Math.ceil(legendCount / legendPerPage);\n                        pageNo = 1;\n                        var startIndex = (pageNo - 1) * legendPerPage;\n                        var endIndex = startIndex + legendPerPage;\n                        var dataSubset = [];\n                        for (var i = 0; i < property.data.length; i++) {\n                            if (i >= startIndex && i < endIndex) {\n                                dataSubset.push(property.data[i]);\n                            }\n                        }\n                        drawLegend(dataSubset, legendPerPage, pageNo, totalPages);\n                    }\n                    else {\n                        drawLegend(property.data, Math.floor(radius / (legendWidth + legendSpacing)), 1, 1);\n                    }\n                    /**\n                     *\n                     * Draws paginated legend if we need multiple pages\n                     *\n                     * @param data\n                     * @param legendPerPage\n                     * @param pageNo\n                     * @param totalPages\n                     */\n                    function drawLegend(data, legendPerPage, pageNo, totalPages) {\n                        var legend = svg.selectAll(\"g.legendg\")\n                            .data(data)\n                            .enter().append(\"g\")\n                            .attr('class', 'legendg')\n                            .attr(\"transform\", function (d, i) { return \"translate(\" + -(width / 2.3) + \",\" + ((i * (legendWidth + legendSpacing)) - (height / 4)) + \")\"; });\n                        var legendRect = legend.append(\"rect\")\n                            .attr(\"x\", 45)\n                            .attr(\"width\", legendWidth)\n                            .attr(\"height\", legendWidth)\n                            .attr(\"class\", \"legend\")\n                            .style('fill', function (d, i) { return color(d.attributeName); });\n                        var legendText = legend.append(\"text\")\n                            .attr(\"x\", 65)\n                            .attr(\"y\", 6)\n                            .attr(\"dy\", \".35em\")\n                            .style(\"text-anchor\", \"start\")\n                            .text(function (d) {\n                            // truncate long labels\n                            var charSpace = (radius - 20) / 5;\n                            if (d.attributeName.length > charSpace)\n                                return d.attributeName.substring(0, charSpace) + '...';\n                            else\n                                return d.attributeName;\n                        });\n                        // title tooltips\n                        legendRect.append(\"svg:title\").text(function (d) {\n                            var total = d3.sum(property.data.map(function (d) { return d.count; }));\n                            return d.attributeName + \" (\" + Math.round(1000 * d.count / total) / 10 + \"%)\";\n                        });\n                        legendText.append(\"svg:title\").text(function (d) {\n                            var total = d3.sum(property.data.map(function (d) { return d.count; }));\n                            return d.attributeName + \" (\" + Math.round(1000 * d.count / total) / 10 + \"%)\";\n                        });\n                        if (totalPages > 1) {\n                            var pageText = svg.append(\"g\")\n                                .attr('class', 'pageNo')\n                                .attr(\"transform\", \"translate(\" + (-10) + \",\" + ((legendPerPage + 1) * (legendWidth + legendSpacing) - (height / 4)) + \")\");\n                            pageText.append('text').text(pageNo + '/' + totalPages)\n                                .attr('dx', '.25em');\n                            var prevtriangle = svg.append(\"g\")\n                                .attr('class', 'prev')\n                                .attr(\"transform\", \"translate(\" + (-20) + \",\" + ((legendPerPage + 1.5) * (legendWidth + legendSpacing) - (height / 4)) + \")\")\n                                .on('click', prevLegend)\n                                .style('cursor', 'pointer');\n                            var nexttriangle = svg.append(\"g\")\n                                .attr('class', 'next')\n                                .attr(\"transform\", \"translate(\" + (0) + \",\" + ((legendPerPage + 1.5) * (legendWidth + legendSpacing) - (height / 4)) + \")\")\n                                .on('click', nextLegend)\n                                .style('cursor', 'pointer');\n                            nexttriangle.append('polygon')\n                                .style('stroke', '#000')\n                                .style('fill', '#000')\n                                .attr('points', '0,0, 20,0, 10,10');\n                            prevtriangle.append('polygon')\n                                .style('stroke', '#000')\n                                .style('fill', '#000')\n                                .attr('points', '0,10, 20,10, 10,0');\n                            if (pageNo == totalPages) {\n                                nexttriangle.style('opacity', '0.3');\n                                nexttriangle.on('click', '')\n                                    .style('cursor', '');\n                            }\n                            else if (pageNo == 1) {\n                                prevtriangle.style('opacity', '0.3');\n                                prevtriangle.on('click', '')\n                                    .style('cursor', '');\n                            }\n                        }\n                    }\n                    function prevLegend() {\n                        pageNo--;\n                        svg.selectAll(\"g.legendg\").remove();\n                        svg.select('.pageNo').remove();\n                        svg.select('.prev').remove();\n                        svg.select('.next').remove();\n                        var startIndex = (pageNo - 1) * legendPerPage;\n                        var endIndex = startIndex + legendPerPage;\n                        var dataSubset = [];\n                        for (var i = 0; i < property.data.length; i++) {\n                            if (i >= startIndex && i < endIndex) {\n                                dataSubset.push(property.data[i]);\n                            }\n                        }\n                        drawLegend(dataSubset, legendPerPage, pageNo, totalPages);\n                    }\n                    function nextLegend() {\n                        pageNo++;\n                        svg.selectAll(\"g.legendg\").remove();\n                        svg.select('.pageNo').remove();\n                        svg.select('.prev').remove();\n                        svg.select('.next').remove();\n                        var startIndex = (pageNo - 1) * legendPerPage;\n                        var endIndex = startIndex + legendPerPage;\n                        var seriesSubset = [];\n                        for (var i = 0; i < property.data.length; i++) {\n                            if (i >= startIndex && i < endIndex) {\n                                seriesSubset.push(property.data[i]);\n                            }\n                        }\n                        drawLegend(seriesSubset, legendPerPage, pageNo, totalPages);\n                    }\n                });\n                /*---------------------------------------- /D3 -----------------------------------------*/\n                // DEBUG emulate loading..\n                document.getElementById(\"cluster-summary-chart-d3\").style.display = 'none';\n                // chart ready to go\n                setTimeout(function () {\n                    document.getElementById(\"cluster-summary-chart-loading\").style.display = 'none';\n                    document.getElementById(\"cluster-summary-chart-d3\").style.display = 'block';\n                }, 1500);\n                return;\n            };\n            ClusterChartService.$inject = [\n                \"$http\",\n                \"$rootScope\"\n            ];\n            return ClusterChartService;\n        }());\n        chartService.ClusterChartService = ClusterChartService;\n        angular\n            .module('explorer.rockproperties.charts', [])\n            .factory(\"clusterChartService\", [\"$http\", \"$rootScope\",\n            function ($http, $rootScope) {\n                return new rpComponents.chartService.ClusterChartService($http, $rootScope);\n            }])\n            .controller(\"clusterChartCtrl\", ClusterChartCtrl)\n            .directive(\"clusterChartSummary\", function () {\n            return {\n                templateUrl: 'rockprops/cluster-summary.html',\n                controller: ClusterChartCtrl,\n                controllerAs: 'clusterChartVM'\n            };\n        });\n    })(chartService = rpComponents.chartService || (rpComponents.chartService = {}));\n})(rpComponents || (rpComponents = {}));\nangular.module(\"explorer.rockproperties.templates\", []).run([\"$templateCache\", function ($templateCache) {\n        $templateCache.put(\"rockprops/clip-ship.html\", \"\\r\\n<div ng-show=\\\"rocksClipShipVM.rocksClipShipService.step == \\'startDraw\\'\\\">\\r\\n\t<h6 class=\\\"dis-inline\\\">\\r\\n\t\t1.\\r\\n\t\t<button ng-click=\\\"rocksClipShipVM.rocksClipShipService.startDraw()\\\" style=\\\"padding: 5px 10px;border-radius: 3px;border: none;\\\">\\r\\n\t\t\tClick here\\r\\n\t\t</button>\\r\\n\t\tto select an area on the map <i class=\\\"fa fa-scissors\\\" style=\\\"font-size: 16px;\\\"></i></h6>\\r\\n</div>\\r\\n\\r\\n\\r\\n<div ng-show=\\\"rocksClipShipVM.rocksClipShipService.step == \\'selectFeatures\\'\\\">\\r\\n\\r\\n\t<h6 class=\\\"dis-inline\\\">2. Select features to download:</h6>\\r\\n\\r\\n\t<div>\\r\\n\\r\\n\t\t<!-- if we have active property filters, use them instead -->\\r\\n\t\t<p ng-show=\\\"hasAnyFilter\\\">\\r\\n\t\t\t<i class=\\\"fa fa-info-circle\\\"></i> Current filters will be applied to the exported data.\\r\\n\t\t</p>\\r\\n\\r\\n\t\t<div ng-hide=\\\"hasAnyFilter\\\">\\r\\n\\r\\n\t\t\t<div style=\\\"padding: 5px; margin-top: 10px; background: #f0f0f0; border-radius: 3px;\\\">\\r\\n\t\t\t\t<label>\\r\\n\t\t\t\t\t<input\\r\\n\t\t\t\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\t\t\t\tng-model=\\\"masterCheck\\\"\\r\\n\t\t\t\t\t\tng-disabled=\\\"hasPropertyFilter\\\"\\r\\n\t\t\t\t\t\tng-change=\\\"rocksClipShipVM.rocksFiltersService.setAllExportSelected(masterCheck)\\\" />\\r\\n\t\t\t\t\t{{ masterCheck ? \\'Deselect\\' : \\'Select\\' }} All\\r\\n\t\t\t\t</label>\\r\\n\t\t\t</div>\\r\\n\\r\\n\t\t\t<label style=\\\"margin-left: 25px;\\\" class=\\\"checkbox\\\" ng-repeat=\\\"property in rocksClipShipVM.rocksFiltersService.exportProperties.filterOptions\\\">\\r\\n\t\t\t\t<input\\r\\n\t\t\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\t\t\tvalue=\\\"property.isSelected\\\"\\r\\n\t\t\t\t\tng-model=\\\"property.isSelected\\\"\\r\\n\t\t\t\t\tng-checked=\\\"masterCheck\\\"\\r\\n\t\t\t\t\tng-disabled=\\\"hasPropertyFilter\\\">\\r\\n\t\t\t\t{{ property.name }}\\r\\n\t\t\t</label>\\r\\n\\r\\n\t\t</div>\\r\\n\\r\\n\t\t<div style=\\\"margin: 20px 0px 20px 0px;\\\">\\r\\n\t\t\t<label title=\\\"Export Format\\\">Export Format</label>\\r\\n\t\t\t<select ng-change=\\\"rocksClipShipVM.rocksClipShipService.updateExportFormat(exportFormats.SelectedOption)\\\"\\r\\n\t\t\t\t\tng-model=\\\"exportFormats.SelectedOption\\\"\\r\\n\t\t\t\t\tname=\\\"format\\\"\\r\\n\t\t\t\t\tng-options=\\\"option for option in rocksClipShipVM.rocksClipShipService.exportFormats\\\"\\r\\n\t\t\t\t\tng-class=\\\"form-control\\\"\\r\\n\t\t\t\t\tclass=\\\"filter-input\\\"\\r\\n\t\t\t\t\tstyle=\\\"float: right; width: 160px;\\\">\\r\\n\t\t\t\t<option value=\\\"\\\" class=\\\"\\\">--select--</option>\\r\\n\t\t\t</select>\\r\\n\t\t</div>\\r\\n\\r\\n\t\t<a ng-click=\\\"rocksClipShipVM.rocksClipShipService.openGeoserver()\\\" style=\\\"font-size: 11px; margin-top: 20px; color: blue; text-decoration: underline;\\\">\\r\\n\t\t\tMore Options via GeoServer Dashboard\\r\\n\t\t</a>\\r\\n\\r\\n\t\t<div style=\\\"margin-top: 20px;\\\">\\r\\n\t\t\t<button\\r\\n\t\t\t\ttype=\\\"button\\\"\\r\\n\t\t\t\tclass=\\\"btn btn-default\\\"\\r\\n\t\t\t\tng-click=\\\"rocksClipShipVM.rocksClipShipService.step = \\'startDraw\\'; rocksClipShipVM.rocksClipShipService.isDrawing = false\\\"\\r\\n\t\t\t\ttitle=\\\"Cancel Download\\\"\\r\\n\t\t\t\tstyle=\\\"width: 40%; float: left;\\\">Cancel</button>\\r\\n\t\t\t<button\\r\\n\t\t\t\ttype=\\\"button\\\"\\r\\n\t\t\t\tclass=\\\"btn btn-default focusMe\\\"\\r\\n\t\t\t\tng-click=\\\"rocksClipShipVM.startClipShip()\\\"\\r\\n\t\t\t\tstyle=\\\"width: 40%; float: right\\\"\\r\\n\t\t\t\ttitle=\\\"Select one or more reference feature classes before continuing.\\\"\\r\\n\t\t\t\tng-disabled=\\\"(rocksClipShipVM.rocksFiltersService.exportProperties.filterOptions | noClipSelected) || (!rocksClipShipVM.rocksClipShipService.targetFormat)\\\">Next</button>\\r\\n\t\t</div>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n</div>\\r\\n\\r\\n<div ng-show=\\\"rocksClipShipVM.rocksClipShipService.step == \\'download\\'\\\">\\r\\n\\r\\n\t<h6>3. Data Export:</h6>\\r\\n\\r\\n\t<div ng-hide=\\\"rocksClipShipVM.rocksQueryBuilderExport.loading\\\">\\r\\n\\r\\n\t\t<p ng-show=\\\"rocksClipShipVM.rocksClipShipService.targetFormat === \\'application/json\\'\\\" style=\\\"margin-top: 40px;\\\">\\r\\n\t\t\t<i class=\\\"fa fa-info-circle\\\"></i> Once json has loaded, save page as a .json file.\\r\\n\t\t</p>\\r\\n\\r\\n\t\t<p class=\\\"warning-block\\\" style=\\\"margin-top: 20px;\\\">\\r\\n\t\t\t<i class=\\\"fa fa-info-circle\\\"></i> Large data sets may take several minutes to export.\\r\\n\t\t</p>\\r\\n\\r\\n\t\t<a\\r\\n\t\t\tclass=\\\"btn btn-default\\\"\\r\\n\t\t\ttarget=\\\"_blank\\\"\\r\\n\t\t\thref=\\\"{{rocksClipShipVM.rocksQueryBuilderExport.exportUrl}}\\\"\\r\\n\t\t\tng-click=\\\"rocksClipShipVM.rocksClipShipService.step = \\'startDraw\\'; rocksClipShipVM.rocksClipShipService.isDrawing = false\\\"\\r\\n\t\t\tstyle=\\\"width: 100%; margin-top: 30px;\\\"\\r\\n\t\t\trole=\\\"button\\\">\\r\\n\t\t\t<i class=\\\"fa fa-download\\\"></i> Download {{ rocksClipShipVM.rocksClipShipService.targetFormat }}\\r\\n\t\t</a>\\r\\n\\r\\n\t\t<a\\r\\n\t\t\tclass=\\\"btn btn-default\\\"\\r\\n\t\t\thref=\\\"javascript:;\\\"\\r\\n\t\t\tng-click=\\\"rocksClipShipVM.rocksClipShipService.step = \\'selectFeatures\\'\\\"\\r\\n\t\t\tstyle=\\\"width: 100%; margin-top: 10px;\\\"\\r\\n\t\t\trole=\\\"button\\\">\\r\\n\t\t\t<i class=\\\"fa fa-arrow-left\\\"></i> Back\\r\\n\t\t</a>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n</div>\\r\\n\\r\\n<div id=\\\"rock-clip-ship-loading\\\" ng-show=\\\"rocksClipShipVM.rocksQueryBuilderExport.loading\\\">\\r\\n\t<p>Preparing Data..</p>\\r\\n</div>\");\n        $templateCache.put(\"rockprops/cluster-filters.html\", \"\\r\\n<!-- TODO plug into rock props filter service -->\\r\\n\\r\\n<div ng-hide=\\\"clusterInspectorVM.rocksPanelService.clustersEnabled\\\">\\r\\n\tEnable Cluster Features to apply filters.\\r\\n</div>\\r\\n\\r\\n<div ng-show=\\\"clusterInspectorVM.rocksPanelService.clustersEnabled\\\">\\r\\n\\r\\n\\r\\n\t<div ng-repeat=\\\"filter in rocksClusterFilterVM.rocksFiltersService.filters\\\" style=\\\"padding-top:7px;position:relative; overflow-x: hidden;overflow-y: auto;\\\">\\r\\n\\r\\n\t\t<label style=\\\"font-size: 11px;\\\" title=\\\"{{filter.filterLabel}}\\\">{{filter.filterLabel}}</label>\\r\\n\t\t<select\\r\\n\t\t\t\tng-model=\\\"filter.ClusterOption\\\"\\r\\n\t\t\t\tname=\\\"filter.filterType\\\"\\r\\n\t\t\t\tng-options=\\\"option as option for option in filter.filterOptions\\\"\\r\\n\t\t\t\tng-class=\\'form-control\\'\\r\\n\t\t\t\tclass=\\'filter-input\\'\\r\\n\t\t\t\tstyle=\\\"float:left;width:100%;position:relative;\\\">\\r\\n\t\t\t<option value=\\\"\\\" selected>--select--</option>\\r\\n\t\t</select>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n\t<div style=\\\"text-align: center;\\\">\\r\\n\t\t<a class=\\\"btn btn-default\\\" style=\\\"margin: 10px;\\\" ng-click=\\\"rocksClusterFilterVM.rocksFiltersService.applyFilters()\\\" href=\\\"javascript:;\\\">\\r\\n\t\t\t<i class=\\\"fa fa-filter fa-lg\\\"></i>\\r\\n\t\t\tApply\\r\\n\t\t</a>\\r\\n\\r\\n\t\t<a class=\\\"btn btn-default\\\" style=\\\"margin: 10px;\\\" ng-click=\\\"rocksClusterFilterVM.rocksFiltersService.clearFilters()\\\" href=\\\"javascript:;\\\">\\r\\n\t\t\t<i class=\\\"fa fa-remove fa-lg\\\"></i>\\r\\n\t\t\tClear\\r\\n\t\t</a>\\r\\n\\r\\n\t\t<p ng-show=\\\"filterResultCount()\\\" style=\\\"text-align: left; margin: 10px; font-size: 14px;\\\">\\r\\n\t\t\t<strong>Record Count: </strong>\\r\\n\t\t\t14320\\r\\n\t\t</p>\\r\\n\t</div>\\r\\n\\r\\n</div>\\r\\n\");\n        $templateCache.put(\"rockprops/cluster-inspector.html\", \"\\r\\n<div ng-hide=\\\"clusterInspectorVM.rocksPanelService.clustersEnabled\\\">\\r\\n\tEnable Cluster Features to use the inspector tool.\\r\\n</div>\\r\\n\\r\\n<div ng-show=\\\"clusterInspectorVM.rocksPanelService.clustersEnabled\\\">\\r\\n\\r\\n\t<p>Click on a cluster to see:</p>\\r\\n\\r\\n\t<label class=\\\"radio-inline\\\">\\r\\n\t\t<input\\r\\n\t\t\ttype=\\\"radio\\\"\\r\\n\t\t\tng-model=\\\"clusterInspectorVM.clusterInspectorService.inspectMode\\\"\\r\\n\t\t\tvalue=\\\"CHART\\\"> Summary charts\\r\\n\t</label>\\r\\n\t<label class=\\\"radio-inline\\\">\\r\\n\t\t<input\\r\\n\t\t\ttype=\\\"radio\\\"\\r\\n\t\t\tng-model=\\\"clusterInspectorVM.clusterInspectorService.inspectMode\\\"\\r\\n\t\t\tvalue=\\\"LIST\\\"> Results list\\r\\n\t</label>\\r\\n\\r\\n\t<div id=\\\"cluster-result-list-loading\\\" style=\\\"padding-top: 10px; text-align: center;\\\"></div>\\r\\n\\r\\n\\r\\n\t<div ng-show=\\\"clusterInspectorVM.clusterInspectorService.listReady\\\">\\r\\n\\r\\n\t\t<div ng-if=\\\"clusterInspectorVM.clusterInspectorService.listFeatures.totalFeatures > 0\\\" class=\\\"alert alert-success\\\" style=\\\"margin-top: 30px;\\\">\\r\\n\t\t\tFeatures loaded: {{clusterInspectorVM.clusterInspectorService.pagingState.count}} of \\r\\n\t\t\t\t\t\t\t{{clusterInspectorVM.clusterInspectorService.pagingState.total}}\\r\\n\t\t\t<button ng-show=\\\"clusterInspectorVM.clusterInspectorService.pagingState.more()\\\"  class=\\\"undecorated btn-sm\\\"\\r\\n\t\t\t\t\tstyle=\\\"float:right\\\" ng-click=\\\"clusterInspectorVM.clusterInspectorService.loadNextListStep()\\\">-More-</button>\\r\\n\t\t</div>\\r\\n\\r\\n\t\t<div ng-repeat=\\\"feature in clusterInspectorVM.clusterInspectorService.listFeatures.features\\\" class=\\\"rocks-result-list-feature\\\">\\r\\n\\r\\n\t\t\t<table class=\\\"table table-hover table-striped\\\">\\r\\n\\r\\n\t\t\t\t<h5>ID: {{feature.id}}</h5>\\r\\n\t\t\t\t<tbody>\\r\\n\t\t\t\t\t<tr>\\r\\n\t\t\t\t\t\t<td><strong>GEOM</strong></td>\\r\\n\t\t\t\t\t\t<td>{{feature.geometry.coordinates[0]}}, {{feature.geometry.coordinates[1]}}</td>\\r\\n\t\t\t\t\t</tr>\\r\\n\t\t\t\t\t<tr ng-repeat=\\\"(key, value) in feature.properties\\\">\\r\\n\t\t\t\t\t\t<td><strong>{{key}}</strong></td>\\r\\n\t\t\t\t\t\t<td>{{value}}</td>\\r\\n\t\t\t\t\t</tr>\\r\\n\t\t\t\t</tbody>\\r\\n\\r\\n\t\t\t</table>\\r\\n\t\t</div>\\r\\n\\r\\n\t\t<div ng-show=\\\"clusterInspectorVM.clusterInspectorService.pagingState.more()\\\">\\r\\n\t\t\t<span>{{clusterInspectorVM.clusterInspectorService.pagingState.count}} of {{clusterInspectorVM.clusterInspectorService.pagingState.total}}</span>\\r\\n\t\t\t<span style=\\\"float:right\\\">\\r\\n\t\t\t\t<button class=\\\"undecorated btn-sm\\\" ng-click=\\\"clusterInspectorVM.clusterInspectorService.loadNextListStep()\\\">-More-</button>\\r\\n\t\t\t</span>\\r\\n\t\t</div>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n</div>\\r\\n\");\n        $templateCache.put(\"rockprops/cluster-summary.html\", \"<div id=\\\"clusterSummaryChart\\\" ng-show=\\\"chartState.targetChartId == \\'clusterSummaryChart\\'\\\">\\r\\n\\r\\n\t<div class=\\\"btn-group\\\" style=\\\"position: absolute;right: 10px;top: 10px;\\\">\\r\\n\t\t<button type=\\\"button\\\" class=\\\"btn btn-default\\\" title=\\\"Close charts\\\" ng-click=\\\"clusterChartVM.clusterChartService.hideChart(); clusterChartVM.clusterService.clearHighlighted();\\\">\\r\\n\t\t\t<i class=\\\"fa fa-times-circle\\\" role=\\\"presentation\\\" style=\\\"font-size:16px; color:black\\\"></i>\\r\\n\t\t</button>\\r\\n\t</div>\\r\\n\\r\\n\t<div id=\\\"cluster-summary-chart-d3\\\"></div>\\r\\n\t<div id=\\\"cluster-summary-chart-loading\\\"></div>\\r\\n\\r\\n</div>\");\n        $templateCache.put(\"rockprops/control-panel.html\", \"<div>\\r\\n\\r\\n\t<div class=\\\"rocks-accordion\\\">\\r\\n\t\t<div class=\\\"rocks-toggle-button\\\" title=\\\"Show/hide cluster features\\\">\\r\\n\t\t\t<input\\r\\n\t\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\t\tng-model=\\\"controlPanelVM.rocksPanelService.clustersEnabled\\\"\\r\\n\t\t\t\tng-change=\\\"controlPanelVM.rocksPanelService.toggleClusters()\\\" />\\r\\n\t\t</div>\\r\\n\t\t<button class=\\\"title\\\" ng-click=\\\"controlPanelVM.setTargetPanel(\\'clusterFeatures\\')\\\">\\r\\n\t\t\t<i class=\\\"fa fa-{{ controlPanelVM.targetPanel == \\'clusterFeatures\\' ? \\'minus\\' : \\'plus\\' }}\\\"></i>\\r\\n\t\t\tCluster Features\\r\\n\t\t</button>\\r\\n\t</div>\\r\\n\t<div class=\\\"rocks-accordion-content\\\" ng-show=\\\"controlPanelVM.targetPanel == \\'clusterFeatures\\'\\\">\\r\\n\\r\\n\t\t<uib-tabset active=\\\"activeJustified\\\" justified=\\\"true\\\">\\r\\n\t\t\t<uib-tab index=\\\"0\\\" heading=\\\"Inspect\\\" style=\\\"padding: 0px 0px 20px 0px;\\\">\\r\\n\t\t\t\t<rocks-cluster-inspector-panel></rocks-cluster-inspector-panel>\\r\\n\t\t\t</uib-tab>\\r\\n\t\t\t<uib-tab index=\\\"1\\\" heading=\\\"Filter\\\" style=\\\"padding: 0px 0px 20px 0px;\\\">\\r\\n\t\t\t\t<rocks-cluster-filters></rocks-cluster-filters>\\r\\n\t\t\t</uib-tab>\\r\\n\t\t</uib-tabset>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n\t<div class=\\\"rocks-accordion\\\">\\r\\n\t\t<div class=\\\"rocks-toggle-button\\\" title=\\\"Show/hide point features WMS layer\\\">\\r\\n\t\t\t<input\\r\\n\t\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\t\tng-model=\\\"controlPanelVM.rocksPanelService.pointsEnabled\\\"\\r\\n\t\t\t\tng-change=\\\"controlPanelVM.rocksPanelService.togglePoints()\\\" />\\r\\n\t\t</div>\\r\\n\t\t<div class=\\\"title\\\" ng-click=\\\"controlPanelVM.setTargetPanel(\\'pointFeatures\\')\\\">\\r\\n\t\t\t<i class=\\\"fa fa-{{ controlPanelVM.targetPanel == \\'pointFeatures\\' ? \\'minus\\' : \\'plus\\' }}\\\"></i>\\r\\n\t\t\tPoint Features (WMS)\\r\\n\t\t</div>\\r\\n\t</div>\\r\\n\\r\\n\t<div class=\\\"rocks-accordion-content\\\" ng-show=\\\"controlPanelVM.targetPanel == \\'pointFeatures\\'\\\">\\r\\n\t\t<rocks-wms-points-legend></rocks-wms-points-legend>\\r\\n\t</div>\\r\\n\\r\\n\\r\\n\t<div class=\\\"rocks-accordion\\\">\\r\\n\t\t<div class=\\\"rocks-toggle-button\\\" title=\\\"Show/hide point features WMS layer\\\">\\r\\n\t\t\t<input\\r\\n\t\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\t\tng-model=\\\"controlPanelVM.wmsInspectorService.inspectorEnabled\\\"\\r\\n\t\t\t\tng-change=\\\"controlPanelVM.wmsInspectorService.togglePointInspector()\\\" />\\r\\n\t\t</div>\\r\\n\t\t<div class=\\\"title\\\" ng-click=\\\"controlPanelVM.setTargetPanel(\\'wmsInspector\\')\\\">\\r\\n\t\t\t<i class=\\\"fa fa-{{ controlPanelVM.targetPanel == \\'wmsInspector\\' ? \\'minus\\' : \\'plus\\' }}\\\"></i>\\r\\n\t\t\tWMS Inspector (GetFeatureInfo)\\r\\n\t\t</div>\\r\\n\t</div>\\r\\n\t<div class=\\\"rocks-accordion-content\\\" ng-show=\\\"controlPanelVM.targetPanel == \\'wmsInspector\\'\\\">\\r\\n\t\t<wms-inspector-panel></wms-inspector-panel>\\r\\n\t</div>\\r\\n\\r\\n\\r\\n\t<div class=\\\"rocks-accordion\\\">\\r\\n\t\t<div class=\\\"title w100\\\" ng-click=\\\"controlPanelVM.setTargetPanel(\\'clipShip\\')\\\">\\r\\n\t\t\t<i class=\\\"fa fa-{{ controlPanelVM.targetPanel == \\'clipShip\\' ? \\'minus\\' : \\'plus\\' }}\\\"></i>\\r\\n\t\t\tDownload Rock Property Data\\r\\n\t\t</div>\\r\\n\t</div>\\r\\n\\r\\n\t<div class=\\\"rocks-accordion-content\\\" ng-show=\\\"controlPanelVM.targetPanel == \\'clipShip\\'\\\">\\r\\n\\r\\n\t\t<rocks-clip-ship></rocks-clip-ship>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n</div>\");\n        $templateCache.put(\"rockprops/wms-inspector-panel.html\", \"\\r\\n<div ng-show=\\\"wmsInspectorVM.wmsInspectorState.view == \\'INTRO\\'\\\">\\r\\n\t<div ng-if=\\\"wmsInspectorVM.wmsInspectorService.inspectorEnabled\\\">Click the map to get feature info.</div>\\r\\n\t<div ng-if=\\\"!wmsInspectorVM.wmsInspectorService.inspectorEnabled\\\">Enable WMS Inspector to interrogate WMS layers.</div>\\r\\n</div>\\r\\n\\r\\n<div ng-show=\\\"wmsInspectorVM.wmsInspectorState.view == \\'LAYERSELECT\\'\\\">\\r\\n\\r\\n\t<p style=\\\"margin: 10px 0px;\\\" tooltip=\\\"Approx 30m accuracy\\\">\\r\\n\t\tSelect a layer to query:\\r\\n\t\t<code>\\r\\n\t\t\t{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lat | number : 2}},\\r\\n\t\t\t{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lon | number : 2}}\\r\\n\t\t</code>\\r\\n\t</p>\\r\\n\\r\\n\t<a\\r\\n\t\tclass=\\\"btn btn-default\\\"\\r\\n\t\tstyle=\\\"width: 100%; margin: 2px 0px\\\"\\r\\n\t\tng-click=\\\"wmsInspectorVM.wmsInspectorService.queryRocks()\\\"\\r\\n\t\thref=\\\"javascript:;\\\">\\r\\n\t\tRock Properties Data\\r\\n\t</a>\\r\\n\\r\\n\t<a\\r\\n\t\tng-repeat=\\\"feature in wmsInspectorVM.wmsInspectorService.features\\\"\\r\\n\t\tclass=\\\"btn btn-default\\\"\\r\\n\t   \tstyle=\\\"width: 100%; margin: 2px 0px\\\"\\r\\n\t   \tng-click=\\\"wmsInspectorVM.wmsInspectorService.queryFeature(feature)\\\"\\r\\n\t   \thref=\\\"javascript:;\\\">\\r\\n\t\t{{feature.name}}\\r\\n\t</a>\\r\\n\\r\\n\t<a class=\\\"btn btn-default\\\"\\r\\n\t   style=\\\"width: 100%; margin-top: 20px\\\"\\r\\n\t   ng-click=\\\"wmsInspectorVM.wmsInspectorState.view = \\'INTRO\\'\\\"\\r\\n\t   href=\\\"javascript:;\\\">\\r\\n\t\t<i class=\\\"fa fa-times fa-lg\\\"></i>\\r\\n\t\tCancel\\r\\n\t</a>\\r\\n\\r\\n</div>\\r\\n\\r\\n\\r\\n<div ng-show=\\\"wmsInspectorVM.wmsInspectorState.view == \\'FEATUREINFO\\'\\\">\\r\\n\\r\\n\t<div ng-show=\\\"wmsInspectorVM.wmsInspectorService.isLoading\\\">\\r\\n\t\t<div id=\\\"rocks-inspector-loading\\\"></div>\\r\\n\t</div>\\r\\n\\r\\n\t<div ng-hide=\\\"wmsInspectorVM.wmsInspectorService.isLoading\\\">\\r\\n\\r\\n\t\t<p style=\\\"margin: 10px 0px;\\\" tooltip=\\\"Approx 30m accuracy\\\">\\r\\n\t\t\tFeature Info for:\\r\\n\t\t\t<code>\\r\\n\t\t\t\t{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lat | number : 2}},\\r\\n\t\t\t\t{{wmsInspectorVM.wmsInspectorState.targetGeom.degrees.lon | number : 2}}\\r\\n\t\t\t</code>\\r\\n\t\t</p>\\r\\n\\r\\n\t\t<!-- put html here.. -->\\r\\n\t\t<div ng-bind-html=\\\"wmsInspectorVM.wmsInspectorService.featureInfo\\\"></div>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n\t<div>\\r\\n\\r\\n\t\t<a class=\\\"btn btn-default\\\"\\r\\n\t\t   style=\\\"width: 49%; margin-top: 20px\\\"\\r\\n\t\t   ng-click=\\\"wmsInspectorVM.wmsInspectorState.view = \\'LAYERSELECT\\'\\\"\\r\\n\t\t   href=\\\"javascript:;\\\">\\r\\n\t\t\t<i class=\\\"fa fa-arrow-left fa-lg\\\"></i>\\r\\n\t\t\tBack\\r\\n\t\t</a>\\r\\n\\r\\n\t\t<a class=\\\"btn btn-default\\\"\\r\\n\t\t   style=\\\"width: 49%; margin-top: 20px\\\"\\r\\n\t\t   ng-click=\\\"wmsInspectorVM.wmsInspectorState.view = \\'INTRO\\'\\\"\\r\\n\t\t   href=\\\"javascript:;\\\">\\r\\n\t\t\t<i class=\\\"fa fa-times fa-lg\\\"></i>\\r\\n\t\t\tCancel\\r\\n\t\t</a>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n</div>\");\n        $templateCache.put(\"rockprops/wms-points-panel.html\", \"<div ng-hide=\\\"rocksWmsPointsVM.rocksPanelService.pointsEnabled\\\">\\r\\n\tEnable Point Features to view layers.\\r\\n</div>\\r\\n\\r\\n<div ng-show=\\\"rocksWmsPointsVM.rocksPanelService.pointsEnabled\\\">\\r\\n\\r\\n\t<div style=\\\"padding: 5px 10px; margin-left: -10px; background: #f0f0f0; border-radius: 3px;\\\">\\r\\n\t\t<label>\\r\\n\t\t\t<input\\r\\n\t\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\t\tng-model=\\\"rocksWmsPointsVM.wmsPointsService.masterChecked\\\"\\r\\n\t\t\t\tng-change=\\\"rocksWmsPointsVM.wmsPointsService.toggleChecked()\\\"\\r\\n\t\t\t\tng-disabled=\\\"!rocksWmsPointsVM.rocksPanelService.pointsEnabled\\\"/>\\r\\n\t\t\t{{ rocksWmsPointsVM.wmsPointsService.masterChecked ? \\'Deselect\\' : \\'Select\\' }} all layers\\r\\n\t\t</label>\\r\\n\t</div>\\r\\n\\r\\n\t<div ng-repeat=\\\"legend in rocksWmsPointsVM.wmsPointsService.legendData\\\" class=\\'rocks-points-legend-item\\'>\\r\\n\\r\\n\t\t<label>\\r\\n\t\t\t<input\\r\\n\t\t\ttype=\\\"checkbox\\\"\\r\\n\t\t\tng-model=\\\"legend.isSelected\\\" />\\r\\n\t\t\t<img ng-src=\\\"{{legend.legendUrl}}\\\" alt=\\\"{{legend}} legend icon\\\" />\\r\\n\t\t</label>\\r\\n\\r\\n\t</div>\\r\\n\\r\\n\t<a class=\\\"btn btn-default\\\"\\r\\n\t   style=\\\"width: 100%; margin-top: 20px\\\"\\r\\n\t   ng-click=\\\"rocksWmsPointsVM.wmsPointsService.updatePointsLayer()\\\"\\r\\n\t   href=\\\"javascript:;\\\">\\r\\n\t\t<i class=\\\"fa fa-refresh fa-lg\\\"></i>\\r\\n\t\tUpdate layers\\r\\n\t</a>\\r\\n\\r\\n</div>\");\n    }]);\n",null,null,null],"sourceRoot":"/source/"}